<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>解读Kubeadm源码 | Joohwan</title><meta name="author" content="Joohwan."><meta name="copyright" content="Joohwan."><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="解读Kubeadm源码kubeadm init过程官网教程：https:&#x2F;&#x2F;kubernetes.io&#x2F;zh-cn&#x2F;docs&#x2F;reference&#x2F;setup-tools&#x2F;kubeadm&#x2F;kubeadm-init&#x2F; 1. Node环境检查（pre-fight-check) https:&#x2F;&#x2F;github.com&#x2F;kubernetes&#x2F;kubernetes&#x2F;blob&#x2F;b43b95aa5741e55b43">
<meta property="og:type" content="article">
<meta property="og:title" content="解读Kubeadm源码">
<meta property="og:url" content="https://piwriw.github.io/2023/10/23/cloud/k8s/kubeadm/%E8%A7%A3%E8%AF%BBKubeadm%E6%BA%90%E7%A0%81/index.html">
<meta property="og:site_name" content="Joohwan">
<meta property="og:description" content="解读Kubeadm源码kubeadm init过程官网教程：https:&#x2F;&#x2F;kubernetes.io&#x2F;zh-cn&#x2F;docs&#x2F;reference&#x2F;setup-tools&#x2F;kubeadm&#x2F;kubeadm-init&#x2F; 1. Node环境检查（pre-fight-check) https:&#x2F;&#x2F;github.com&#x2F;kubernetes&#x2F;kubernetes&#x2F;blob&#x2F;b43b95aa5741e55b43">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://piwriw.github.io/img/kubernetes.png">
<meta property="article:published_time" content="2023-10-23T08:08:55.000Z">
<meta property="article:modified_time" content="2026-02-28T13:29:12.669Z">
<meta property="article:author" content="Joohwan.">
<meta property="article:tag" content="k8s">
<meta property="article:tag" content="cloud">
<meta property="article:tag" content="kubeadm">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://piwriw.github.io/img/kubernetes.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "解读Kubeadm源码",
  "url": "https://piwriw.github.io/2023/10/23/cloud/k8s/kubeadm/%E8%A7%A3%E8%AF%BBKubeadm%E6%BA%90%E7%A0%81/",
  "image": "https://piwriw.github.io/img/kubernetes.png",
  "datePublished": "2023-10-23T08:08:55.000Z",
  "dateModified": "2026-02-28T13:29:12.669Z",
  "author": [
    {
      "@type": "Person",
      "name": "Joohwan.",
      "url": "https://github.com/Piwriw"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://piwriw.github.io/2023/10/23/cloud/k8s/kubeadm/%E8%A7%A3%E8%AF%BBKubeadm%E6%BA%90%E7%A0%81/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '解读Kubeadm源码',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><script src="/js/welcome.js"></script><script src="https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js"></script><link rel="stylesheet" href="/css/categories.css"><link rel="stylesheet" href="/css/tabs.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">259</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">76</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">60</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/charts/"><i class="fa-fw fas fa-folder-open"></i><span> 文章统计</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div><div class="menus_item"><a class="site-page" href="/wish/"><i class="fa-fw fas fa-tags"></i><span> 许愿墙</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/kubernetes.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Joohwan</span></a><a class="nav-page-title" href="/"><span class="site-name">解读Kubeadm源码</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/charts/"><i class="fa-fw fas fa-folder-open"></i><span> 文章统计</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div><div class="menus_item"><a class="site-page" href="/wish/"><i class="fa-fw fas fa-tags"></i><span> 许愿墙</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">解读Kubeadm源码</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-10-23T08:08:55.000Z" title="发表于 2023-10-23 16:08:55">2023-10-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-02-28T13:29:12.669Z" title="更新于 2026-02-28 21:29:12">2026-02-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud/">cloud</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud/k8s/">k8s</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud/k8s/kubeadm/">kubeadm</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">1.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>8分钟</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2026-02-28 21:29:12&quot;}" hidden></div><h1 id="解读Kubeadm源码"><a href="#解读Kubeadm源码" class="headerlink" title="解读Kubeadm源码"></a>解读Kubeadm源码</h1><h2 id="kubeadm-init过程"><a href="#kubeadm-init过程" class="headerlink" title="kubeadm init过程"></a>kubeadm init过程</h2><p>官网教程：<a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/reference/setup-tools/kubeadm/kubeadm-init/">https://kubernetes.io/zh-cn/docs/reference/setup-tools/kubeadm/kubeadm-init/</a></p>
<h3 id="1-Node环境检查（pre-fight-check"><a href="#1-Node环境检查（pre-fight-check" class="headerlink" title="1. Node环境检查（pre-fight-check)"></a>1. Node环境检查（pre-fight-check)</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes/blob/b43b95aa5741e55b433e785be1df9558b3841091/cmd/kubeadm/app/preflight/checks.go#L896">https://github.com/kubernetes/kubernetes/blob/b43b95aa5741e55b433e785be1df9558b3841091/cmd/kubeadm/app/preflight/checks.go#L896</a></li>
</ul>
<p>生成的checks列表的对象，都实现了check接口，通过调用Check()进行</p>
<ol>
<li>通过与prefight前检查独立存在</li>
<li>检查mainfestDir目录，K8s默认组件使用static pod</li>
<li>NumCPUCheck检查CPU 最低2C，可以通过<code>--ignore-prefight-errors=NumCPU</code>进行忽略</li>
<li>MemCheck检查检查，最低2G</li>
<li>进行kubectl、kubelet的版本匹配检查</li>
<li>检查FirewaldCheck检查防火墙</li>
<li>端口检查</li>
<li>……</li>
<li>同时还有RunPullImageCheck检查镜像是否存在</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitNodeChecks</span><span class="params">(execer utilsexec.Interface, cfg *kubeadmapi.InitConfiguration, ignorePreflightErrors sets.Set[<span class="type">string</span>], isSecondaryControlPlane <span class="type">bool</span>, downloadCerts <span class="type">bool</span>)</span></span> ([]Checker, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> !isSecondaryControlPlane &#123;</span><br><span class="line">		<span class="comment">// First, check if we&#x27;re root separately from the other preflight checks and fail fast</span></span><br><span class="line">		<span class="keyword">if</span> err := RunRootCheckOnly(ignorePreflightErrors); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	manifestsDir := filepath.Join(kubeadmconstants.KubernetesDir, kubeadmconstants.ManifestsSubDirName)</span><br><span class="line">	checks := []Checker&#123;</span><br><span class="line">    <span class="comment">//CPU检查 2G</span></span><br><span class="line">		NumCPUCheck&#123;NumCPU: kubeadmconstants.ControlPlaneNumCPU&#125;,</span><br><span class="line">		<span class="comment">// Linux only</span></span><br><span class="line">		<span class="comment">// <span class="doctag">TODO:</span> support other OS, if control-plane is supported on it.</span></span><br><span class="line">    <span class="comment">// 内存检查 170</span></span><br><span class="line">		MemCheck&#123;Mem: kubeadmconstants.ControlPlaneMem&#125;,</span><br><span class="line">		KubernetesVersionCheck&#123;KubernetesVersion: cfg.KubernetesVersion, KubeadmVersion: kubeadmversion.Get().GitVersion&#125;,</span><br><span class="line">    <span class="comment">// 防火墙检查</span></span><br><span class="line">		FirewalldCheck&#123;ports: []<span class="type">int</span>&#123;<span class="type">int</span>(cfg.LocalAPIEndpoint.BindPort), kubeadmconstants.KubeletPort&#125;&#125;,</span><br><span class="line">		PortOpenCheck&#123;port: <span class="type">int</span>(cfg.LocalAPIEndpoint.BindPort)&#125;,</span><br><span class="line">		PortOpenCheck&#123;port: kubeadmconstants.KubeSchedulerPort&#125;,</span><br><span class="line">		PortOpenCheck&#123;port: kubeadmconstants.KubeControllerManagerPort&#125;,</span><br><span class="line">		FileAvailableCheck&#123;Path: kubeadmconstants.GetStaticPodFilepath(kubeadmconstants.KubeAPIServer, manifestsDir)&#125;,</span><br><span class="line">		FileAvailableCheck&#123;Path: kubeadmconstants.GetStaticPodFilepath(kubeadmconstants.KubeControllerManager, manifestsDir)&#125;,</span><br><span class="line">		FileAvailableCheck&#123;Path: kubeadmconstants.GetStaticPodFilepath(kubeadmconstants.KubeScheduler, manifestsDir)&#125;,</span><br><span class="line">		FileAvailableCheck&#123;Path: kubeadmconstants.GetStaticPodFilepath(kubeadmconstants.Etcd, manifestsDir)&#125;,</span><br><span class="line">		HTTPProxyCheck&#123;Proto: <span class="string">&quot;https&quot;</span>, Host: cfg.LocalAPIEndpoint.AdvertiseAddress&#125;,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// File content check for IPV4 and IPV6 are needed if it is:</span></span><br><span class="line">	<span class="comment">// (dual stack)  `--service-cidr` or `--pod-network-cidr` is set with an IPV4 and IPV6 CIDR, `--apiserver-advertise-address` is optional as it can be auto-detected.</span></span><br><span class="line">	<span class="comment">// (single stack) which is decided by the `--apiserver-advertise-address`.</span></span><br><span class="line">	<span class="comment">// Note that for the case of dual stack, user might only give IPV6 CIDR for `--service-cidr` and leave the `--apiserver-advertise-address` a default value which will be</span></span><br><span class="line">	<span class="comment">// auto-detected and properly bound to an IPV4 address, this will make the cluster non-functional eventually. The case like this should be avoided by the validation instead,</span></span><br><span class="line">	<span class="comment">// i.e. We don&#x27;t care whether the input values for those parameters are set correctly here but if it&#x27;s an IPV4 scoped CIDR or address we will add the file content check for IPV4,</span></span><br><span class="line">	<span class="comment">// as does the IPV6.</span></span><br><span class="line">	IPV4Check := <span class="literal">false</span></span><br><span class="line">	IPV6Check := <span class="literal">false</span></span><br><span class="line">	cidrs := strings.Split(cfg.Networking.ServiceSubnet, <span class="string">&quot;,&quot;</span>)</span><br><span class="line">	<span class="keyword">for</span> _, cidr := <span class="keyword">range</span> cidrs &#123;</span><br><span class="line">		checks = <span class="built_in">append</span>(checks, HTTPProxyCIDRCheck&#123;Proto: <span class="string">&quot;https&quot;</span>, CIDR: cidr&#125;)</span><br><span class="line">		<span class="keyword">if</span> !IPV4Check &amp;&amp; netutils.IsIPv4CIDRString(cidr) &#123;</span><br><span class="line">			IPV4Check = <span class="literal">true</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> !IPV6Check &amp;&amp; netutils.IsIPv6CIDRString(cidr) &#123;</span><br><span class="line">			IPV6Check = <span class="literal">true</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	cidrs = strings.Split(cfg.Networking.PodSubnet, <span class="string">&quot;,&quot;</span>)</span><br><span class="line">	<span class="keyword">for</span> _, cidr := <span class="keyword">range</span> cidrs &#123;</span><br><span class="line">		checks = <span class="built_in">append</span>(checks, HTTPProxyCIDRCheck&#123;Proto: <span class="string">&quot;https&quot;</span>, CIDR: cidr&#125;)</span><br><span class="line">		<span class="keyword">if</span> !IPV4Check &amp;&amp; netutils.IsIPv4CIDRString(cidr) &#123;</span><br><span class="line">			IPV4Check = <span class="literal">true</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> !IPV6Check &amp;&amp; netutils.IsIPv6CIDRString(cidr) &#123;</span><br><span class="line">			IPV6Check = <span class="literal">true</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> !isSecondaryControlPlane &#123;</span><br><span class="line">		checks = addCommonChecks(execer, cfg.KubernetesVersion, &amp;cfg.NodeRegistration, checks)</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Check if Bridge-netfilter and IPv6 relevant flags are set</span></span><br><span class="line">		<span class="keyword">if</span> ip := netutils.ParseIPSloppy(cfg.LocalAPIEndpoint.AdvertiseAddress); ip != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> !IPV4Check &amp;&amp; netutils.IsIPv4(ip) &#123;</span><br><span class="line">				IPV4Check = <span class="literal">true</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> !IPV6Check &amp;&amp; netutils.IsIPv6(ip) &#123;</span><br><span class="line">				IPV6Check = <span class="literal">true</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> IPV4Check &#123;</span><br><span class="line">			checks = addIPv4Checks(checks)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> IPV6Check &#123;</span><br><span class="line">			checks = addIPv6Checks(checks)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// if using an external etcd</span></span><br><span class="line">		<span class="keyword">if</span> cfg.Etcd.External != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="comment">// Check external etcd version before creating the cluster</span></span><br><span class="line">			checks = <span class="built_in">append</span>(checks, ExternalEtcdVersionCheck&#123;Etcd: cfg.Etcd&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> cfg.Etcd.Local != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="comment">// Only do etcd related checks when required to install a local etcd</span></span><br><span class="line">		checks = <span class="built_in">append</span>(checks,</span><br><span class="line">			PortOpenCheck&#123;port: kubeadmconstants.EtcdListenClientPort&#125;,</span><br><span class="line">			PortOpenCheck&#123;port: kubeadmconstants.EtcdListenPeerPort&#125;,</span><br><span class="line">			DirAvailableCheck&#123;Path: cfg.Etcd.Local.DataDir&#125;,</span><br><span class="line">		)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> cfg.Etcd.External != <span class="literal">nil</span> &amp;&amp; !(isSecondaryControlPlane &amp;&amp; downloadCerts) &#123;</span><br><span class="line">		<span class="comment">// Only check etcd certificates when using an external etcd and not joining with automatic download of certs</span></span><br><span class="line">		<span class="keyword">if</span> cfg.Etcd.External.CAFile != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">			checks = <span class="built_in">append</span>(checks, FileExistingCheck&#123;Path: cfg.Etcd.External.CAFile, Label: <span class="string">&quot;ExternalEtcdClientCertificates&quot;</span>&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> cfg.Etcd.External.CertFile != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">			checks = <span class="built_in">append</span>(checks, FileExistingCheck&#123;Path: cfg.Etcd.External.CertFile, Label: <span class="string">&quot;ExternalEtcdClientCertificates&quot;</span>&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> cfg.Etcd.External.KeyFile != <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">			checks = <span class="built_in">append</span>(checks, FileExistingCheck&#123;Path: cfg.Etcd.External.KeyFile, Label: <span class="string">&quot;ExternalEtcdClientCertificates&quot;</span>&#125;)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> checks, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-NewCertsPhase"><a href="#2-NewCertsPhase" class="headerlink" title="2.NewCertsPhase"></a>2.NewCertsPhase</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes/blob/b43b95aa5741e55b433e785be1df9558b3841091/cmd/kubeadm/app/cmd/phases/init/certs.go#L65C12-L65C12">https://github.com/kubernetes/kubernetes/blob/b43b95aa5741e55b433e785be1df9558b3841091/cmd/kubeadm/app/cmd/phases/init/certs.go#L65C12-L65C12</a></li>
</ul>
<p>在这个阶段，生成了通过自签的CA证书为每一个组件建立身份标识，可以通过其放入<code>--cert-dir</code>（默认&#x2F;etc&#x2F;kubernets&#x2F;pki），来提供它们的CA证书和密钥。</p>
<p>ApiServer证书为 <code>apiserver-cert-extra-sans</code>参数值提供附加的SAN条目 </p>
<p>对DNS进行x509证书签发</p>
<h3 id="3-NewKubeConfigPhase"><a href="#3-NewKubeConfigPhase" class="headerlink" title="3.NewKubeConfigPhase"></a>3.NewKubeConfigPhase</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes/blob/b43b95aa5741e55b433e785be1df9558b3841091/cmd/kubeadm/app/cmd/phases/init/kubeconfig.go#L67">https://github.com/kubernetes/kubernetes/blob/b43b95aa5741e55b433e785be1df9558b3841091/cmd/kubeadm/app/cmd/phases/init/kubeconfig.go#L67</a></li>
</ul>
<p>将kubeconfig文件写入<code>/etc/kubernetes/</code>目录，让kubelet、控制器管理和调度器来连接到API服务器，它们有自己的标识，同时生成一个<code>admin.conf</code>独立的kubeconfig文件，用于管理操作</p>
<h3 id="4-NewEtcdPhase"><a href="#4-NewEtcdPhase" class="headerlink" title="4.NewEtcdPhase"></a>4.NewEtcdPhase</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes/blob/b43b95aa5741e55b433e785be1df9558b3841091/cmd/kubeadm/app/cmd/phases/init/etcd.go#L46">https://github.com/kubernetes/kubernetes/blob/b43b95aa5741e55b433e785be1df9558b3841091/cmd/kubeadm/app/cmd/phases/init/etcd.go#L46</a></li>
</ul>
<p>一些etcd的准备工作和生成配置文件</p>
<h3 id="5-NewControlPlanePhase"><a href="#5-NewControlPlanePhase" class="headerlink" title="5.NewControlPlanePhase"></a>5.NewControlPlanePhase</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes/blob/b43b95aa5741e55b433e785be1df9558b3841091/cmd/kubeadm/app/cmd/phases/init/controlplane.go#L65C6-L65C26">https://github.com/kubernetes/kubernetes/blob/b43b95aa5741e55b433e785be1df9558b3841091/cmd/kubeadm/app/cmd/phases/init/controlplane.go#L65C6-L65C26</a></li>
</ul>
<p> 为控制节点的组件和创建静态pod以及生成文件放在<code>/etc/kubernetes/mainfests</code>下面 </p>
<h3 id="6-NewKubeletStartPhase"><a href="#6-NewKubeletStartPhase" class="headerlink" title="6. NewKubeletStartPhase"></a>6. NewKubeletStartPhase</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes/blob/b43b95aa5741e55b433e785be1df9558b3841091/cmd/kubeadm/app/cmd/phases/init/kubelet.go#L40">https://github.com/kubernetes/kubernetes/blob/b43b95aa5741e55b433e785be1df9558b3841091/cmd/kubeadm/app/cmd/phases/init/kubelet.go#L40</a></li>
</ul>
<ol>
<li>将env的变量写入到<code>/var/lib/kubelet/kubeadm-flags.env</code></li>
<li>配置写入到<code>/var/lib/kubelet/config.yaml</code></li>
<li>启动kubelet</li>
</ol>
<h3 id="7-NewWaitControlPlanePhase"><a href="#7-NewWaitControlPlanePhase" class="headerlink" title="7.NewWaitControlPlanePhase"></a>7.NewWaitControlPlanePhase</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes/blob/b43b95aa5741e55b433e785be1df9558b3841091/cmd/kubeadm/app/cmd/phases/init/waitcontrolplane.go#L59">https://github.com/kubernetes/kubernetes/blob/b43b95aa5741e55b433e785be1df9558b3841091/cmd/kubeadm/app/cmd/phases/init/waitcontrolplane.go#L59</a></li>
</ul>
<ol>
<li>监听<code>/etc/kubernetes/manifest</code>目录，为了创建的时候启动Pod</li>
<li>控制面的Pod起来之后，kubeadm init继续执行</li>
</ol>
<h3 id="8-NewUploadConfigPhase"><a href="#8-NewUploadConfigPhase" class="headerlink" title="8.NewUploadConfigPhase"></a>8.NewUploadConfigPhase</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes/blob/2f270bd99609561be53893d3c7fc77d8efe7ac4e/cmd/kubeadm/app/cmd/phases/init/uploadconfig.go#L63">https://github.com/kubernetes/kubernetes/blob/2f270bd99609561be53893d3c7fc77d8efe7ac4e/cmd/kubeadm/app/cmd/phases/init/uploadconfig.go#L63</a></li>
</ul>
<p>把配置文件上传到K8s ConfigMap ）admin.conf文件</p>
<h3 id="9-NewUploadCertsPhase"><a href="#9-NewUploadCertsPhase" class="headerlink" title="9.*NewUploadCertsPhase"></a>9.*NewUploadCertsPhase</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes/blob/2f270bd99609561be53893d3c7fc77d8efe7ac4e/cmd/kubeadm/app/cmd/phases/init/uploadcerts.go#L31">https://github.com/kubernetes/kubernetes/blob/2f270bd99609561be53893d3c7fc77d8efe7ac4e/cmd/kubeadm/app/cmd/phases/init/uploadcerts.go#L31</a></li>
</ul>
<ol>
<li>需要执行的时候添加<code>--config=kubeadm-config.yaml --upload-certs</code>才会执行这个函数</li>
</ol>
<h3 id="10-NewMarkControlPlanePhase"><a href="#10-NewMarkControlPlanePhase" class="headerlink" title="10.NewMarkControlPlanePhase"></a>10.NewMarkControlPlanePhase</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes/blob/2f270bd99609561be53893d3c7fc77d8efe7ac4e/cmd/kubeadm/app/cmd/phases/init/markcontrolplane.go#L39">https://github.com/kubernetes/kubernetes/blob/2f270bd99609561be53893d3c7fc77d8efe7ac4e/cmd/kubeadm/app/cmd/phases/init/markcontrolplane.go#L39</a></li>
</ul>
<ol>
<li>主要是对控制面的节点应用标签和污点的管理，以便在它上面不会运行一些其他的工作负载均衡</li>
</ol>
<h3 id="11-NewBootstrapTokenPhase"><a href="#11-NewBootstrapTokenPhase" class="headerlink" title="11.NewBootstrapTokenPhase"></a>11.NewBootstrapTokenPhase</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes/blob/2f270bd99609561be53893d3c7fc77d8efe7ac4e/cmd/kubeadm/app/cmd/phases/init/bootstraptoken.go#L48">https://github.com/kubernetes/kubernetes/blob/2f270bd99609561be53893d3c7fc77d8efe7ac4e/cmd/kubeadm/app/cmd/phases/init/bootstraptoken.go#L48</a></li>
</ul>
<ol>
<li>生成token</li>
<li>配置configmap，RBAC角色</li>
<li>配置RBAC，允许节点Bootstrap令牌获取节点</li>
<li>配置RBAC，允许节点Boorstrap令牌发布csr，以便节点获得长期证书</li>
<li>配置RBAC，允许csrapprover控制器节点从节点引导令牌自动批准</li>
<li>配置RBAC，允许集群中所有的节点客户端证书的轮换</li>
<li>在kube-public命名空间中创建cluster-info ConfigMap</li>
</ol>
<h3 id="12-NewKubeletFinalizePhase"><a href="#12-NewKubeletFinalizePhase" class="headerlink" title="12.NewKubeletFinalizePhase"></a>12.NewKubeletFinalizePhase</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes/blob/2f270bd99609561be53893d3c7fc77d8efe7ac4e/cmd/kubeadm/app/cmd/phases/init/kubeletfinalize.go#L46">https://github.com/kubernetes/kubernetes/blob/2f270bd99609561be53893d3c7fc77d8efe7ac4e/cmd/kubeadm/app/cmd/phases/init/kubeletfinalize.go#L46</a></li>
</ul>
<ol>
<li>更新<code>/etc/kubernetes/kubelet.conf</code>指向可运行的kubeley客户端证书和密钥</li>
</ol>
<h3 id="13-NewAddonPhase"><a href="#13-NewAddonPhase" class="headerlink" title="13.NewAddonPhase"></a>13.NewAddonPhase</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes/blob/2f270bd99609561be53893d3c7fc77d8efe7ac4e/cmd/kubeadm/app/cmd/phases/init/addons.go#L49">https://github.com/kubernetes/kubernetes/blob/2f270bd99609561be53893d3c7fc77d8efe7ac4e/cmd/kubeadm/app/cmd/phases/init/addons.go#L49</a></li>
</ul>
<ol>
<li>调用runKubeProxyAddon将KubeProxy插件安装到Kubernetes集群</li>
<li>调用runCoreDNSAddon将CoreDNS插件安装到Kubernetes集群</li>
</ol>
<h3 id="14-NewShowJoinCommandPhase"><a href="#14-NewShowJoinCommandPhase" class="headerlink" title="14.NewShowJoinCommandPhase"></a>14.NewShowJoinCommandPhase</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes/blob/2f270bd99609561be53893d3c7fc77d8efe7ac4e/cmd/kubeadm/app/cmd/phases/init/showjoincommand.go#L71">https://github.com/kubernetes/kubernetes/blob/2f270bd99609561be53893d3c7fc77d8efe7ac4e/cmd/kubeadm/app/cmd/phases/init/showjoincommand.go#L71</a></li>
</ul>
<ol>
<li>打印Join信息</li>
</ol>
<h2 id="kubeadm-Join过程"><a href="#kubeadm-Join过程" class="headerlink" title="kubeadm Join过程"></a>kubeadm Join过程</h2><p>官网教程：<a target="_blank" rel="noopener" href="https://kubernetes.io/zh-cn/docs/reference/setup-tools/kubeadm/kubeadm-join/">https://kubernetes.io/zh-cn/docs/reference/setup-tools/kubeadm/kubeadm-join/</a></p>
<h3 id="1-NewPreflightPhase"><a href="#1-NewPreflightPhase" class="headerlink" title="1.NewPreflightPhase"></a>1.NewPreflightPhase</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes/blob/2f270bd99609561be53893d3c7fc77d8efe7ac4e/cmd/kubeadm/app/cmd/phases/join/controlplaneprepare.go#L46">https://github.com/kubernetes/kubernetes/blob/2f270bd99609561be53893d3c7fc77d8efe7ac4e/cmd/kubeadm/app/cmd/phases/join/controlplaneprepare.go#L46</a><ol>
<li>任何时候都可以通过<code>--ignore-prefight-errors</code>选择跳过某一个项目检查</li>
</ol>
</li>
</ul>
<h3 id="2-NewControlPlanePreparePhase"><a href="#2-NewControlPlanePreparePhase" class="headerlink" title="2.NewControlPlanePreparePhase"></a>2.NewControlPlanePreparePhase</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes/blob/2f270bd99609561be53893d3c7fc77d8efe7ac4e/cmd/kubeadm/app/cmd/phases/join/controlplaneprepare.go#L46">https://github.com/kubernetes/kubernetes/blob/2f270bd99609561be53893d3c7fc77d8efe7ac4e/cmd/kubeadm/app/cmd/phases/join/controlplaneprepare.go#L46</a></li>
</ul>
<h3 id="3-NewCheckEtcdPhase"><a href="#3-NewCheckEtcdPhase" class="headerlink" title="3.NewCheckEtcdPhase"></a>3.NewCheckEtcdPhase</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes/blob/2f270bd99609561be53893d3c7fc77d8efe7ac4e/cmd/kubeadm/app/cmd/phases/join/checketcd.go#L30">https://github.com/kubernetes/kubernetes/blob/2f270bd99609561be53893d3c7fc77d8efe7ac4e/cmd/kubeadm/app/cmd/phases/join/checketcd.go#L30</a></li>
</ul>
<h3 id="4-NewKubeletStartPhase"><a href="#4-NewKubeletStartPhase" class="headerlink" title="4.NewKubeletStartPhase"></a>4.NewKubeletStartPhase</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes/blob/2f270bd99609561be53893d3c7fc77d8efe7ac4e/cmd/kubeadm/app/cmd/phases/init/kubelet.go#L40">https://github.com/kubernetes/kubernetes/blob/2f270bd99609561be53893d3c7fc77d8efe7ac4e/cmd/kubeadm/app/cmd/phases/init/kubelet.go#L40</a></li>
</ul>
<ol>
<li>把配置文件写入<code>/var/lib/kubelet/config.yaml</code></li>
<li>把变量文件flags写入<code>/var/lib/kubelet/kubeadm-flags.env</code></li>
<li>启动kubelet</li>
<li>等待kubelet执行TLS Bootstrap</li>
</ol>
<h3 id="5-NewControlPlaneJoinPhase"><a href="#5-NewControlPlaneJoinPhase" class="headerlink" title="5.NewControlPlaneJoinPhase"></a>5.NewControlPlaneJoinPhase</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/kubernetes/kubernetes/blob/2f270bd99609561be53893d3c7fc77d8efe7ac4e/cmd/kubeadm/app/cmd/phases/join/controlplanejoin.go#L58">https://github.com/kubernetes/kubernetes/blob/2f270bd99609561be53893d3c7fc77d8efe7ac4e/cmd/kubeadm/app/cmd/phases/join/controlplanejoin.go#L58</a></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/Piwriw">Joohwan.</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://piwriw.github.io/2023/10/23/cloud/k8s/kubeadm/%E8%A7%A3%E8%AF%BBKubeadm%E6%BA%90%E7%A0%81/">https://piwriw.github.io/2023/10/23/cloud/k8s/kubeadm/解读Kubeadm源码/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://piwriw.github.io" target="_blank">Joohwan</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/k8s/">k8s</a><a class="post-meta__tags" href="/tags/cloud/">cloud</a><a class="post-meta__tags" href="/tags/kubeadm/">kubeadm</a></div><div class="post-share"><div class="social-share" data-image="/img/kubernetes.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2023/10/24/tools/Homebrew%E5%85%B1%E5%AD%98arm%E5%92%8CX86/" title="Homebrew共存arm和X86（Mac）"><img class="cover" src="/img/basic_read.png" onerror="onerror=null;src='/img/404.png'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Homebrew共存arm和X86（Mac）</div></div><div class="info-2"><div class="info-item-1">Homebrew共存arm和X86背景部分包支持arm，部分支持x86，主要是x86和arm的包的位置不一样 arm安装12345678# 切换到/opt目录cd /opt # 创建homebrew目录sudo mkdir homebrew# 修改目录所属用户sudo chown -R $(whoami) /opt/homebrew # 安装Arm版Homebrewcurl -L https://github.com/Homebrew/brew/tarball/master | tar xz --strip 1 -C homebrew  x86 安装1arch -x86_64 /bin/bash -c &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)&quot;  区分二个版本的brew12345678# x86export PATH=&quot;/usr/local/bin:$PATH&quot;alias  abrew=&#x27;arch -x86...</div></div></div></a><a class="pagination-related" href="/2023/10/13/cloud/k8s/kubemark/%E7%BC%96%E8%AF%91Kubemark/" title="K8s-编译Kubemark"><img class="cover" src="/img/kubernetes.png" onerror="onerror=null;src='/img/404.png'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">K8s-编译Kubemark</div></div><div class="info-2"><div class="info-item-1">编译Kubemark背景Kubemark是k8s虚拟化节点的工具，用于测试。 目前找不到现成可用Kubamark镜像，所以自行编译。 安装12345# gcc 环境准备yum -y install gcc gcc-c++ autoconf pcre pcre-devel make automake                                                                                                                   yum -y install wget httpd-tools vim yum -y install glibc-static.x86_64 yum -y install binutils   Go环境准备： LInuxGo部署过程  源码构建： 123456789101112131415161718# 需要安装gityum install -y git # 拉取k8s代码 git clone https://github.com/kubernetes/kube...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/01/01/cloud/k8s/kubeadm/K8s%E9%9B%86%E7%BE%A4%E7%89%88%E6%9C%AC%E6%9B%B4%E6%96%B0/" title="K8s集群版本更新"><img class="cover" src="/img/kubeadm.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-01</div><div class="info-item-2">K8s集群版本更新</div></div><div class="info-2"><div class="info-item-1">K8s集群版本更新在K8s集群更新，需要考虑不断运行的业务容器运行，通常流程，先更新Master上的K8s服务版本，在逐个更新Node的K8s服务版本 以二进制部署的K8s集群更新更新步骤一般如下：  获取官网的K8s二进制安装包 更新Master的kube-apiserver、kube-controller-manager、kube-scheduler 更新隔离Node，等待全部容器工作停止掉Pod，更新kubelet、kube-proxy 服务文件 恢复业务应用到流量到更新完成的Node上  以Kubeadm部署的K8s集群的版本更新可以通过kubeadm upgrade更新  更新kubeadm 本身 1yum install -y kubeadm-1.21.0 --disableexcludes=kubernetes  查看kubeadm版本，kubeadm version  查看K8s更新的计划，内容,会检查系统的配置 1kubeadm upgrade plan  执行升级 1kubeadm upgrade apply  Node也进行升级 1kubeadm upgra...</div></div></div></a><a class="pagination-related" href="/2024/12/31/cloud/k8s/kubeadm/K8s%E5%AE%89%E8%A3%85-%E5%9F%BA%E4%BA%8Ekubeadm/" title="K8s安装-基于kubeadm"><img class="cover" src="/img/kubeadm.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-31</div><div class="info-item-2">K8s安装-基于kubeadm</div></div><div class="info-2"><div class="info-item-1">K8s安装-基于kubeadm 基于1.29  系统要求   软硬件 最低要求 推荐配置    主机资源 若集群中有1-5个Node：Master：2c+2GB；Node：1c Master：4C和16GB；Node实际运行   Linux Kernel内核在v3.10以上 CoreOS7.9   etcd 版本v3以上 etcdv3   容器运行时 各种cri containerd v1.7   主要注意centos7默认开启防火墙，而K8s和各个Node有大量通信，推荐开启以下端口    组件 默认端口    API Server 6443   Controller Manager 10257   Scheduler 10259   Kubelet 10250；10255(只读端口)   etcd 2379（供客户端访问）；2380（etcd集群节点之间访问）   集群的DNS服务 53（UDP）；53（TCP）   对于其他组件，可能还需要开放其他端口，比如CNI Calico需要开放179端口 123# 关闭防火墙systemctl disable firewalldsy...</div></div></div></a><a class="pagination-related" href="/2025/08/24/cloud/k8s/K8s%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97-%E5%AE%A2%E6%88%B7%E7%AB%AF/" title="K8s开发指南-客户端"><img class="cover" src="/img/k8sLogo.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-24</div><div class="info-item-2">K8s开发指南-客户端</div></div><div class="info-2"><div class="info-item-1">K8s开发指南-客户端 基于K8s v1.29  API客户端 Ref：https://github.com/kubernetes/client-go  K8s认证方式主要一下俩类：  集群外的认证：客户端程序运行在集群外，以独立进程访问API Server 集群内的认证：客户端在K8s内以Pod形式运行，通过内部服务名访问API Server  客户端访问API Server常见的认证方式有以下的几种  数字证书方式 ServiceAccount方式 BearerToken方式  对于运行在K8s集群之外的客户端，建议使用数字证书方式连接API Server，客户端需要配置的信息包括CA根证书、客户端证书、客户段私钥以及API Server地址 对于运行在集群内的Pod，建议使用ServiceAccount认证方式，需要为Pod增加ServiceAccount资源，并为ServiceAccount配置好正确的RBAC权限 基于kubeconfig文件的配置方式有以下几种：  用户HOME目录中的约定目录，例如$HOME&#x2F;.kube&#x2F;config 在环境变量K...</div></div></div></a><a class="pagination-related" href="/2025/08/23/cloud/k8s/K8s%E5%BC%80%E5%8F%91-API%E8%AF%A6%E8%A7%A3/" title="K8s开发-API详解"><img class="cover" src="/img/k8sLogo.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-23</div><div class="info-item-2">K8s开发-API详解</div></div><div class="info-2"><div class="info-item-1">K8s开发-API详解 基于K8s v1.29  资源对象一个K8s资源对象描述一般是kind、apiVersion、metadata、spec和status五个部分 资源对象的类型资源对象的类型用Kind属性表示，总体分为3个类型：  对象（Object）、代表系统中永久资源实体，比如Pod、RC 列表（List）：资源对象的合集 简单类别（Simple）：作用于资源对象或非持久辅助实体的特定操作，比如Status、Scale、ListOptions等  资源对象的元数据metadata是资源对象的元数据定义，由一组属性来定义，在K8s中，每个资源对象都必须包含以下元数据属性：  namespec：对象所属的命名空间，如果不指定，则昔日会将对象置于名为default中 name：对象的名称、在一个ns下，唯一性 uid：系统为每个对象生成唯一的ID，符合RFC4122 labels：自定义标签 annotations：用户自定义注解，被K8s内部进程或者外部工具使用 resourceVersion：用于识别资源内部斑斑的字符串，在Watch操作，可以避免Get和下一次Watch...</div></div></div></a><a class="pagination-related" href="/2025/08/22/cloud/k8s/K8s%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6-%E6%8B%93%E5%B1%95%E8%AE%A4%E8%AF%81/" title="K8s认证机制-拓展认证"><img class="cover" src="/img/k8sLogo.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-22</div><div class="info-item-2">K8s认证机制-拓展认证</div></div><div class="info-2"><div class="info-item-1">K8s认证机制-拓展认证 基于K8s v1.29  OIDC Token认证K8s支持使用OpenID Connect协议进行身份认证。  OIDC协议给予OAuth2.0，构建了身份层，主要提供了ID Token，这是一个JWT格式的Token  流程图：  配置OIDC认证，需要API-Server开启一些参数 WebHook Token认证WebHook认证是K8s回调第三方认证实现用户认证 认证原理：  API Server收到客户端的请求之后，从HTTP Header获取到Bearer Token，然后生成一个包含该Token的TokenReview资源对象 API Server把整个TokenReview对象JSON序列化之后发送给Webhook认证服务器  开启WebHook 认证需要设置API Server启动参数 Authenticating Proxy认证在这种模式下，K8s自身不再对用户认证，而是使用外部认证服务进行用户认证 开启Authenticating Proxy 认证需要设置API Server启动参数 </div></div></div></a><a class="pagination-related" href="/2025/03/27/cloud/k8s/service/K8s-kustomize/" title="K8s-kustomize"><img class="cover" src="/img/k8s-go.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-27</div><div class="info-item-2">K8s-kustomize</div></div><div class="info-2"><div class="info-item-1">K8s-kustomize背景K8s为 减少维护很多YAML文件，选择定义K8s资源，从1.14开始，kustomize默认提供 kustomize提供以下管理各种配置文件：  从其他文件来源生成K8s资源对象 统一为所有资源设置命名空间、Label、注解或者特殊格式的名称 组合不同的资源作为一个应用或者一个管理单元进行整体注解  概述kustomize核心配置是kustomizeation.yaml，这个文件类似于一个一个模版文件，里面定义了相应的操作指令，主要操作指令以及作用如下：  namespace：为所有资源都添加命名空间  namePrefix：要添加到所有资源名称之前的前缀  nameSuffix：要添加到所有资源名称之后的后缀  commonLabels：要添加到所有资源和选择器中的Label  commonAnnoations:要添加到所有资源的注解  resources：列表中的每个条目都会生成资源配置  configMapGenerator：针对列表中的每个条目都会生成一个ConfigMap  secrertGenerator：列表中的每个条目都会生成一个S...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Joohwan.</div><div class="author-info-description">该知道的都知道，不知道的慢慢了解</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">259</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">76</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">60</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/piwriw"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/piwriw" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:piwriw@163.com" target="_blank" title="Email"><i class="fas fa-envelope-open-text"></i></a></div></div><div class="card-widget"><div class="item-headline"><i class="iconfont icat-visitor"></i><span>来访者</span></div><div class="item-content"><div id="welcome-info"></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%A3%E8%AF%BBKubeadm%E6%BA%90%E7%A0%81"><span class="toc-number">1.</span> <span class="toc-text">解读Kubeadm源码</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#kubeadm-init%E8%BF%87%E7%A8%8B"><span class="toc-number">1.1.</span> <span class="toc-text">kubeadm init过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Node%E7%8E%AF%E5%A2%83%E6%A3%80%E6%9F%A5%EF%BC%88pre-fight-check"><span class="toc-number">1.1.1.</span> <span class="toc-text">1. Node环境检查（pre-fight-check)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-NewCertsPhase"><span class="toc-number">1.1.2.</span> <span class="toc-text">2.NewCertsPhase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-NewKubeConfigPhase"><span class="toc-number">1.1.3.</span> <span class="toc-text">3.NewKubeConfigPhase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-NewEtcdPhase"><span class="toc-number">1.1.4.</span> <span class="toc-text">4.NewEtcdPhase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-NewControlPlanePhase"><span class="toc-number">1.1.5.</span> <span class="toc-text">5.NewControlPlanePhase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-NewKubeletStartPhase"><span class="toc-number">1.1.6.</span> <span class="toc-text">6. NewKubeletStartPhase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-NewWaitControlPlanePhase"><span class="toc-number">1.1.7.</span> <span class="toc-text">7.NewWaitControlPlanePhase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-NewUploadConfigPhase"><span class="toc-number">1.1.8.</span> <span class="toc-text">8.NewUploadConfigPhase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-NewUploadCertsPhase"><span class="toc-number">1.1.9.</span> <span class="toc-text">9.*NewUploadCertsPhase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-NewMarkControlPlanePhase"><span class="toc-number">1.1.10.</span> <span class="toc-text">10.NewMarkControlPlanePhase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-NewBootstrapTokenPhase"><span class="toc-number">1.1.11.</span> <span class="toc-text">11.NewBootstrapTokenPhase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-NewKubeletFinalizePhase"><span class="toc-number">1.1.12.</span> <span class="toc-text">12.NewKubeletFinalizePhase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-NewAddonPhase"><span class="toc-number">1.1.13.</span> <span class="toc-text">13.NewAddonPhase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-NewShowJoinCommandPhase"><span class="toc-number">1.1.14.</span> <span class="toc-text">14.NewShowJoinCommandPhase</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kubeadm-Join%E8%BF%87%E7%A8%8B"><span class="toc-number">1.2.</span> <span class="toc-text">kubeadm Join过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-NewPreflightPhase"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.NewPreflightPhase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-NewControlPlanePreparePhase"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.NewControlPlanePreparePhase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-NewCheckEtcdPhase"><span class="toc-number">1.2.3.</span> <span class="toc-text">3.NewCheckEtcdPhase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-NewKubeletStartPhase"><span class="toc-number">1.2.4.</span> <span class="toc-text">4.NewKubeletStartPhase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-NewControlPlaneJoinPhase"><span class="toc-number">1.2.5.</span> <span class="toc-text">5.NewControlPlaneJoinPhase</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2026/01/11/web/gorm/09-logger/" title="Gorm-日志系统模块原理说明"><img src="/img/go.png" onerror="this.onerror=null;this.src='/img/404.png'" alt="Gorm-日志系统模块原理说明"/></a><div class="content"><a class="title" href="/2026/01/11/web/gorm/09-logger/" title="Gorm-日志系统模块原理说明">Gorm-日志系统模块原理说明</a><time datetime="2026-01-11T11:56:27.000Z" title="发表于 2026-01-11 19:56:27">2026-01-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/11/web/gorm/08-migration/" title="Gorm-迁移功能模块原理说明"><img src="/img/go.png" onerror="this.onerror=null;this.src='/img/404.png'" alt="Gorm-迁移功能模块原理说明"/></a><div class="content"><a class="title" href="/2026/01/11/web/gorm/08-migration/" title="Gorm-迁移功能模块原理说明">Gorm-迁移功能模块原理说明</a><time datetime="2026-01-11T10:56:27.000Z" title="发表于 2026-01-11 18:56:27">2026-01-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/11/web/gorm/10-plugin/" title="Gorm-插件系统模块原理说明"><img src="/img/go.png" onerror="this.onerror=null;this.src='/img/404.png'" alt="Gorm-插件系统模块原理说明"/></a><div class="content"><a class="title" href="/2026/01/11/web/gorm/10-plugin/" title="Gorm-插件系统模块原理说明">Gorm-插件系统模块原理说明</a><time datetime="2026-01-11T10:56:27.000Z" title="发表于 2026-01-11 18:56:27">2026-01-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/11/web/gorm/07-transaction/" title="Gorm-事务处理模块原理说明"><img src="/img/go.png" onerror="this.onerror=null;this.src='/img/404.png'" alt="Gorm-事务处理模块原理说明"/></a><div class="content"><a class="title" href="/2026/01/11/web/gorm/07-transaction/" title="Gorm-事务处理模块原理说明">Gorm-事务处理模块原理说明</a><time datetime="2026-01-11T09:56:27.000Z" title="发表于 2026-01-11 17:56:27">2026-01-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/11/web/gorm/06-associations/" title="Gorm-关联关系模块原理说明"><img src="/img/go.png" onerror="this.onerror=null;this.src='/img/404.png'" alt="Gorm-关联关系模块原理说明"/></a><div class="content"><a class="title" href="/2026/01/11/web/gorm/06-associations/" title="Gorm-关联关系模块原理说明">Gorm-关联关系模块原理说明</a><time datetime="2026-01-11T08:56:27.000Z" title="发表于 2026-01-11 16:56:27">2026-01-11</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2023 - 2026 By Joohwan.</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://piwriw-twikoo-git-main-piwriw.vercel.app/',
      region: 'ap-shanghai',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://piwriw-twikoo-git-main-piwriw.vercel.app/',
      region: 'ap-shanghai',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script src="/js/categories.js" defer></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>