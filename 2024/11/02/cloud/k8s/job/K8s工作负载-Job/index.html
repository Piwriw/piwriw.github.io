<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>K8s工作负载-Job | Joohwan</title><meta name="author" content="Joohwan."><meta name="copyright" content="Joohwan."><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="K8s工作负载-Job 基于1.25  什么是JobJob会创建一个或多个Pod，并持续重试Pod的执行，直至指定数量的Pod成功终止  随着Pod成功终止，Job会记录成功的Pod个数，Pod到达指定数量，Job终止 删除Job，会删除Job的所有Pod  JobSpec Ref:https:&#x2F;&#x2F;github.com&#x2F;kubernetes&#x2F;api&#x2F;blob&#x2F;f7b7ea4f0fcc6cb8c8d">
<meta property="og:type" content="article">
<meta property="og:title" content="K8s工作负载-Job">
<meta property="og:url" content="https://piwriw.github.io/2024/11/02/cloud/k8s/job/K8s%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD-Job/index.html">
<meta property="og:site_name" content="Joohwan">
<meta property="og:description" content="K8s工作负载-Job 基于1.25  什么是JobJob会创建一个或多个Pod，并持续重试Pod的执行，直至指定数量的Pod成功终止  随着Pod成功终止，Job会记录成功的Pod个数，Pod到达指定数量，Job终止 删除Job，会删除Job的所有Pod  JobSpec Ref:https:&#x2F;&#x2F;github.com&#x2F;kubernetes&#x2F;api&#x2F;blob&#x2F;f7b7ea4f0fcc6cb8c8d">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://piwriw.github.io/img/k8sLogo.png">
<meta property="article:published_time" content="2024-11-02T06:08:55.000Z">
<meta property="article:modified_time" content="2026-02-28T13:29:12.666Z">
<meta property="article:author" content="Joohwan.">
<meta property="article:tag" content="k8s">
<meta property="article:tag" content="cloud">
<meta property="article:tag" content="K8s源码">
<meta property="article:tag" content="job">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://piwriw.github.io/img/k8sLogo.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "K8s工作负载-Job",
  "url": "https://piwriw.github.io/2024/11/02/cloud/k8s/job/K8s%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD-Job/",
  "image": "https://piwriw.github.io/img/k8sLogo.png",
  "datePublished": "2024-11-02T06:08:55.000Z",
  "dateModified": "2026-02-28T13:29:12.666Z",
  "author": [
    {
      "@type": "Person",
      "name": "Joohwan.",
      "url": "https://github.com/Piwriw"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://piwriw.github.io/2024/11/02/cloud/k8s/job/K8s%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD-Job/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'K8s工作负载-Job',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><script src="/js/welcome.js"></script><script src="https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js"></script><link rel="stylesheet" href="/css/categories.css"><link rel="stylesheet" href="/css/tabs.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">259</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">76</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">60</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/charts/"><i class="fa-fw fas fa-folder-open"></i><span> 文章统计</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div><div class="menus_item"><a class="site-page" href="/wish/"><i class="fa-fw fas fa-tags"></i><span> 许愿墙</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/k8sLogo.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Joohwan</span></a><a class="nav-page-title" href="/"><span class="site-name">K8s工作负载-Job</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/charts/"><i class="fa-fw fas fa-folder-open"></i><span> 文章统计</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div><div class="menus_item"><a class="site-page" href="/wish/"><i class="fa-fw fas fa-tags"></i><span> 许愿墙</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">K8s工作负载-Job</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-11-02T06:08:55.000Z" title="发表于 2024-11-02 14:08:55">2024-11-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-02-28T13:29:12.666Z" title="更新于 2026-02-28 21:29:12">2026-02-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud/">cloud</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud/k8s/">k8s</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud/k8s/job/">job</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">2.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>11分钟</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2026-02-28 21:29:12&quot;}" hidden></div><h1 id="K8s工作负载-Job"><a href="#K8s工作负载-Job" class="headerlink" title="K8s工作负载-Job"></a>K8s工作负载-Job</h1><blockquote>
<p>基于1.25</p>
</blockquote>
<h2 id="什么是Job"><a href="#什么是Job" class="headerlink" title="什么是Job"></a>什么是Job</h2><p>Job会创建一个或多个Pod，并持续重试Pod的执行，直至指定数量的Pod成功终止</p>
<ul>
<li>随着Pod成功终止，Job会记录成功的Pod个数，Pod到达指定数量，Job终止</li>
<li>删除Job，会删除Job的所有Pod</li>
</ul>
<h2 id="JobSpec"><a href="#JobSpec" class="headerlink" title="JobSpec"></a>JobSpec</h2><ul>
<li>Ref:<a target="_blank" rel="noopener" href="https://github.com/kubernetes/api/blob/f7b7ea4f0fcc6cb8c8dd42eb46a94c7e163d1b9d/batch/v1/types.go#L206">https://github.com/kubernetes/api/blob/f7b7ea4f0fcc6cb8c8dd42eb46a94c7e163d1b9d/batch/v1/types.go#L206</a></li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JobSpec describes how the job execution will look like.</span></span><br><span class="line"><span class="keyword">type</span> JobSpec <span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Specifies the maximum desired number of pods the job should</span></span><br><span class="line">	<span class="comment">// run at any given time. The actual number of pods running in steady state will</span></span><br><span class="line">	<span class="comment">// be less than this number when ((.spec.completions - .status.successful) &lt; .spec.parallelism),</span></span><br><span class="line">	<span class="comment">// i.e. when the work left to do is less than max parallelism.</span></span><br><span class="line">	<span class="comment">// More info: https://kubernetes.io/docs/concepts/workloads/controllers/jobs-run-to-completion/</span></span><br><span class="line">	<span class="comment">// +optional</span></span><br><span class="line">  <span class="comment">// 并行度，给指定Job 在任何给定时间的最大所需的Pod数量</span></span><br><span class="line">	Parallelism *<span class="type">int32</span> <span class="string">`json:&quot;parallelism,omitempty&quot; protobuf:&quot;varint,1,opt,name=parallelism&quot;`</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Specifies the desired number of successfully finished pods the</span></span><br><span class="line">	<span class="comment">// job should be run with.  Setting to nil means that the success of any</span></span><br><span class="line">	<span class="comment">// pod signals the success of all pods, and allows parallelism to have any positive</span></span><br><span class="line">	<span class="comment">// value.  Setting to 1 means that parallelism is limited to 1 and the success of that</span></span><br><span class="line">	<span class="comment">// pod signals the success of the job.</span></span><br><span class="line">	<span class="comment">// More info: https://kubernetes.io/docs/concepts/workloads/controllers/jobs-run-to-completion/</span></span><br><span class="line">	<span class="comment">// +optional</span></span><br><span class="line">  <span class="comment">// 完成数量，指定作业允许的成功完成的Pod数量</span></span><br><span class="line">	Completions *<span class="type">int32</span> <span class="string">`json:&quot;completions,omitempty&quot; protobuf:&quot;varint,2,opt,name=completions&quot;`</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Specifies the duration in seconds relative to the startTime that the job</span></span><br><span class="line">	<span class="comment">// may be continuously active before the system tries to terminate it; value</span></span><br><span class="line">	<span class="comment">// must be positive integer. If a Job is suspended (at creation or through an</span></span><br><span class="line">	<span class="comment">// update), this timer will effectively be stopped and reset when the Job is</span></span><br><span class="line">	<span class="comment">// resumed again.</span></span><br><span class="line">	<span class="comment">// +optional</span></span><br><span class="line">  <span class="comment">// Job允许的最长耗时 挂起暂停计时 必须是正数</span></span><br><span class="line">	ActiveDeadlineSeconds *<span class="type">int64</span> <span class="string">`json:&quot;activeDeadlineSeconds,omitempty&quot; protobuf:&quot;varint,3,opt,name=activeDeadlineSeconds&quot;`</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Specifies the policy of handling failed pods. In particular, it allows to</span></span><br><span class="line">	<span class="comment">// specify the set of actions and conditions which need to be</span></span><br><span class="line">	<span class="comment">// satisfied to take the associated action.</span></span><br><span class="line">	<span class="comment">// If empty, the default behaviour applies - the counter of failed pods,</span></span><br><span class="line">	<span class="comment">// represented by the jobs&#x27;s .status.failed field, is incremented and it is</span></span><br><span class="line">	<span class="comment">// checked against the backoffLimit. This field cannot be used in combination</span></span><br><span class="line">	<span class="comment">// with restartPolicy=OnFailure.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// This field is alpha-level. To use this field, you must enable the</span></span><br><span class="line">	<span class="comment">// `JobPodFailurePolicy` feature gate (disabled by default).</span></span><br><span class="line">	<span class="comment">// +optional</span></span><br><span class="line">  <span class="comment">// 指定处理Pod的策略</span></span><br><span class="line">  <span class="comment">// 如果为空，默认行为，由Job的.status.failed字段表示失败Pod计数器增加</span></span><br><span class="line">	PodFailurePolicy *PodFailurePolicy <span class="string">`json:&quot;podFailurePolicy,omitempty&quot; protobuf:&quot;bytes,11,opt,name=podFailurePolicy&quot;`</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Specifies the number of retries before marking this job failed.</span></span><br><span class="line">	<span class="comment">// Defaults to 6</span></span><br><span class="line">	<span class="comment">// +optional</span></span><br><span class="line">  <span class="comment">// 重试次数</span></span><br><span class="line">	BackoffLimit *<span class="type">int32</span> <span class="string">`json:&quot;backoffLimit,omitempty&quot; protobuf:&quot;varint,7,opt,name=backoffLimit&quot;`</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// TODO enabled it when https://github.com/kubernetes/kubernetes/issues/28486 has been fixed</span></span><br><span class="line">	<span class="comment">// Optional number of failed pods to retain.</span></span><br><span class="line">	<span class="comment">// +optional</span></span><br><span class="line">	<span class="comment">// FailedPodsLimit *int32 `json:&quot;failedPodsLimit,omitempty&quot; protobuf:&quot;varint,9,opt,name=failedPodsLimit&quot;`</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// A label query over pods that should match the pod count.</span></span><br><span class="line">	<span class="comment">// Normally, the system sets this field for you.</span></span><br><span class="line">	<span class="comment">// More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#label-selectors</span></span><br><span class="line">	<span class="comment">// +optional</span></span><br><span class="line">  <span class="comment">// 标签选择器</span></span><br><span class="line">	Selector *metav1.LabelSelector <span class="string">`json:&quot;selector,omitempty&quot; protobuf:&quot;bytes,4,opt,name=selector&quot;`</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// manualSelector controls generation of pod labels and pod selectors.</span></span><br><span class="line">	<span class="comment">// Leave `manualSelector` unset unless you are certain what you are doing.</span></span><br><span class="line">	<span class="comment">// When false or unset, the system pick labels unique to this job</span></span><br><span class="line">	<span class="comment">// and appends those labels to the pod template.  When true,</span></span><br><span class="line">	<span class="comment">// the user is responsible for picking unique labels and specifying</span></span><br><span class="line">	<span class="comment">// the selector.  Failure to pick a unique label may cause this</span></span><br><span class="line">	<span class="comment">// and other jobs to not function correctly.  However, You may see</span></span><br><span class="line">	<span class="comment">// `manualSelector=true` in jobs that were created with the old `extensions/v1beta1`</span></span><br><span class="line">	<span class="comment">// API.</span></span><br><span class="line">	<span class="comment">// More info: https://kubernetes.io/docs/concepts/workloads/controllers/jobs-run-to-completion/#specifying-your-own-pod-selector</span></span><br><span class="line">	<span class="comment">// +optional</span></span><br><span class="line">  <span class="comment">// 配置子开启自定义的Selector功能</span></span><br><span class="line">	ManualSelector *<span class="type">bool</span> <span class="string">`json:&quot;manualSelector,omitempty&quot; protobuf:&quot;varint,5,opt,name=manualSelector&quot;`</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Describes the pod that will be created when executing a job.</span></span><br><span class="line">	<span class="comment">// More info: https://kubernetes.io/docs/concepts/workloads/controllers/jobs-run-to-completion/</span></span><br><span class="line">  <span class="comment">// 对应的Pod参数</span></span><br><span class="line">	Template corev1.PodTemplateSpec <span class="string">`json:&quot;template&quot; protobuf:&quot;bytes,6,opt,name=template&quot;`</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// ttlSecondsAfterFinished limits the lifetime of a Job that has finished</span></span><br><span class="line">	<span class="comment">// execution (either Complete or Failed). If this field is set,</span></span><br><span class="line">	<span class="comment">// ttlSecondsAfterFinished after the Job finishes, it is eligible to be</span></span><br><span class="line">	<span class="comment">// automatically deleted. When the Job is being deleted, its lifecycle</span></span><br><span class="line">	<span class="comment">// guarantees (e.g. finalizers) will be honored. If this field is unset,</span></span><br><span class="line">	<span class="comment">// the Job won&#x27;t be automatically deleted. If this field is set to zero,</span></span><br><span class="line">	<span class="comment">// the Job becomes eligible to be deleted immediately after it finishes.</span></span><br><span class="line">	<span class="comment">// +optional</span></span><br><span class="line">  <span class="comment">// 限制已完成执行（完成或失败）的作业的生命周期</span></span><br><span class="line">  <span class="comment">// 在这个时间结束之后，自动被删除Pod</span></span><br><span class="line">  <span class="comment">// 默认不设置，不会删除Pod</span></span><br><span class="line">	TTLSecondsAfterFinished *<span class="type">int32</span> <span class="string">`json:&quot;ttlSecondsAfterFinished,omitempty&quot; protobuf:&quot;varint,8,opt,name=ttlSecondsAfterFinished&quot;`</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// CompletionMode specifies how Pod completions are tracked. It can be</span></span><br><span class="line">	<span class="comment">// `NonIndexed` (default) or `Indexed`.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// `NonIndexed` means that the Job is considered complete when there have</span></span><br><span class="line">	<span class="comment">// been .spec.completions successfully completed Pods. Each Pod completion is</span></span><br><span class="line">	<span class="comment">// homologous to each other.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// `Indexed` means that the Pods of a</span></span><br><span class="line">	<span class="comment">// Job get an associated completion index from 0 to (.spec.completions - 1),</span></span><br><span class="line">	<span class="comment">// available in the annotation batch.kubernetes.io/job-completion-index.</span></span><br><span class="line">	<span class="comment">// The Job is considered complete when there is one successfully completed Pod</span></span><br><span class="line">	<span class="comment">// for each index.</span></span><br><span class="line">	<span class="comment">// When value is `Indexed`, .spec.completions must be specified and</span></span><br><span class="line">	<span class="comment">// `.spec.parallelism` must be less than or equal to 10^5.</span></span><br><span class="line">	<span class="comment">// In addition, The Pod name takes the form</span></span><br><span class="line">	<span class="comment">// `$(job-name)-$(index)-$(random-string)`,</span></span><br><span class="line">	<span class="comment">// the Pod hostname takes the form `$(job-name)-$(index)`.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// More completion modes can be added in the future.</span></span><br><span class="line">	<span class="comment">// If the Job controller observes a mode that it doesn&#x27;t recognize, which</span></span><br><span class="line">	<span class="comment">// is possible during upgrades due to version skew, the controller</span></span><br><span class="line">	<span class="comment">// skips updates for the Job.</span></span><br><span class="line">	<span class="comment">// +optional</span></span><br><span class="line">  <span class="comment">// 如何跟踪Pod，可以设置为NonIndexed 或 Indexed</span></span><br><span class="line">  <span class="comment">// 默认NonIndexe：当Pod数量到达.spec.completions Job被认为成功</span></span><br><span class="line">  <span class="comment">// Indexed：Job的所有从0～.spec.completions-1的索引，每一个Podc成功，Job才成功</span></span><br><span class="line">	CompletionMode *CompletionMode <span class="string">`json:&quot;completionMode,omitempty&quot; protobuf:&quot;bytes,9,opt,name=completionMode,casttype=CompletionMode&quot;`</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Suspend specifies whether the Job controller should create Pods or not. If</span></span><br><span class="line">	<span class="comment">// a Job is created with suspend set to true, no Pods are created by the Job</span></span><br><span class="line">	<span class="comment">// controller. If a Job is suspended after creation (i.e. the flag goes from</span></span><br><span class="line">	<span class="comment">// false to true), the Job controller will delete all active Pods associated</span></span><br><span class="line">	<span class="comment">// with this Job. Users must design their workload to gracefully handle this.</span></span><br><span class="line">	<span class="comment">// Suspending a Job will reset the StartTime field of the Job, effectively</span></span><br><span class="line">	<span class="comment">// resetting the ActiveDeadlineSeconds timer too. Defaults to false.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// +optional</span></span><br><span class="line">  <span class="comment">// 配置挂起一个Job，挂起操作会删除所有允许中的Pod，并且重新设置JOb的StartTime，暂停ActiveDeadlineSeconds 计时器</span></span><br><span class="line">	Suspend *<span class="type">bool</span> <span class="string">`json:&quot;suspend,omitempty&quot; protobuf:&quot;varint,10,opt,name=suspend&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Job的并发"><a href="#Job的并发" class="headerlink" title="Job的并发"></a>Job的并发</h2><p>可以分成三个角度：无并发、指定完成数量和工作对列</p>
<h3 id="无并发"><a href="#无并发" class="headerlink" title="无并发"></a>无并发</h3><ul>
<li>同一时间只启动一个Pod，这个Podfailed下才会启动另外一个Pod</li>
<li>有一个Pod启动成功，整个Job退出</li>
<li>不需要啊设置i<code>.spec.completions</code>和<code>.spec.parallelism</code>,使用了默认值1</li>
</ul>
<h3 id="完成指定数量"><a href="#完成指定数量" class="headerlink" title="完成指定数量"></a>完成指定数量</h3><ul>
<li><code>.spec.completions</code>设置为正数</li>
<li>成功的Pod数量达到<code>.spec.completions</code>,整个Job结束</li>
<li>可以指定<code>spec.completionMode=Indexed</code>,这个时候PodName有编号，从0开始<ul>
<li>Pod自动添加<code>batch.kubernetes.io/jon-completion-index</code>注解和<code>JOB_COMPLETION_INDEX=job-completions-index</code>环境变量</li>
</ul>
</li>
<li>设置了<code>.spec.completion</code>后，可以选择<code>.spec.parallelism</code>控制并发度<ul>
<li>completion设置为10，spec.parallelism设置3：Job在10个Pod成功之前， 尽量保持并发为3</li>
</ul>
</li>
</ul>
<h3 id="工作对列"><a href="#工作对列" class="headerlink" title="工作对列"></a>工作对列</h3><ul>
<li>不指定<code>.spec.completions</code>,<code>.spec.parallelism</code>设置为一个非负数</li>
<li>通过MQ方式管理工作对列，每个Pod独立工作，判断整个任务是否完成；一个Pod成功退出，Job结束，不创建新的Pod</li>
</ul>
<h2 id="索引Job"><a href="#索引Job" class="headerlink" title="索引Job"></a>索引Job</h2><p>通过设置<code>Indexed Pod</code></p>
<ul>
<li>Ref:<a target="_blank" rel="noopener" href="https://v1-27.docs.kubernetes.io/zh-cn/docs/tasks/job/indexed-parallel-processing-static/">https://v1-27.docs.kubernetes.io/zh-cn/docs/tasks/job/indexed-parallel-processing-static/</a></li>
</ul>
<h2 id="自定义Pod失效策略"><a href="#自定义Pod失效策略" class="headerlink" title="自定义Pod失效策略"></a>自定义Pod失效策略</h2><p>Pod FailurePolicy 是1.25新增的alpha特性，描述了失败的Pod如何Backofflimt</p>
<ul>
<li>背景：运行多节点的多Pod的Job需要设置Pod重启，实现基础设施故障问题；传统的K8s使用Backofflimte&gt;0策略，会直接导致所有的Pod重启，造成资源浪费</li>
<li>允许一些基础设施引发的Pod问题，在不增加Backofflimt计数期的情况下，重试</li>
</ul>
<p>好处：</p>
<ul>
<li>避免不必要的Pod重启</li>
<li>避免Pod的干扰（如抢占、API发起的驱逐或者基于污点的驱逐）造成Job失败</li>
<li>Ref:<a target="_blank" rel="noopener" href="https://github.com/kubernetes/api/blob/f7b7ea4f0fcc6cb8c8dd42eb46a94c7e163d1b9d/batch/v1/types.go#L169">https://github.com/kubernetes/api/blob/f7b7ea4f0fcc6cb8c8dd42eb46a94c7e163d1b9d/batch/v1/types.go#L169</a></li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PodFailurePolicyRule describes how a pod failure is handled when the requirements are met.</span></span><br><span class="line"><span class="comment">// One of OnExitCodes and onPodConditions, but not both, can be used in each rule.</span></span><br><span class="line"><span class="keyword">type</span> PodFailurePolicyRule <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// Specifies the action taken on a pod failure when the requirements are satisfied.</span></span><br><span class="line">	<span class="comment">// Possible values are:</span></span><br><span class="line">	<span class="comment">// - FailJob: indicates that the pod&#x27;s job is marked as Failed and all</span></span><br><span class="line">	<span class="comment">//   running pods are terminated.</span></span><br><span class="line">	<span class="comment">// - Ignore: indicates that the counter towards the .backoffLimit is not</span></span><br><span class="line">	<span class="comment">//   incremented and a replacement pod is created.</span></span><br><span class="line">	<span class="comment">// - Count: indicates that the pod is handled in the default way - the</span></span><br><span class="line">	<span class="comment">//   counter towards the .backoffLimit is incremented.</span></span><br><span class="line">	<span class="comment">// Additional values are considered to be added in the future. Clients should</span></span><br><span class="line">	<span class="comment">// react to an unknown action by skipping the rule.</span></span><br><span class="line">  <span class="comment">// 指定满足要求时对失败的Pod采取的操作</span></span><br><span class="line">  <span class="comment">// 可以设置为 三种</span></span><br><span class="line">  <span class="comment">// FailedJob：表示Pod被标记为失败，所有的Pod终止</span></span><br><span class="line">  <span class="comment">// Ingnore: 表示BackLimit 计数器没有递增，创建一个新的Pod替代</span></span><br><span class="line">  <span class="comment">// Count: 默认的方式处理Pod BackLimit计数器增加</span></span><br><span class="line">	Action PodFailurePolicyAction <span class="string">`json:&quot;action&quot; protobuf:&quot;bytes,1,req,name=action&quot;`</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Represents the requirement on the container exit codes.</span></span><br><span class="line">	<span class="comment">// +optional</span></span><br><span class="line">  <span class="comment">// 容器退出码要求</span></span><br><span class="line">	OnExitCodes *PodFailurePolicyOnExitCodesRequirement <span class="string">`json:&quot;onExitCodes&quot; protobuf:&quot;bytes,2,opt,name=onExitCodes&quot;`</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Represents the requirement on the pod conditions. The requirement is represented</span></span><br><span class="line">	<span class="comment">// as a list of pod condition patterns. The requirement is satisfied if at</span></span><br><span class="line">	<span class="comment">// least one pattern matches an actual pod condition. At most 20 elements are allowed.</span></span><br><span class="line">	<span class="comment">// +listType=atomic</span></span><br><span class="line">	<span class="comment">// +optional</span></span><br><span class="line">  <span class="comment">// 表述容器匹配的条件，最多允许20个元素</span></span><br><span class="line">	OnPodConditions []PodFailurePolicyOnPodConditionsPattern <span class="string">`json:&quot;onPodConditions&quot; protobuf:&quot;bytes,3,opt,name=onPodConditions&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PodFailurePolicy describes how failed pods influence the backoffLimit.</span></span><br><span class="line"><span class="keyword">type</span> PodFailurePolicy <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// A list of pod failure policy rules. The rules are evaluated in order.</span></span><br><span class="line">	<span class="comment">// Once a rule matches a Pod failure, the remaining of the rules are ignored.</span></span><br><span class="line">	<span class="comment">// When no rule matches the Pod failure, the default handling applies - the</span></span><br><span class="line">	<span class="comment">// counter of pod failures is incremented and it is checked against</span></span><br><span class="line">	<span class="comment">// the backoffLimit. At most 20 elements are allowed.</span></span><br><span class="line">	<span class="comment">// +listType=atomic</span></span><br><span class="line">	Rules []PodFailurePolicyRule <span class="string">`json:&quot;rules&quot; protobuf:&quot;bytes,1,opt,name=rules&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="已经完成Job的TTL机制"><a href="#已经完成Job的TTL机制" class="headerlink" title="已经完成Job的TTL机制"></a>已经完成Job的TTL机制</h2><p>Job默认删除策略：OrphanDependents，<strong>K8s会保留这些Pod</strong></p>
<p>设置Job的TTLSecondsAffterFinished字段，TTL会自动清理已经结束的资源</p>
<ul>
<li>删除Job对象，会级联删除依赖的对象</li>
<li>如果设置为0，Job完成之后立即自动删除</li>
<li>不设置不会自动删除</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/Piwriw">Joohwan.</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://piwriw.github.io/2024/11/02/cloud/k8s/job/K8s%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD-Job/">https://piwriw.github.io/2024/11/02/cloud/k8s/job/K8s工作负载-Job/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://piwriw.github.io" target="_blank">Joohwan</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/k8s/">k8s</a><a class="post-meta__tags" href="/tags/cloud/">cloud</a><a class="post-meta__tags" href="/tags/K8s%E6%BA%90%E7%A0%81/">K8s源码</a><a class="post-meta__tags" href="/tags/job/">job</a></div><div class="post-share"><div class="social-share" data-image="/img/k8sLogo.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2024/11/02/cloud/k8s/cronjob/K8s%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD-CronJob/" title="K8s工作负载-CronJob"><img class="cover" src="/img/k8sLogo.png" onerror="onerror=null;src='/img/404.png'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">K8s工作负载-CronJob</div></div><div class="info-2"><div class="info-item-1">K8s工作负载-CronJob 1.25  什么是CronJobCronJob按照预定时间计划创建Job CronJob的限制CronJob在时间计划中执行，但是Job依旧还可能失败，所以Job不是唯一的，因此Job必须是幂等的，当满足以下俩个条件，Job至少运行一次  StartingDeadlineSeconds：设置为一个较大的值，或者不设置该值（有默认值） ConcurrencyPolicy：设置为Allow 如果设置了StaringDeadlineSeconds，CronJob控制器按照从StaringDeadlineSeconds之前到现在为止的时间段计算错过的执行次数    CronJobSpec Ref:https://github.com/kubernetes/api/blob/f7b7ea4f0fcc6cb8c8dd42eb46a94c7e163d1b9d/batch/v1/types.go#L504  1234567891011121314151617181920212223242526272829303132333435363738394041424344...</div></div></div></a><a class="pagination-related" href="/2024/11/02/cloud/k8s/daemonset/K8s%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD-DaemonSet/" title="K8s工作负载-DaemonSet"><img class="cover" src="/img/k8sLogo.png" onerror="onerror=null;src='/img/404.png'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">K8s工作负载-DaemonSet</div></div><div class="info-2"><div class="info-item-1">K8s工作负载-DaemonSet 基于1.25  什么是DaemonSetDaemonSet 控制器确保所有（或一部分）的节点都运行了一个指定的 Pod 副本，缩写DS 使用场景 在每个节点上运行集群的存储守护进程，例如 glusterd、ceph 在每个节点上运行日志收集守护进程，例如 fluentd、logstash 在每个节点上运行监控守护进程，例如 Prometheus Node Exporter (opens new window)、Sysdig Agent (opens new window)、collectd、Dynatrace OneAgent (opens new window)、APPDynamics Agent (opens new window)、Datadog agent (opens new window)、New Relic agent (opens new window)、Ganglia gmond、Instana Agent (opens new window)等  DaemonSetSpec Ref:https://github.com/ku...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/03/15/cloud/k8s/job/K8sController-Job(%E6%89%B9%E5%A4%84%E7%90%86%E4%BB%BB%E5%8A%A1)/" title="K8sController-Job(批处理任务)"><img class="cover" src="/img/k8sLogo.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-15</div><div class="info-item-2">K8sController-Job(批处理任务)</div></div><div class="info-2"><div class="info-item-1">K8sController-Job(批处理任务) 基于K8s 1.31  主要配置和工作机制123456789101112131415161718192021222324252627282930313233343536apiVersion: batch/v1kind: Jobmetadata:  name: hellospec:  # 可以并行任务数量，默认1  parallelism: 3  completions: 3  # Pod完成模式，NonIndexed（数量达到completions推出，默认），Indexed  # Indexed模式：会被设置为Pod服务名  # - 设置Pod名称：&lt;Job Name&gt;-&lt;索引序号&gt;-&lt;随机字符串&gt;  # - 设置Annotation &quot;batch.kubernetes.io/job-completion-index&quot;: &lt;索引序号&gt;  # - 设置Label &quot;batch.kubernetes.io/job-completion-index&quot...</div></div></div></a><a class="pagination-related" href="/2025/03/17/cloud/k8s/job/K8sController-CronJob(%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1)/" title="K8sController-CronJob(定时任务)"><img class="cover" src="/img/k8s-go.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-17</div><div class="info-item-2">K8sController-CronJob(定时任务)</div></div><div class="info-2"><div class="info-item-1">K8sController-CronJob(定时任务) 基于K8s v1.31  Cron Job支持用于每隔一段时间创建定期运行的批处理任务 CronJob定时表达式12345678910# ┌───────────── 分钟 (0 - 59)# │ ┌───────────── 小时 (0 - 23)# │ │ ┌───────────── 月的某天 (1 - 31)# │ │ │ ┌───────────── 月份 (1 - 12)# │ │ │ │ ┌───────────── 周的某天 (0 - 6)（周日到周六）# │ │ │ │ │                          或者是 sun，mon，tue，web，thu，fri，sat# │ │ │ │ │# │ │ │ │ │# * * * * *Minutes Hours DayofMonth Month DayofWeek   Minutes: , - * &#x2F; 或者0-59的整数  Hours： , - * &#x2F; 或者0-23的整数  DayofMonth： , - * &#x2F;...</div></div></div></a><a class="pagination-related" href="/2024/12/16/cloud/k8s/kubelet/K8s-kubelet(HTTP%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3)/" title="K8s-kubelet(HTTP服务接口)"><img class="cover" src="/img/k8sLogo.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-16</div><div class="info-item-2">K8s-kubelet(HTTP服务接口)</div></div><div class="info-2"><div class="info-item-1">K8s-kubelet(HTTP服务接口) 基于1.25  kubelet通过HTTP Server对外暴露API，为了确保接口安全，kubelet按照安全等级从低到高顺序支持3种HTTP Server，分别是healthz server、readonly server和kubelet core server    一级类目 二级类目 Path路径 描述    Default Handlerers healthz &#x2F;healthz 检查kubelet是否健康，重点检查syncLoop是否持续在规定时间内完成。检查syncLoop四因为其他组件故障会间接导致syncLoop不能执行成功   Default Handlerers pods &#x2F;pods 读取当前节点运行的Pod列表（通过PodManager获取）   Default Handlerers stats &#x2F;stats&#x2F;summary 读取资源使用状态   Default Handlerers metrics &#x2F;metrics 读取kubelet监控指标数据   Defaul...</div></div></div></a><a class="pagination-related" href="/2024/12/15/cloud/k8s/kubelet/K8s-kubelet(PLEG%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86)/" title="K8s-kubelet(PLEG核心原理)"><img class="cover" src="/img/k8sLogo.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-15</div><div class="info-item-2">K8s-kubelet(PLEG核心原理)</div></div><div class="info-2"><div class="info-item-1">K8s-kubelet(PLEG核心原理) 基于1.25  PLEG是kubelet的一个重要组件，负责监控kubelet管理的节点运行的Pod的生命周期，并生成于生命周期相关的事件 PLEG产生原因在K8s中，kubelet负责维护和管理每个节点上的Pod，不断的调谐Pod的状态以使得符合Spec。  为了实现这个目标，kubelet同时需要支持对Pod Spec和Container Status 的事件监听。对于前者kubelet通过watch不同源的对PodSpec事件实现，对于后者，PLEG之前，不断需要Pod处理协程不断的周期性拉取最新状态，尝试了大量轮询压力。 在kubeletv1.2.0版本引入了PLEG，目标是改善kubelet的可拓展性 减少不必要的处理操作（当状态为发生变化时，不执行无效的调谐操作） 减少对底层容器运行的并发请求，以减轻容器运行时的压力    PLEG架构设计PLEG主要包含俩个核心工作，一是感受容器变化，生成Pod事件，俩是维持一份最新的Pod Status Cache数据供其他组件读取。   kubelet同时接收俩个方向的事件，Pod S...</div></div></div></a><a class="pagination-related" href="/2024/12/14/cloud/k8s/kubelet/K8s-kubelet(Cgroup%E8%B5%84%E6%BA%90%E9%9A%94%E7%A6%BB%E4%BB%A5%E5%8F%8A%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%8E%9F%E7%90%86)/" title="K8s-kubelet(Cgroup资源隔离以及垃圾回收原理)"><img class="cover" src="/img/k8sLogo.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-14</div><div class="info-item-2">K8s-kubelet(Cgroup资源隔离以及垃圾回收原理)</div></div><div class="info-2"><div class="info-item-1">K8s-kubelet(Cgroup资源隔离以及垃圾回收原理) 基于1.25  什么是Cgroup资源隔离kubelet基于cgroup限制Pod资源使用。cgroup是Linux内核的一个重要功能，用来限制、控制和分离一个进程组的资源（CPU、内存、磁盘I&#x2F;O） kubelet在创建Pod时，会将其配置的cgroups parent目录传递给容器运行时，使容器运行时创建的进程都会限制到kubelet配置父级cgroup之下。  kubelet负责维护Pod、QoS、Node级别的cgroup配置 Container级别的cgroup直接交给容器运行时实现  cgroup的层级结构 kubelet采用了四级cgroups层级架构存储  Node Level cgroup 为了保证系统运行的稳定性，kubelet支持为系统守护进程预留资源，避免Pod占用整个系统资源，造成系统卡死或者崩溃。  默认情况下，kube-reserved和system-reserved不会启用。 但是启用之后，需要注意守护进程添加了cgroup之后，可能导致配置的上限太小，导致守护进程资源不足退...</div></div></div></a><a class="pagination-related" href="/2024/12/13/cloud/k8s/kubelet/K8s-kubelet(Pod%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%AE%A1%E7%90%86)/" title="K8s-kubelet(Pod生命周期管理)"><img class="cover" src="/img/k8sLogo.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-13</div><div class="info-item-2">K8s-kubelet(Pod生命周期管理)</div></div><div class="info-2"><div class="info-item-1">K8s-kubelet(Pod生命周期管理) 基于1.25  kubelet以Pod为基本处理单元，负责Pod从创建到消亡的整个生命周期   在1.21中Unknown状态已经被标记为弃用。  CRIkubelet通过CRI RPC管理容器的生命周期，执行容器的lifecycle hook和 startup&#x2F;liveness&#x2F;readiness的健康检查，同时根据Pod的重启策略在容器失败退出后自动重启容器，CRI是kubelet管理Pod和容器的基础   Ref:https://github.com/kubernetes/cri-api/blob/2c8d015e0d408208ca8843c1d6e2e2fce1e5dd94/pkg/apis/runtime/v1/api.proto#L34 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Joohwan.</div><div class="author-info-description">该知道的都知道，不知道的慢慢了解</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">259</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">76</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">60</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/piwriw"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/piwriw" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:piwriw@163.com" target="_blank" title="Email"><i class="fas fa-envelope-open-text"></i></a></div></div><div class="card-widget"><div class="item-headline"><i class="iconfont icat-visitor"></i><span>来访者</span></div><div class="item-content"><div id="welcome-info"></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#K8s%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD-Job"><span class="toc-number">1.</span> <span class="toc-text">K8s工作负载-Job</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFJob"><span class="toc-number">1.1.</span> <span class="toc-text">什么是Job</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JobSpec"><span class="toc-number">1.2.</span> <span class="toc-text">JobSpec</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Job%E7%9A%84%E5%B9%B6%E5%8F%91"><span class="toc-number">1.3.</span> <span class="toc-text">Job的并发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E5%B9%B6%E5%8F%91"><span class="toc-number">1.3.1.</span> <span class="toc-text">无并发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E6%88%90%E6%8C%87%E5%AE%9A%E6%95%B0%E9%87%8F"><span class="toc-number">1.3.2.</span> <span class="toc-text">完成指定数量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%AF%B9%E5%88%97"><span class="toc-number">1.3.3.</span> <span class="toc-text">工作对列</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95Job"><span class="toc-number">1.4.</span> <span class="toc-text">索引Job</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89Pod%E5%A4%B1%E6%95%88%E7%AD%96%E7%95%A5"><span class="toc-number">1.5.</span> <span class="toc-text">自定义Pod失效策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%B2%E7%BB%8F%E5%AE%8C%E6%88%90Job%E7%9A%84TTL%E6%9C%BA%E5%88%B6"><span class="toc-number">1.6.</span> <span class="toc-text">已经完成Job的TTL机制</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2026/01/11/web/gorm/09-logger/" title="Gorm-日志系统模块原理说明"><img src="/img/go.png" onerror="this.onerror=null;this.src='/img/404.png'" alt="Gorm-日志系统模块原理说明"/></a><div class="content"><a class="title" href="/2026/01/11/web/gorm/09-logger/" title="Gorm-日志系统模块原理说明">Gorm-日志系统模块原理说明</a><time datetime="2026-01-11T11:56:27.000Z" title="发表于 2026-01-11 19:56:27">2026-01-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/11/web/gorm/08-migration/" title="Gorm-迁移功能模块原理说明"><img src="/img/go.png" onerror="this.onerror=null;this.src='/img/404.png'" alt="Gorm-迁移功能模块原理说明"/></a><div class="content"><a class="title" href="/2026/01/11/web/gorm/08-migration/" title="Gorm-迁移功能模块原理说明">Gorm-迁移功能模块原理说明</a><time datetime="2026-01-11T10:56:27.000Z" title="发表于 2026-01-11 18:56:27">2026-01-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/11/web/gorm/10-plugin/" title="Gorm-插件系统模块原理说明"><img src="/img/go.png" onerror="this.onerror=null;this.src='/img/404.png'" alt="Gorm-插件系统模块原理说明"/></a><div class="content"><a class="title" href="/2026/01/11/web/gorm/10-plugin/" title="Gorm-插件系统模块原理说明">Gorm-插件系统模块原理说明</a><time datetime="2026-01-11T10:56:27.000Z" title="发表于 2026-01-11 18:56:27">2026-01-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/11/web/gorm/07-transaction/" title="Gorm-事务处理模块原理说明"><img src="/img/go.png" onerror="this.onerror=null;this.src='/img/404.png'" alt="Gorm-事务处理模块原理说明"/></a><div class="content"><a class="title" href="/2026/01/11/web/gorm/07-transaction/" title="Gorm-事务处理模块原理说明">Gorm-事务处理模块原理说明</a><time datetime="2026-01-11T09:56:27.000Z" title="发表于 2026-01-11 17:56:27">2026-01-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/11/web/gorm/06-associations/" title="Gorm-关联关系模块原理说明"><img src="/img/go.png" onerror="this.onerror=null;this.src='/img/404.png'" alt="Gorm-关联关系模块原理说明"/></a><div class="content"><a class="title" href="/2026/01/11/web/gorm/06-associations/" title="Gorm-关联关系模块原理说明">Gorm-关联关系模块原理说明</a><time datetime="2026-01-11T08:56:27.000Z" title="发表于 2026-01-11 16:56:27">2026-01-11</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2023 - 2026 By Joohwan.</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://piwriw-twikoo-git-main-piwriw.vercel.app/',
      region: 'ap-shanghai',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://piwriw-twikoo-git-main-piwriw.vercel.app/',
      region: 'ap-shanghai',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script src="/js/categories.js" defer></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>