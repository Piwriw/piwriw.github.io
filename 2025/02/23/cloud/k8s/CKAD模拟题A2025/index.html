<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>CKAD模拟题A2025 | Joohwan</title><meta name="author" content="Joohwan."><meta name="copyright" content="Joohwan."><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="CKAD Simulator Kubernetes 1.32Question 1 | Namespaces  Solve this question on instance: ssh ckad5601   The DevOps team would like to get the list of all Namespaces in the cluster. Get the list and sav">
<meta property="og:type" content="article">
<meta property="og:title" content="CKAD模拟题A2025">
<meta property="og:url" content="https://piwriw.github.io/2025/02/23/cloud/k8s/CKAD%E6%A8%A1%E6%8B%9F%E9%A2%98A2025/index.html">
<meta property="og:site_name" content="Joohwan">
<meta property="og:description" content="CKAD Simulator Kubernetes 1.32Question 1 | Namespaces  Solve this question on instance: ssh ckad5601   The DevOps team would like to get the list of all Namespaces in the cluster. Get the list and sav">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://piwriw.github.io/img/k8s-go.jpg">
<meta property="article:published_time" content="2025-02-23T04:57:55.000Z">
<meta property="article:modified_time" content="2026-02-28T13:29:12.660Z">
<meta property="article:author" content="Joohwan.">
<meta property="article:tag" content="k8s">
<meta property="article:tag" content="cloud">
<meta property="article:tag" content="CKAD">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://piwriw.github.io/img/k8s-go.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "CKAD模拟题A2025",
  "url": "https://piwriw.github.io/2025/02/23/cloud/k8s/CKAD%E6%A8%A1%E6%8B%9F%E9%A2%98A2025/",
  "image": "https://piwriw.github.io/img/k8s-go.jpg",
  "datePublished": "2025-02-23T04:57:55.000Z",
  "dateModified": "2026-02-28T13:29:12.660Z",
  "author": [
    {
      "@type": "Person",
      "name": "Joohwan.",
      "url": "https://github.com/Piwriw"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://piwriw.github.io/2025/02/23/cloud/k8s/CKAD%E6%A8%A1%E6%8B%9F%E9%A2%98A2025/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'CKAD模拟题A2025',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><script src="/js/welcome.js"></script><script src="https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js"></script><link rel="stylesheet" href="/css/categories.css"><link rel="stylesheet" href="/css/tabs.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">259</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">76</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">60</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/charts/"><i class="fa-fw fas fa-folder-open"></i><span> 文章统计</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div><div class="menus_item"><a class="site-page" href="/wish/"><i class="fa-fw fas fa-tags"></i><span> 许愿墙</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/k8s-go.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Joohwan</span></a><a class="nav-page-title" href="/"><span class="site-name">CKAD模拟题A2025</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/charts/"><i class="fa-fw fas fa-folder-open"></i><span> 文章统计</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div><div class="menus_item"><a class="site-page" href="/wish/"><i class="fa-fw fas fa-tags"></i><span> 许愿墙</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">CKAD模拟题A2025</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-02-23T04:57:55.000Z" title="发表于 2025-02-23 12:57:55">2025-02-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-02-28T13:29:12.660Z" title="更新于 2026-02-28 21:29:12">2026-02-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud/">cloud</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud/k8s/">k8s</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/cloud/k8s/CKAD/">CKAD</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">14.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>88分钟</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2026-02-28 21:29:12&quot;}" hidden></div><h1 id="CKAD-Simulator-Kubernetes-1-32"><a href="#CKAD-Simulator-Kubernetes-1-32" class="headerlink" title="CKAD Simulator Kubernetes 1.32"></a>CKAD Simulator Kubernetes 1.32</h1><h2 id="Question-1-Namespaces"><a href="#Question-1-Namespaces" class="headerlink" title="Question 1 | Namespaces"></a>Question 1 | Namespaces</h2><p> </p>
<p>Solve this question on instance: <code>ssh ckad5601</code></p>
<p> </p>
<p>The DevOps team would like to get the list of all <em>Namespaces</em> in the cluster. Get the list and save it to <code>/opt/course/1/namespaces</code> on <code>ckad5601</code>.</p>
<p> </p>
<h5 id="Answer"><a href="#Answer" class="headerlink" title="Answer:"></a>Answer:</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">k get ns &gt; /opt/course/1/namespaces</span><br></pre></td></tr></table></figure>

<p>The content should then look like:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># /opt/course/1/namespaces</span><br><span class="line">NAME              STATUS   AGE</span><br><span class="line">default           Active   136m</span><br><span class="line">earth             Active   105m</span><br><span class="line">jupiter           Active   105m</span><br><span class="line">kube-node-lease   Active   136m</span><br><span class="line">kube-public       Active   136m</span><br><span class="line">kube-system       Active   136m</span><br><span class="line">mars              Active   105m</span><br><span class="line">shell-intern      Active   105m</span><br></pre></td></tr></table></figure>

<p> </p>
<p> </p>
<h2 id="Question-2-Pods"><a href="#Question-2-Pods" class="headerlink" title="Question 2 | Pods"></a>Question 2 | Pods</h2><p> </p>
<p>Solve this question on instance: <code>ssh ckad5601</code></p>
<p> </p>
<p>Create a single <em>Pod</em> of image <code>httpd:2.4.41-alpine</code> in <em>Namespace</em> <code>default</code>. The <em>Pod</em> should be named <code>pod1</code> and the container should be named <code>pod1-container</code>.</p>
<p>Your manager would like to run a command manually on occasion to output the status of that exact <em>Pod</em>. Please write a command that does this into <code>/opt/course/2/pod1-status-command.sh</code> on <code>ckad5601</code>. The command should use <code>kubectl</code>.</p>
<p> </p>
<h5 id="Answer-1"><a href="#Answer-1" class="headerlink" title="Answer:"></a>Answer:</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">x</span><br><span class="line">k run # help</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">k run pod1 --image=httpd:2.4.41-alpine --dry-run=client -oyaml &gt; 2.yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim 2.yaml</span><br></pre></td></tr></table></figure>

<p>Change the container name in <code>2.yaml</code> to <code>pod1-container</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># 2.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: null</span><br><span class="line">  labels:</span><br><span class="line">    run: pod1</span><br><span class="line">  name: pod1</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - image: httpd:2.4.41-alpine</span><br><span class="line">    name: pod1-container # change</span><br><span class="line">    resources: &#123;&#125;</span><br><span class="line">  dnsPolicy: ClusterFirst</span><br><span class="line">  restartPolicy: Always</span><br><span class="line">status: &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>Then run:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k create -f 2.yaml</span><br><span class="line">pod/pod1 created</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ k get pod</span><br><span class="line">NAME   READY   STATUS              RESTARTS   AGE</span><br><span class="line">pod1   0/1     ContainerCreating   0          6s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ k get pod</span><br><span class="line">NAME   READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod1   1/1     Running   0          30s</span><br></pre></td></tr></table></figure>

<p>Next create the requested command:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">vim /opt/course/2/pod1-status-command.sh</span><br></pre></td></tr></table></figure>

<p>The content of the command file could look like:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># /opt/course/2/pod1-status-command.sh</span><br><span class="line">kubectl -n default describe pod pod1 | grep -i status:</span><br></pre></td></tr></table></figure>

<p>Another solution would be using jsonpath:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># /opt/course/2/pod1-status-command.sh</span><br><span class="line">kubectl -n default get pod pod1 -o jsonpath=&quot;&#123;.status.phase&#125;&quot;</span><br></pre></td></tr></table></figure>

<p>To test the command:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ sh /opt/course/2/pod1-status-command.sh</span><br><span class="line">Running</span><br></pre></td></tr></table></figure>

<p> </p>
<p> </p>
<h2 id="Question-3-Job"><a href="#Question-3-Job" class="headerlink" title="Question 3 | Job"></a>Question 3 | Job</h2><p> </p>
<p>Solve this question on instance: <code>ssh ckad7326</code></p>
<p> </p>
<p>Team Neptune needs a <em>Job</em> template located at <code>/opt/course/3/job.yaml</code>. This <em>Job</em> should run image <code>busybox:1.31.0</code> and execute <code>sleep 2 &amp;&amp; echo done</code>. It should be in namespace <code>neptune</code>, run a total of 3 times and should execute 2 runs in parallel.</p>
<p>Start the <em>Job</em> and check its history. Each pod created by the <em>Job</em> should have the label <code>id: awesome-job</code>. The job should be named <code>neb-new-job</code> and the container <code>neb-new-job-container</code>.</p>
<p> </p>
<h5 id="Answer-2"><a href="#Answer-2" class="headerlink" title="Answer:"></a>Answer:</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n neptune create job -h</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">k -n neptune create job neb-new-job --image=busybox:1.31.0 --dry-run=client -oyaml &gt; /opt/course/3/job.yaml -- sh -c &quot;sleep 2 &amp;&amp; echo done&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim /opt/course/3/job.yaml</span><br></pre></td></tr></table></figure>

<p>Make the required changes in the yaml:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># /opt/course/3/job.yaml</span><br><span class="line">apiVersion: batch/v1</span><br><span class="line">kind: Job</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: null</span><br><span class="line">  name: neb-new-job</span><br><span class="line">  namespace: neptune      # add</span><br><span class="line">spec:</span><br><span class="line">  completions: 3          # add</span><br><span class="line">  parallelism: 2          # add</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      creationTimestamp: null</span><br><span class="line">      labels:             # add</span><br><span class="line">        id: awesome-job   # add</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - command:</span><br><span class="line">        - sh</span><br><span class="line">        - -c</span><br><span class="line">        - sleep 2 &amp;&amp; echo done</span><br><span class="line">        image: busybox:1.31.0</span><br><span class="line">        name: neb-new-job-container # update</span><br><span class="line">        resources: &#123;&#125;</span><br><span class="line">      restartPolicy: Never</span><br><span class="line">status: &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>Then to create it:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -f /opt/course/3/job.yaml create # namespace already set in yaml</span><br></pre></td></tr></table></figure>

<p>Check <em>Job</em> and <em>Pods</em>, you should see two running parallel at most but three in total:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n neptune get pod,job | grep neb-new-job</span><br><span class="line">pod/neb-new-job-jhq2g              0/1     ContainerCreating   0          4s</span><br><span class="line">pod/neb-new-job-vf6ts              0/1     ContainerCreating   0          4s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">job.batch/neb-new-job   0/3           4s         5s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ k -n neptune get pod,job | grep neb-new-job</span><br><span class="line">pod/neb-new-job-gm8sz              0/1     ContainerCreating   0          0s</span><br><span class="line">pod/neb-new-job-jhq2g              0/1     Completed           0          10s</span><br><span class="line">pod/neb-new-job-vf6ts              1/1     Running             0          10s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">job.batch/neb-new-job   1/3           10s        11s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ k -n neptune get pod,job | grep neb-new-job</span><br><span class="line">pod/neb-new-job-gm8sz              0/1     ContainerCreating   0          5s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pod/neb-new-job-jhq2g              0/1     Completed           0          15s</span><br><span class="line">pod/neb-new-job-vf6ts              0/1     Completed           0          15s</span><br><span class="line">job.batch/neb-new-job   2/3           15s        16s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ k -n neptune get pod,job | grep neb-new-job</span><br><span class="line">pod/neb-new-job-gm8sz              0/1     Completed          0          12s</span><br><span class="line">pod/neb-new-job-jhq2g              0/1     Completed          0          22s</span><br><span class="line">pod/neb-new-job-vf6ts              0/1     Completed          0          22s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">job.batch/neb-new-job   3/3           21s        23s</span><br></pre></td></tr></table></figure>

<p>Check history:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n neptune describe job neb-new-job</span><br><span class="line">...</span><br><span class="line">Events:</span><br><span class="line">  Type    Reason            Age    From            Message</span><br><span class="line">  ----    ------            ----   ----            -------</span><br><span class="line">  Normal  SuccessfulCreate  2m52s  job-controller  Created pod: neb-new-job-jhq2g</span><br><span class="line">  Normal  SuccessfulCreate  2m52s  job-controller  Created pod: neb-new-job-vf6ts</span><br><span class="line">  Normal  SuccessfulCreate  2m42s  job-controller  Created pod: neb-new-job-gm8sz</span><br></pre></td></tr></table></figure>

<p>At the age column we can see that two <code>pods</code> run parallel and the third one after that. Just as it was required in the task.</p>
<p> </p>
<p> </p>
<h2 id="Question-4-Helm-Management"><a href="#Question-4-Helm-Management" class="headerlink" title="Question 4 | Helm Management"></a>Question 4 | Helm Management</h2><p> </p>
<p>Solve this question on instance: <code>ssh ckad7326</code></p>
<p> </p>
<p>Team Mercury asked you to perform some operations using Helm, all in <em>Namespace</em> <code>mercury</code>:</p>
<ol>
<li><p>Delete release <code>internal-issue-report-apiv1</code></p>
</li>
<li><p>Upgrade release <code>internal-issue-report-apiv2</code> to any newer version of chart <code>bitnami/nginx</code> available</p>
</li>
<li><p>Install a new release <code>internal-issue-report-apache</code> of chart <code>bitnami/apache</code>. The <em>Deployment</em> should have two replicas, set these via Helm-values during install</p>
</li>
<li><p>There seems to be a broken release, stuck in <code>pending-install</code> state. Find it and delete it</p>
</li>
</ol>
<p> </p>
<h5 id="Answer-3"><a href="#Answer-3" class="headerlink" title="Answer:"></a>Answer:</h5><p><em>Helm Chart</em>: Kubernetes YAML template-files combined into a single package, <em>Values</em> allow customisation</p>
<p><em>Helm Release</em>: Installed instance of a <em>Chart</em></p>
<p><em>Helm Values</em>: Allow to customise the YAML template-files in a <em>Chart</em> when creating a <em>Release</em></p>
<p> </p>
<h6 id="Step-1"><a href="#Step-1" class="headerlink" title="Step 1"></a>Step 1</h6><p>First we should delete the required release:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ helm -n mercury ls</span><br><span class="line">NAME                            NAMESPACE    ...   STATUS      CHART           APP VERSION</span><br><span class="line">internal-issue-report-apiv1     mercury      ...   deployed    nginx-18.1.14   1.27.1     </span><br><span class="line">internal-issue-report-apiv2     mercury      ...   deployed    nginx-18.1.14   1.27.1     </span><br><span class="line">internal-issue-report-app       mercury      ...   deployed    nginx-18.1.14   1.27.1  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ helm -n mercury uninstall internal-issue-report-apiv1</span><br><span class="line">release &quot;internal-issue-report-apiv1&quot; uninstalled</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ helm -n mercury ls</span><br><span class="line">NAME                            NAMESPACE    ...   STATUS      CHART           APP VERSION  </span><br><span class="line">internal-issue-report-apiv2     mercury      ...   deployed    nginx-18.1.14   1.27.1     </span><br><span class="line">internal-issue-report-app       mercury      ...   deployed    nginx-18.1.14   1.27.1  </span><br></pre></td></tr></table></figure>

<p> </p>
<h6 id="Step-2"><a href="#Step-2" class="headerlink" title="Step 2"></a>Step 2</h6><p>Next we need to upgrade a release, for this we could first list the charts of the repo:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ helm repo list</span><br><span class="line">NAME    URL                  </span><br><span class="line">bitnami http://localhost:6000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ helm repo update</span><br><span class="line">Hang tight while we grab the latest from your chart repositories...</span><br><span class="line">...Successfully got an update from the &quot;bitnami&quot; chart repository</span><br><span class="line">Update Complete. ⎈Happy Helming!⎈</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ helm search repo nginx --versions</span><br><span class="line">NAME            CHART VERSION   APP VERSION     DESCRIPTION                                       </span><br><span class="line">bitnami/nginx   18.2.0          1.27.1          NGINX Open Source is a web server that can be a...</span><br><span class="line">bitnami/nginx   18.1.15         1.27.1          NGINX Open Source is a web server that can be a...</span><br><span class="line">bitnami/nginx   18.1.14         1.27.1          NGINX Open Source is a web server that can be a...</span><br><span class="line">bitnami/nginx   13.0.0          1.23.0          NGINX Open Source is a web server that can be a...</span><br></pre></td></tr></table></figure>

<p>Here we see that two newer chart versions are available. But the question only requires us to upgrade to any newer chart version available, so we can simply run:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ helm -n mercury upgrade internal-issue-report-apiv2 bitnami/nginx</span><br><span class="line">Release &quot;internal-issue-report-apiv2&quot; has been upgraded. Happy Helming!</span><br><span class="line">NAME: internal-issue-report-apiv2</span><br><span class="line">LAST DEPLOYED: Wed Oct  2 14:17:09 2024</span><br><span class="line">NAMESPACE: mercury</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 2</span><br><span class="line">TEST SUITE: None</span><br><span class="line">NOTES:</span><br><span class="line">CHART NAME: nginx</span><br><span class="line">CHART VERSION: 18.2.0</span><br><span class="line">APP VERSION: 1.27.1</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ helm -n mercury ls</span><br><span class="line">NAME                            NAMESPACE   ...   STATUS      CHART           APP VERSION</span><br><span class="line">internal-issue-report-apiv2     mercury     ...   deployed    nginx-18.2.0    1.27.1     </span><br><span class="line">internal-issue-report-app       mercury     ...   deployed    nginx-18.1.14   1.27.1  </span><br></pre></td></tr></table></figure>

<p>Looking good!</p>
<blockquote>
<p><em><strong>INFO:</strong></em> Also check out <code>helm rollback</code> for undoing a helm rollout&#x2F;upgrade</p>
</blockquote>
<p> </p>
<h6 id="Step-3"><a href="#Step-3" class="headerlink" title="Step 3"></a>Step 3</h6><p>Now we’re asked to install a new release, with a customised values setting. For this we first list all possible value settings for the chart, we can do this via:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">helm show values bitnami/apache # will show a long list of all possible value-settings</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">helm show values bitnami/apache | yq e # parse yaml and show with colors</span><br></pre></td></tr></table></figure>

<p>Huge list, if we search in it we should find the setting <code>replicaCount: 1</code> on top level. This means we can run:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ helm -n mercury install internal-issue-report-apache bitnami/apache --set replicaCount=2</span><br><span class="line">NAME: internal-issue-report-apache</span><br><span class="line">LAST DEPLOYED: Wed Oct  2 14:18:32 2024</span><br><span class="line">NAMESPACE: mercury</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br><span class="line">NOTES:</span><br><span class="line">CHART NAME: apache</span><br><span class="line">CHART VERSION: 11.2.20</span><br><span class="line">APP VERSION: 2.4.62</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>If we would also need to set a value on a deeper level, for example <code>image.debug</code>, we could run:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">helm -n mercury install internal-issue-report-apache bitnami/apache \</span><br><span class="line">  --set replicaCount=2 \</span><br><span class="line">  --set image.debug=true</span><br></pre></td></tr></table></figure>

<p>Install done, let’s verify what we did:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ helm -n mercury ls</span><br><span class="line">NAME                            NAMESPACE    ...   STATUS       CHART             APP VERSION</span><br><span class="line">internal-issue-report-apache    mercury      ...   deployed     apache-11.2.20    2.4.62     </span><br><span class="line">internal-issue-report-apiv2     mercury      ...   deployed     nginx-18.2.0      1.27.1     </span><br><span class="line">internal-issue-report-app       mercury      ...   deployed     nginx-18.1.14     1.27.1 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ k -n mercury get deploy internal-issue-report-apache</span><br><span class="line">NAME                           READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">internal-issue-report-apache   2/2     2            2           64s</span><br></pre></td></tr></table></figure>

<p>We see a healthy deployment with two replicas!</p>
<p> </p>
<h6 id="Step-4"><a href="#Step-4" class="headerlink" title="Step 4"></a>Step 4</h6><p>By default releases in <code>pending-upgrade</code> state aren’t listed, but we can show all to find and delete the broken release:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ helm -n mercury ls -a</span><br><span class="line">NAME                            NAMESPACE   ...    STATUS            CHART             APP VERSION</span><br><span class="line">internal-issue-report-apache    mercury     ...    deployed          apache-11.2.20    2.4.62     </span><br><span class="line">internal-issue-report-apiv2     mercury     ...    deployed          nginx-18.2.0      1.27.1     </span><br><span class="line">internal-issue-report-app       mercury     ...    deployed          nginx-18.1.14     1.27.1     </span><br><span class="line">internal-issue-report-daniel    mercury     ...    pending-install   nginx-18.1.14     1.27.1 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ helm -n mercury uninstall internal-issue-report-daniel</span><br><span class="line">release &quot;internal-issue-report-daniel&quot; uninstalled</span><br></pre></td></tr></table></figure>

<p>Thank you Helm for making our lives easier! (Till something breaks)</p>
<p> </p>
<p> </p>
<h2 id="Question-5-ServiceAccount-Secret"><a href="#Question-5-ServiceAccount-Secret" class="headerlink" title="Question 5 | ServiceAccount, Secret"></a>Question 5 | ServiceAccount, Secret</h2><p> </p>
<p>Solve this question on instance: <code>ssh ckad7326</code></p>
<p> </p>
<p>Team Neptune has its own <em>ServiceAccount</em> named <code>neptune-sa-v2</code> in <em>Namespace</em> <code>neptune</code>. A coworker needs the token from the <em>Secret</em> that belongs to that <em>ServiceAccount</em>. Write the base64 decoded token to file <code>/opt/course/5/token</code> on <code>ckad7326</code>.</p>
<p> </p>
<h5 id="Answer-4"><a href="#Answer-4" class="headerlink" title="Answer:"></a>Answer:</h5><p><em>Secrets</em> won’t be created automatically for *ServiceAccounts, but it’s possible to create a <em>Secret</em> manually and attach it to a <em>ServiceAccount</em> by setting the correct annotation on the <em>Secret</em>. This was done for this task.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n neptune get sa # get overview</span><br><span class="line">k -n neptune get secrets # shows all secrets of namespace</span><br><span class="line">k -n neptune get secrets -oyaml | grep annotations -A 1 # shows secrets with first annotation</span><br></pre></td></tr></table></figure>

<p>If a <em>Secret</em> belongs to a <em>ServiceAccount</em>, it’ll have the annotation <code>kubernetes.io/service-account.name</code>. Here the <em>Secret</em> we’re looking for is <code>neptune-secret-1</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n neptune get secret neptune-secret-1 -o yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">data:</span><br><span class="line">...</span><br><span class="line">  token: ZXlKaGJHY2lPaUpTVXpJMU5pSXNJbXRwWkNJNkltNWFaRmRxWkRKMmFHTnZRM0JxV0haT1IxZzFiM3BJY201SlowaEhOV3hUWmt3elFuRmFhVEZhZDJNaWZRLmV5SnBjM01pT2lKcmRXSmxjbTVsZEdWekwzTmxjblpwWTJWaFkyTnZkVzUwSWl3aWEzVmlaWEp1WlhSbGN5NXBieTl6WlhKMmFXTmxZV05qYjNWdWRDOXVZVzFsYzNCaFkyVWlPaUp1WlhCMGRXNWxJaXdpYTNWaVpYSnVaWFJsY3k1cGJ5OXpaWEoyYVdObFlXTmpiM1Z1ZEM5elpXTnlaWFF1Ym1GdFpTSTZJbTVsY0hSMWJtVXRjMkV0ZGpJdGRHOXJaVzR0Wm5FNU1tb2lMQ0pyZFdKbGNtNWxkR1Z6TG1sdkwzTmxjblpwWTJWaFkyTnZkVzUwTDNObGNuWnBZMlV0WVdOamIzVnVkQzV1WVcxbElqb2libVZ3ZEhWdVpTMXpZUzEyTWlJc0ltdDFZbVZ5Ym1WMFpYTXVhVzh2YzJWeWRtbGpaV0ZqWTI5MWJuUXZjMlZ5ZG1salpTMWhZMk52ZFc1MExuVnBaQ0k2SWpZMlltUmpOak0yTFRKbFl6TXROREpoWkMwNE9HRTFMV0ZoWXpGbFpqWmxPVFpsTlNJc0luTjFZaUk2SW5ONWMzUmxiVHB6WlhKMmFXTmxZV05qYjNWdWREcHVaWEIwZFc1bE9tNWxjSFIxYm1VdGMyRXRkaklpZlEuVllnYm9NNENUZDBwZENKNzh3alV3bXRhbGgtMnZzS2pBTnlQc2gtNmd1RXdPdFdFcTVGYnc1WkhQdHZBZHJMbFB6cE9IRWJBZTRlVU05NUJSR1diWUlkd2p1Tjk1SjBENFJORmtWVXQ0OHR3b2FrUlY3aC1hUHV3c1FYSGhaWnp5NHlpbUZIRzlVZm1zazVZcjRSVmNHNm4xMzd5LUZIMDhLOHpaaklQQXNLRHFOQlF0eGctbFp2d1ZNaTZ2aUlocnJ6QVFzME1CT1Y4Mk9KWUd5Mm8tV1FWYzBVVWFuQ2Y5NFkzZ1QwWVRpcVF2Y3pZTXM2bno5dXQtWGd3aXRyQlk2VGo5QmdQcHJBOWtfajVxRXhfTFVVWlVwUEFpRU43T3pka0pzSThjdHRoMTBseXBJMUFlRnI0M3Q2QUx5clFvQk0zOWFiRGZxM0Zrc1Itb2NfV013</span><br><span class="line">kind: Secret</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>This shows the base64 encoded token. To get the decoded one we could pipe it manually through <code>base64 -d</code> or we simply do:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n neptune describe secret neptune-secret-1</span><br><span class="line">...</span><br><span class="line">Data</span><br><span class="line">====</span><br><span class="line">token:      eyJhbGciOiJSUzI1NiIsImtpZCI6Im5aZFdqZDJ2aGNvQ3BqWHZOR1g1b3pIcm5JZ0hHNWxTZkwzQnFaaTFad2MifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJuZXB0dW5lIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6Im5lcHR1bmUtc2EtdjItdG9rZW4tZnE5MmoiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoibmVwdHVuZS1zYS12MiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjY2YmRjNjM2LTJlYzMtNDJhZC04OGE1LWFhYzFlZjZlOTZlNSIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpuZXB0dW5lOm5lcHR1bmUtc2EtdjIifQ.VYgboM4CTd0pdCJ78wjUwmtalh-2vsKjANyPsh-6guEwOtWEq5Fbw5ZHPtvAdrLlPzpOHEbAe4eUM95BRGWbYIdwjuN95J0D4RNFkVUt48twoakRV7h-aPuwsQXHhZZzy4yimFHG9Ufmsk5Yr4RVcG6n137y-FH08K8zZjIPAsKDqNBQtxg-lZvwVMi6viIhrrzAQs0MBOV82OJYGy2o-WQVc0UUanCf94Y3gT0YTiqQvczYMs6nz9ut-XgwitrBY6Tj9BgPprA9k_j5qEx_LUUZUpPAiEN7OzdkJsI8ctth10lypI1AeFr43t6ALyrQoBM39abDfq3FksR-oc_WMw</span><br><span class="line">ca.crt:     1066 bytes</span><br><span class="line">namespace:  7 bytes</span><br></pre></td></tr></table></figure>

<p>Copy the token (part under <code>token:</code>) and paste it using vim.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">vim /opt/course/5/token</span><br></pre></td></tr></table></figure>

<p>File <code>/opt/course/5/token</code> should contain the token:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># /opt/course/5/token</span><br><span class="line">eyJhbGciOiJSUzI1NiIsImtpZCI6Im5aZFdqZDJ2aGNvQ3BqWHZOR1g1b3pIcm5JZ0hHNWxTZkwzQnFaaTFad2MifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJuZXB0dW5lIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6Im5lcHR1bmUtc2EtdjItdG9rZW4tZnE5MmoiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoibmVwdHVuZS1zYS12MiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjY2YmRjNjM2LTJlYzMtNDJhZC04OGE1LWFhYzFlZjZlOTZlNSIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpuZXB0dW5lOm5lcHR1bmUtc2EtdjIifQ.VYgboM4CTd0pdCJ78wjUwmtalh-2vsKjANyPsh-6guEwOtWEq5Fbw5ZHPtvAdrLlPzpOHEbAe4eUM95BRGWbYIdwjuN95J0D4RNFkVUt48twoakRV7h-aPuwsQXHhZZzy4yimFHG9Ufmsk5Yr4RVcG6n137y-FH08K8zZjIPAsKDqNBQtxg-lZvwVMi6viIhrrzAQs0MBOV82OJYGy2o-WQVc0UUanCf94Y3gT0YTiqQvczYMs6nz9ut-XgwitrBY6Tj9BgPprA9k_j5qEx_LUUZUpPAiEN7OzdkJsI8ctth10lypI1AeFr43t6ALyrQoBM39abDfq3FksR-oc_WMw</span><br></pre></td></tr></table></figure>

<p> </p>
<p> </p>
<h2 id="Question-6-ReadinessProbe"><a href="#Question-6-ReadinessProbe" class="headerlink" title="Question 6 | ReadinessProbe"></a>Question 6 | ReadinessProbe</h2><p> </p>
<p>Solve this question on instance: <code>ssh ckad5601</code></p>
<p> </p>
<p>Create a single <em>Pod</em> named <code>pod6</code> in <em>Namespace</em> <code>default</code> of image <code>busybox:1.31.0</code>. The <em>Pod</em> should have a readiness-probe executing <code>cat /tmp/ready</code>. It should initially wait 5 and periodically wait 10 seconds. This will set the container ready only if the file <code>/tmp/ready</code> exists.</p>
<p>The <em>Pod</em> should run the command <code>touch /tmp/ready &amp;&amp; sleep 1d</code>, which will create the necessary file to be ready and then idles. Create the <em>Pod</em> and confirm it starts.</p>
<p> </p>
<h5 id="Answer-5"><a href="#Answer-5" class="headerlink" title="Answer:"></a>Answer:</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k run pod6 --image=busybox:1.31.0 --dry-run=client -oyaml --command -- sh -c &quot;touch /tmp/ready &amp;&amp; sleep 1d&quot; &gt; 6.yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim 6.yaml</span><br></pre></td></tr></table></figure>

<p>Search for a readiness-probe example on <a target="_blank" rel="noopener" href="https://kubernetes.io/docs">https://kubernetes.io/docs</a>, then copy and alter the relevant section for the task:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># 6.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: null</span><br><span class="line">  labels:</span><br><span class="line">    run: pod6</span><br><span class="line">  name: pod6</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - command:</span><br><span class="line">    - sh</span><br><span class="line">    - -c</span><br><span class="line">    - touch /tmp/ready &amp;&amp; sleep 1d</span><br><span class="line">    image: busybox:1.31.0</span><br><span class="line">    name: pod6</span><br><span class="line">    resources: &#123;&#125;</span><br><span class="line">    readinessProbe:                             # add</span><br><span class="line">      exec:                                     # add</span><br><span class="line">        command:                                # add</span><br><span class="line">        - sh                                    # add</span><br><span class="line">        - -c                                    # add</span><br><span class="line">        - cat /tmp/ready                        # add</span><br><span class="line">      initialDelaySeconds: 5                    # add</span><br><span class="line">      periodSeconds: 10                         # add</span><br><span class="line">  dnsPolicy: ClusterFirst</span><br><span class="line">  restartPolicy: Always</span><br><span class="line">status: &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>Then:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -f 6.yaml create</span><br></pre></td></tr></table></figure>

<p>Running <code>k get pod6</code> we should see the job being created and completed:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k get pod pod6</span><br><span class="line">NAME   READY   STATUS              RESTARTS   AGE</span><br><span class="line">pod6   0/1     ContainerCreating   0          2s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ k get pod pod6</span><br><span class="line">NAME   READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod6   0/1     Running   0          7s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ k get pod pod6</span><br><span class="line">NAME   READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod6   1/1     Running   0          15s</span><br></pre></td></tr></table></figure>

<p>We see that the <em>Pod</em> is finally ready.</p>
<p> </p>
<p> </p>
<h2 id="Question-7-Pods-Namespaces"><a href="#Question-7-Pods-Namespaces" class="headerlink" title="Question 7 | Pods, Namespaces"></a>Question 7 | Pods, Namespaces</h2><p> </p>
<p>Solve this question on instance: <code>ssh ckad7326</code></p>
<p> </p>
<p>The board of Team Neptune decided to take over control of one e-commerce webserver from Team Saturn. The administrator who once setup this webserver is not part of the organisation any longer. All information you could get was that the e-commerce system is called <code>my-happy-shop</code>.</p>
<p>Search for the correct <em>Pod</em> in <em>Namespace</em> <code>saturn</code> and move it to <em>Namespace</em> <code>neptune</code>. It doesn’t matter if you shut it down and spin it up again, it probably hasn’t any customers anyways.</p>
<p> </p>
<h5 id="Answer-6"><a href="#Answer-6" class="headerlink" title="Answer:"></a>Answer:</h5><p>Let’s see all those <em>Pods</em>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n saturn get pod</span><br><span class="line">NAME                READY   STATUS    RESTARTS   AGE</span><br><span class="line">webserver-sat-001   1/1     Running   0          111m</span><br><span class="line">webserver-sat-002   1/1     Running   0          111m</span><br><span class="line">webserver-sat-003   1/1     Running   0          111m</span><br><span class="line">webserver-sat-004   1/1     Running   0          111m</span><br><span class="line">webserver-sat-005   1/1     Running   0          111m</span><br><span class="line">webserver-sat-006   1/1     Running   0          111m</span><br></pre></td></tr></table></figure>

<p>The <em>Pod</em> names don’t reveal any information. We assume the <em>Pod</em> we are searching has a <em>label</em> or <em>annotation</em> with the name <code>my-happy-shop</code>, so we search for it:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n saturn describe pod # describe all pods, then manually look for it</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># or do some filtering like this</span><br><span class="line">k -n saturn get pod -o yaml | grep my-happy-shop -A10</span><br></pre></td></tr></table></figure>

<p>We see the webserver we’re looking for is <code>webserver-sat-003</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n saturn get pod webserver-sat-003 -o yaml &gt; 7_webserver-sat-003.yaml # export</span><br><span class="line">vim 7_webserver-sat-003.yaml</span><br></pre></td></tr></table></figure>

<p>Change the <em>Namespace</em> to <code>neptune</code>, also remove the <code>status:</code> section, the token <code>volume</code>, the token <code>volumeMount</code> and the <code>nodeName</code>, else the new <em>Pod</em> won’t start. The final file could look as clean like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># 7_webserver-sat-003.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  annotations:</span><br><span class="line">    description: this is the server for the E-Commerce System my-happy-shop</span><br><span class="line">  labels:</span><br><span class="line">    id: webserver-sat-003</span><br><span class="line">  name: webserver-sat-003</span><br><span class="line">  namespace: neptune # new namespace here</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - image: nginx:1.16.1-alpine</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    name: webserver-sat</span><br><span class="line">  restartPolicy: Always</span><br></pre></td></tr></table></figure>

<p>Then we execute:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n neptune create -f 7_webserver-sat-003.yaml</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n neptune get pod | grep webserver</span><br><span class="line">webserver-sat-003               1/1     Running            0          22s</span><br></pre></td></tr></table></figure>

<p>It seems the server is running in <em>Namespace</em> <code>neptune</code>, so we can do:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n saturn delete pod webserver-sat-003 --force --grace-period=0</span><br></pre></td></tr></table></figure>

<p>Let’s confirm only one is running:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k get pod -A | grep webserver-sat-003</span><br><span class="line">neptune        webserver-sat-003         1/1     Running            0          6s</span><br></pre></td></tr></table></figure>

<p>This should list only one pod called <code>webserver-sat-003</code> in <em>Namespace</em> <code>neptune</code>, status running.</p>
<p> </p>
<p> </p>
<h2 id="Question-8-Deployment-Rollouts"><a href="#Question-8-Deployment-Rollouts" class="headerlink" title="Question 8 | Deployment, Rollouts"></a>Question 8 | Deployment, Rollouts</h2><p> </p>
<p>Solve this question on instance: <code>ssh ckad7326</code></p>
<p> </p>
<p>There is an existing <em>Deployment</em> named <code>api-new-c32</code> in <em>Namespace</em> <code>neptune</code>. A developer did make an update to the <em>Deployment</em> but the updated version never came online. Check the <em>Deployment</em> history and find a revision that works, then rollback to it. Could you tell Team Neptune what the error was so it doesn’t happen again?</p>
<p> </p>
<h5 id="Answer-7"><a href="#Answer-7" class="headerlink" title="Answer:"></a>Answer:</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n neptune get deploy # overview</span><br><span class="line">k -n neptune rollout -h</span><br><span class="line">k -n neptune rollout history -h</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n neptune rollout history deploy api-new-c32</span><br><span class="line">deployment.extensions/api-new-c32 </span><br><span class="line">REVISION  CHANGE-CAUSE</span><br><span class="line">1         &lt;none&gt;</span><br><span class="line">2         kubectl edit deployment api-new-c32 --namespace=neptune</span><br><span class="line">3         kubectl edit deployment api-new-c32 --namespace=neptune</span><br><span class="line">4         kubectl edit deployment api-new-c32 --namespace=neptune</span><br><span class="line">5         kubectl edit deployment api-new-c32 --namespace=neptune</span><br></pre></td></tr></table></figure>

<p>We see 5 revisions, let’s check <em>Pod</em> and <em>Deployment</em> status:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n neptune get deploy,pod | grep api-new-c32</span><br><span class="line">deployment.extensions/api-new-c32    3/3     1            3           141m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pod/api-new-c32-65d998785d-jtmqq    1/1     Running            0          141m</span><br><span class="line">pod/api-new-c32-686d6f6b65-mj2fp    1/1     Running            0          141m</span><br><span class="line">pod/api-new-c32-6dd45bdb68-2p462    1/1     Running            0          141m</span><br><span class="line">pod/api-new-c32-7d64747c87-zh648    0/1     ImagePullBackOff   0          141m</span><br></pre></td></tr></table></figure>

<p>Let’s check the pod for errors:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n neptune describe pod api-new-c32-7d64747c87-zh648 | grep -i error</span><br><span class="line">  ...  Error: ImagePullBackOff</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n neptune describe pod api-new-c32-7d64747c87-zh648 | grep -i image</span><br><span class="line">    Image:          ngnix:1.16.3</span><br><span class="line">    Image ID:</span><br><span class="line">      Reason:       ImagePullBackOff</span><br><span class="line">  Warning  Failed  4m28s (x616 over 144m)  kubelet, gke-s3ef67020-28c5-45f7--default-pool-248abd4f-s010  Error: ImagePullBackOff</span><br></pre></td></tr></table></figure>

<p>Someone seems to have added a new image with a spelling mistake in the name <code>ngnix:1.16.3</code>, that’s the reason we can tell Team Neptune!</p>
<p>Now let’s revert to the previous version:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n neptune rollout undo deploy api-new-c32</span><br></pre></td></tr></table></figure>

<p>Does this one work?</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n neptune get deploy api-new-c32</span><br><span class="line">NAME          READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">api-new-c32   3/3     3            3           146m</span><br></pre></td></tr></table></figure>

<p>Yes! All up-to-date and available.</p>
<p>Also a fast way to get an overview of the <em>ReplicaSets</em> of a <em>Deployment</em> and their images could be done with:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n neptune get rs -o wide | grep api-new-c32</span><br></pre></td></tr></table></figure>

<p> </p>
<p> </p>
<h2 id="Question-9-Pod-Deployment"><a href="#Question-9-Pod-Deployment" class="headerlink" title="Question 9 | Pod -&gt; Deployment"></a>Question 9 | Pod -&gt; Deployment</h2><p> </p>
<p>Solve this question on instance: <code>ssh ckad9043</code></p>
<p> </p>
<p>In <em>Namespace</em> <code>pluto</code> there is single <em>Pod</em> named <code>holy-api</code>. It has been working okay for a while now but Team Pluto needs it to be more reliable.</p>
<p>Convert the <em>Pod</em> into a <em>Deployment</em> named <code>holy-api</code> with 3 replicas and delete the single <em>Pod</em> once done. The raw <em>Pod</em> template file is available at <code>/opt/course/9/holy-api-pod.yaml</code>.</p>
<p>In addition, the new <em>Deployment</em> should set <code>allowPrivilegeEscalation: false</code> and <code>privileged: false</code> for the security context on container level.</p>
<p>Please create the <em>Deployment</em> and save its yaml under <code>/opt/course/9/holy-api-deployment.yaml</code> on <code>ckad9043</code>.</p>
<p> </p>
<h5 id="Answer-8"><a href="#Answer-8" class="headerlink" title="Answer"></a>Answer</h5><p>There are multiple ways to do this, one is to copy an <em>Deployment</em> example from <a target="_blank" rel="noopener" href="https://kubernetes.io/docs">https://kubernetes.io/docs</a> and then merge it with the existing <em>Pod</em> yaml. That’s what we will do now:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">cp /opt/course/9/holy-api-pod.yaml /opt/course/9/holy-api-deployment.yaml # make a copy!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim /opt/course/9/holy-api-deployment.yaml</span><br></pre></td></tr></table></figure>

<p>Now copy&#x2F;use a <em>Deployment</em> example yaml and put the <em>Pod’s</em> <strong>metadata:</strong> and <strong>spec:</strong> into the <em>Deployment’s</em> <strong>template:</strong> section:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># /opt/course/9/holy-api-deployment.yaml</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: holy-api        # name stays the same</span><br><span class="line">  namespace: pluto      # important</span><br><span class="line">spec:</span><br><span class="line">  replicas: 3           # 3 replicas</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      id: holy-api      # set the correct selector</span><br><span class="line">  template:</span><br><span class="line">    # =&gt; from here down its the same as the pods metadata: and spec: sections</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        id: holy-api</span><br><span class="line">      name: holy-api</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - env:</span><br><span class="line">        - name: CACHE_KEY_1</span><br><span class="line">          value: b&amp;MTCi0=[T66RXm!jO@</span><br><span class="line">        - name: CACHE_KEY_2</span><br><span class="line">          value: PCAILGej5Ld@Q%&#123;Q1=#</span><br><span class="line">        - name: CACHE_KEY_3</span><br><span class="line">          value: 2qz-]2OJlWDSTn_;RFQ</span><br><span class="line">        image: nginx:1.17.3-alpine</span><br><span class="line">        name: holy-api-container</span><br><span class="line">        securityContext:                   # add</span><br><span class="line">          allowPrivilegeEscalation: false  # add</span><br><span class="line">          privileged: false                # add</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - mountPath: /cache1</span><br><span class="line">          name: cache-volume1</span><br><span class="line">        - mountPath: /cache2</span><br><span class="line">          name: cache-volume2</span><br><span class="line">        - mountPath: /cache3</span><br><span class="line">          name: cache-volume3</span><br><span class="line">      volumes:</span><br><span class="line">      - emptyDir: &#123;&#125;</span><br><span class="line">        name: cache-volume1</span><br><span class="line">      - emptyDir: &#123;&#125;</span><br><span class="line">        name: cache-volume2</span><br><span class="line">      - emptyDir: &#123;&#125;</span><br><span class="line">        name: cache-volume3</span><br></pre></td></tr></table></figure>

<p>To indent multiple lines using <code>vim</code> you should set the shiftwidth using <code>:set shiftwidth=2</code>. Then mark multiple lines using <code>Shift v</code> and the up&#x2F;down keys.</p>
<p>To then indent the marked lines press <code>&gt;</code> or <code>&lt;</code> and to repeat the action press <code>.</code></p>
<p>Next create the new <em>Deployment</em>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -f /opt/course/9/holy-api-deployment.yaml create</span><br></pre></td></tr></table></figure>

<p>and confirm it’s running:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n pluto get pod | grep holy</span><br><span class="line">NAME                        READY   STATUS    RESTARTS   AGE</span><br><span class="line">holy-api                    1/1     Running   0          19m</span><br><span class="line">holy-api-5dbfdb4569-8qr5x   1/1     Running   0          30s</span><br><span class="line">holy-api-5dbfdb4569-b5clh   1/1     Running   0          30s</span><br><span class="line">holy-api-5dbfdb4569-rj2gz   1/1     Running   0          30s</span><br></pre></td></tr></table></figure>

<p>Finally delete the single <em>Pod</em>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n pluto delete pod holy-api --force --grace-period=0</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n pluto get pod,deployment | grep holy</span><br><span class="line">pod/holy-api-5dbfdb4569-8qr5x   1/1     Running   0          2m4s</span><br><span class="line">pod/holy-api-5dbfdb4569-b5clh   1/1     Running   0          2m4s</span><br><span class="line">pod/holy-api-5dbfdb4569-rj2gz   1/1     Running   0          2m4s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">deployment.extensions/holy-api   3/3     3            3           2m4s</span><br></pre></td></tr></table></figure>

<p> </p>
<p> </p>
<h2 id="Question-10-Service-Logs"><a href="#Question-10-Service-Logs" class="headerlink" title="Question 10 | Service, Logs"></a>Question 10 | Service, Logs</h2><p> </p>
<p>Solve this question on instance: <code>ssh ckad9043</code></p>
<p> </p>
<p>Team Pluto needs a new cluster internal <em>Service</em>. Create a ClusterIP <em>Service</em> named <code>project-plt-6cc-svc</code> in <em>Namespace</em> <code>pluto</code>. This <em>Service</em> should expose a single <em>Pod</em> named <code>project-plt-6cc-api</code> of image <code>nginx:1.17.3-alpine</code>, create that <em>Pod</em> as well. The <em>Pod</em> should be identified by label <code>project: plt-6cc-api</code>. The <em>Service</em> should use tcp port redirection of <code>3333:80</code>.</p>
<p>Finally use for example <code>curl</code> from a temporary <code>nginx:alpine</code> <em>Pod</em> to get the response from the <em>Service</em>. Write the response into <code>/opt/course/10/service_test.html</code> on <code>ckad9043</code>. Also check if the logs of <em>Pod</em> <code>project-plt-6cc-api</code> show the request and write those into <code>/opt/course/10/service_test.log</code> on <code>ckad9043</code>.</p>
<p> </p>
<h5 id="Answer-9"><a href="#Answer-9" class="headerlink" title="Answer"></a>Answer</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n pluto run project-plt-6cc-api --image=nginx:1.17.3-alpine --labels project=plt-6cc-api</span><br></pre></td></tr></table></figure>

<p>This will create the requested <em>Pod</em>. In yaml it would look like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: null</span><br><span class="line">  labels:</span><br><span class="line">    project: plt-6cc-api</span><br><span class="line">  name: project-plt-6cc-api</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - image: nginx:1.17.3-alpine</span><br><span class="line">    name: project-plt-6cc-api</span><br><span class="line">    resources: &#123;&#125;</span><br><span class="line">  dnsPolicy: ClusterFirst</span><br><span class="line">  restartPolicy: Always</span><br><span class="line">status: &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>Next we create the service:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n pluto expose pod -h # help</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">k -n pluto expose pod project-plt-6cc-api --name project-plt-6cc-svc --port 3333 --target-port 80</span><br></pre></td></tr></table></figure>

<p>Expose will create a yaml where everything is already set for our case and no need to change anything:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: null</span><br><span class="line">  labels:</span><br><span class="line">    project: plt-6cc-api</span><br><span class="line">  name: project-plt-6cc-svc   # good</span><br><span class="line">  namespace: pluto            # great</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - port: 3333                # awesome</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: 80            # nice</span><br><span class="line">  selector:</span><br><span class="line">    project: plt-6cc-api      # beautiful</span><br><span class="line">status:</span><br><span class="line">  loadBalancer: &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>We could also use <code>create service</code> but then we would need to change the yaml afterwards:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n pluto create service -h # help</span><br><span class="line">k -n pluto create service clusterip -h #help</span><br><span class="line">k -n pluto create service clusterip project-plt-6cc-svc --tcp 3333:80 --dry-run=client -oyaml</span><br><span class="line"># now we would need to set the correct selector labels</span><br></pre></td></tr></table></figure>

<p>Check the <em>Service</em> is running:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n pluto get pod,svc | grep 6cc</span><br><span class="line">pod/project-plt-6cc-api         1/1     Running   0          9m42s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">service/project-plt-6cc-svc   ClusterIP   10.31.241.234   &lt;none&gt;        3333/TCP   2m24s</span><br></pre></td></tr></table></figure>

<p>Does the <em>Service</em> has one <em>Endpoint</em>?</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n pluto describe svc project-plt-6cc-svc</span><br><span class="line">Name:              project-plt-6cc-svc</span><br><span class="line">Namespace:         pluto</span><br><span class="line">Labels:            project=plt-6cc-api</span><br><span class="line">Annotations:       &lt;none&gt;</span><br><span class="line">Selector:          project=plt-6cc-api</span><br><span class="line">Type:              ClusterIP</span><br><span class="line">IP:                10.3.244.240</span><br><span class="line">Port:              &lt;unset&gt;  3333/TCP</span><br><span class="line">TargetPort:        80/TCP</span><br><span class="line">Endpoints:         10.28.2.32:80 </span><br><span class="line">Session Affinity:  None</span><br><span class="line">Events:            &lt;none&gt;</span><br></pre></td></tr></table></figure>

<p>Or even shorter:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n pluto get ep</span><br><span class="line">NAME                  ENDPOINTS       AGE</span><br><span class="line">project-plt-6cc-svc   10.28.2.32:80   84m</span><br></pre></td></tr></table></figure>

<p>Yes, endpoint there! Finally we check the connection using a temporary <em>Pod</em>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k run tmp --restart=Never --rm --image=nginx:alpine -i -- curl http://project-plt-6cc-svc.pluto:3333</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100   612  100   612    0     0  32210      0 --:--:-- --:--:-- --:--:-- 32210</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Great! Notice that we use the Kubernetes <em>Namespace</em> dns resolving (<code>project-plt-6cc-svc.pluto</code>) here. We could only use the <em>Service</em> name if we would also spin up the temporary <em>Pod</em> in <em>Namespace</em> <code>pluto</code> .</p>
<p>And now really finally copy or pipe the html content into <code>/opt/course/10/service_test.html</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># /opt/course/10/service_test.html</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Also the requested logs:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n pluto logs project-plt-6cc-api &gt; /opt/course/10/service_test.log</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># /opt/course/10/service_test.log</span><br><span class="line">10.44.0.0 - - [22/Jan/2021:23:19:55 +0000] &quot;GET / HTTP/1.1&quot; 200 612 &quot;-&quot; &quot;curl/7.69.1&quot; &quot;-&quot;</span><br></pre></td></tr></table></figure>

<p> </p>
<p> </p>
<h2 id="Question-11-Working-with-Containers"><a href="#Question-11-Working-with-Containers" class="headerlink" title="Question 11 | Working with Containers"></a>Question 11 | Working with Containers</h2><p> </p>
<p>Solve this question on instance: <code>ssh ckad9043</code></p>
<p> </p>
<p>There are files to build a container image located at <code>/opt/course/11/image</code> on <code>ckad9043</code>. The container will run a Golang application which outputs information to stdout. You’re asked to perform the following tasks:</p>
<p> </p>
<blockquote>
<p>ℹ️ Run all Docker and Podman commands as user root. Use <code>sudo docker</code> and <code>sudo podman</code> or become root with <code>sudo -i</code></p>
</blockquote>
<p> </p>
<ol>
<li><p>Change the Dockerfile: set ENV variable <code>SUN_CIPHER_ID</code> to hardcoded value <code>5b9c1065-e39d-4a43-a04a-e59bcea3e03f</code></p>
</li>
<li><p>Build the image using <code>sudo docker</code>, tag it <code>registry.killer.sh:5000/sun-cipher:v1-docker</code> and push it to the registry</p>
</li>
<li><p>Build the image using <code>sudo podman</code>, tag it <code>registry.killer.sh:5000/sun-cipher:v1-podman</code> and push it to the registry</p>
</li>
<li><p>Run a container using <code>sudo podman</code>, which keeps running detached in the background, named <code>sun-cipher</code> using image <code>registry.killer.sh:5000/sun-cipher:v1-podman</code></p>
</li>
<li><p>Write the logs your container <code>sun-cipher</code> produces into <code>/opt/course/11/logs</code> on <code>ckad9043</code></p>
</li>
</ol>
<p> </p>
<h5 id="Answer-10"><a href="#Answer-10" class="headerlink" title="Answer"></a>Answer</h5><p><em>Dockerfile</em>: list of commands from which an <em>Image</em> can be build</p>
<p><em>Image</em>: binary file which includes all data&#x2F;requirements to be run as a <em>Container</em></p>
<p><em>Container</em>: running instance of an <em>Image</em></p>
<p><em>Registry</em>: place where we can push&#x2F;pull <em>Images</em> to&#x2F;from</p>
<p> </p>
<h6 id="Step-1-1"><a href="#Step-1-1" class="headerlink" title="Step 1"></a>Step 1</h6><p>We should probably create a backup:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ cp /opt/course/11/image/Dockerfile /opt/course/11/image/Dockerfile_bak</span><br></pre></td></tr></table></figure>

<p>First we need to change the <code>/opt/course/11/logs/Dockerfile</code> to:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># build container stage 1</span><br><span class="line">FROM docker.io/library/golang:1.15.15-alpine3.14</span><br><span class="line">WORKDIR /src</span><br><span class="line">COPY . .</span><br><span class="line">RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o bin/app .</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># app container stage 2</span><br><span class="line">FROM docker.io/library/alpine:3.12.4</span><br><span class="line">COPY --from=0 /src/bin/app app</span><br><span class="line"># CHANGE NEXT LINE</span><br><span class="line">ENV SUN_CIPHER_ID=5b9c1065-e39d-4a43-a04a-e59bcea3e03f</span><br><span class="line">CMD [&quot;./app&quot;]</span><br></pre></td></tr></table></figure>

<p> </p>
<h6 id="Step-2-1"><a href="#Step-2-1" class="headerlink" title="Step 2"></a>Step 2</h6><p>Then we build the image using Docker:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ cd /opt/course/11/image</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ sudo docker build -t registry.killer.sh:5000/sun-cipher:v1-docker .</span><br><span class="line">...</span><br><span class="line">Successfully built 409fde3c5bf9</span><br><span class="line">Successfully tagged registry.killer.sh:5000/sun-cipher:v1-docker</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ sudo docker image ls</span><br><span class="line">REPOSITORY                           TAG         IMAGE ID       CREATED           SIZE</span><br><span class="line">registry.killer.sh:5000/sun-cipher   v1-docker   409fde3c5bf9   24 seconds ago    7.76MB</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ sudo docker push registry.killer.sh:5000/sun-cipher:v1-docker</span><br><span class="line">The push refers to repository [registry.killer.sh:5000/sun-cipher]</span><br><span class="line">c947fb5eba52: Pushed </span><br><span class="line">33e8713114f8: Pushed </span><br><span class="line">latest: digest: sha256:d216b4136a5b232b738698e826e7d12fccba9921d163b63777be23572250f23d size: 739</span><br></pre></td></tr></table></figure>

<p>There we go, built and pushed.</p>
<p> </p>
<h6 id="Step-3-1"><a href="#Step-3-1" class="headerlink" title="Step 3"></a>Step 3</h6><p>Next we build the image using Podman. Here it’s only required to create one tag. The usage of Podman is very similar (for most cases even identical) to Docker:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ cd /opt/course/11/image</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ sudo podman build -t registry.killer.sh:5000/sun-cipher:v1-podman .</span><br><span class="line">...</span><br><span class="line">--&gt; 38adc53bd92</span><br><span class="line">Successfully tagged registry.killer.sh:5000/sun-cipher:v1-podman</span><br><span class="line">38adc53bd92881d91981c4b537f4f1b64f8de1de1b32eacc8479883170cee537</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ sudo podman image ls</span><br><span class="line">REPOSITORY                          TAG         IMAGE ID      CREATED        SIZE</span><br><span class="line">registry.killer.sh:5000/sun-cipher  v1-podman   38adc53bd928  2 minutes ago  8.03 MB</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ sudo podman push registry.killer.sh:5000/sun-cipher:v1-podman</span><br><span class="line">Getting image source signatures</span><br><span class="line">Copying blob 4d0d60db9eb6 done  </span><br><span class="line">Copying blob 33e8713114f8 done  </span><br><span class="line">Copying config bfa1a225f8 done  </span><br><span class="line">Writing manifest to image destination</span><br><span class="line">Storing signatures</span><br></pre></td></tr></table></figure>

<p>Built and pushed using Podman.</p>
<p> </p>
<h6 id="Step-4-1"><a href="#Step-4-1" class="headerlink" title="Step 4"></a>Step 4</h6><p>We’ll create a container from the perviously created image, using Podman, which keeps running in the background:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ sudo podman run -d --name sun-cipher registry.killer.sh:5000/sun-cipher:v1-podman</span><br><span class="line">f8199cba792f9fd2d1bd4decc9b7a9c0acfb975d95eda35f5f583c9efbf95589</span><br></pre></td></tr></table></figure>

<p> </p>
<h6 id="Step-5"><a href="#Step-5" class="headerlink" title="Step 5"></a>Step 5</h6><p>Finally we need to collect some information into files:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ sudo podman logs sun-cipher</span><br><span class="line">2077/03/13 06:50:34 random number for 5b9c1065-e39d-4a43-a04a-e59bcea3e03f is 8081</span><br><span class="line">2077/03/13 06:50:34 random number for 5b9c1065-e39d-4a43-a04a-e59bcea3e03f is 7887</span><br><span class="line">2077/03/13 06:50:34 random number for 5b9c1065-e39d-4a43-a04a-e59bcea3e03f is 1847</span><br><span class="line">2077/03/13 06:50:34 random number for 5b9c1065-e39d-4a43-a04a-e59bcea3e03f is 4059</span><br><span class="line">2077/03/13 06:50:34 random number for 5b9c1065-e39d-4a43-a04a-e59bcea3e03f is 2081</span><br><span class="line">2077/03/13 06:50:34 random number for 5b9c1065-e39d-4a43-a04a-e59bcea3e03f is 1318</span><br><span class="line">2077/03/13 06:50:34 random number for 5b9c1065-e39d-4a43-a04a-e59bcea3e03f is 4425</span><br><span class="line">2077/03/13 06:50:34 random number for 5b9c1065-e39d-4a43-a04a-e59bcea3e03f is 2540</span><br><span class="line">2077/03/13 06:50:34 random number for 5b9c1065-e39d-4a43-a04a-e59bcea3e03f is 456</span><br><span class="line">2077/03/13 06:50:34 random number for 5b9c1065-e39d-4a43-a04a-e59bcea3e03f is 3300</span><br><span class="line">2077/03/13 06:50:34 random number for 5b9c1065-e39d-4a43-a04a-e59bcea3e03f is 694</span><br><span class="line">2077/03/13 06:50:34 random number for 5b9c1065-e39d-4a43-a04a-e59bcea3e03f is 8511</span><br><span class="line">2077/03/13 06:50:44 random number for 5b9c1065-e39d-4a43-a04a-e59bcea3e03f is 8162</span><br><span class="line">2077/03/13 06:50:54 random number for 5b9c1065-e39d-4a43-a04a-e59bcea3e03f is 5089</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ sudo podman logs sun-cipher &gt; /opt/course/11/logs</span><br></pre></td></tr></table></figure>

<p>This is looking not too bad at all. Our container skills are back in town!</p>
<p> </p>
<p> </p>
<h2 id="Question-12-Storage-PV-PVC-Pod-volume"><a href="#Question-12-Storage-PV-PVC-Pod-volume" class="headerlink" title="Question 12 | Storage, PV, PVC, Pod volume"></a>Question 12 | Storage, PV, PVC, Pod volume</h2><p> </p>
<p>Solve this question on instance: <code>ssh ckad5601</code></p>
<p> </p>
<p>Create a new <em>PersistentVolume</em> named <code>earth-project-earthflower-pv</code>. It should have a capacity of <em>2Gi</em>, accessMode <em>ReadWriteOnce</em>, hostPath <code>/Volumes/Data</code> and no storageClassName defined.</p>
<p>Next create a new <em>PersistentVolumeClaim</em> in <em>Namespace</em> <code>earth</code> named <code>earth-project-earthflower-pvc</code> . It should request <em>2Gi</em> storage, accessMode <em>ReadWriteOnce</em> and should not define a storageClassName. The <em>PVC</em> should bound to the <em>PV</em> correctly.</p>
<p>Finally create a new <em>Deployment</em> <code>project-earthflower</code> in <em>Namespace</em> <code>earth</code> which mounts that volume at <code>/tmp/project-data</code>. The <em>Pods</em> of that <em>Deployment</em> should be of image <code>httpd:2.4.41-alpine</code>.</p>
<p> </p>
<h5 id="Answer-11"><a href="#Answer-11" class="headerlink" title="Answer"></a>Answer</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">vim 12_pv.yaml</span><br></pre></td></tr></table></figure>

<p>Find an example from <a target="_blank" rel="noopener" href="https://kubernetes.io/docs">https://kubernetes.io/docs</a> and alter it:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># 12_pv.yaml</span><br><span class="line">kind: PersistentVolume</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line"> name: earth-project-earthflower-pv</span><br><span class="line">spec:</span><br><span class="line"> capacity:</span><br><span class="line">  storage: 2Gi</span><br><span class="line"> accessModes:</span><br><span class="line">  - ReadWriteOnce</span><br><span class="line"> hostPath:</span><br><span class="line">  path: &quot;/Volumes/Data&quot;</span><br></pre></td></tr></table></figure>

<p>Then create it:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -f 12_pv.yaml create</span><br></pre></td></tr></table></figure>

<p>Next the <em>PersistentVolumeClaim</em>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">vim 12_pvc.yaml</span><br></pre></td></tr></table></figure>

<p>Find an example from <a target="_blank" rel="noopener" href="https://kubernetes.io/docs">https://kubernetes.io/docs</a> and alter it:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># 12_pvc.yaml</span><br><span class="line">kind: PersistentVolumeClaim</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  name: earth-project-earthflower-pvc</span><br><span class="line">  namespace: earth</span><br><span class="line">spec:</span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadWriteOnce</span><br><span class="line">  resources:</span><br><span class="line">    requests:</span><br><span class="line">     storage: 2Gi</span><br></pre></td></tr></table></figure>

<p>Then create:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -f 12_pvc.yaml create</span><br></pre></td></tr></table></figure>

<p>And check that both have the status Bound:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n earth get pv,pvc</span><br><span class="line">NAME                                 CAPACITY   ACCESS MODES   ...  STATUS   CLAIM </span><br><span class="line">persistentvolume/...earthflower-pv   2Gi        RWO            ...  Bound    ...er-pvc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NAME                                       STATUS   VOLUME                         CAPACITY</span><br><span class="line">persistentvolumeclaim/...earthflower-pvc   Bound    earth-project-earthflower-pv   2Gi</span><br></pre></td></tr></table></figure>

<p>Next we create a <em>Deployment</em> and mount that volume:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n earth create deploy project-earthflower --image=httpd:2.4.41-alpine --dry-run=client -oyaml &gt; 12_dep.yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim 12_dep.yaml</span><br></pre></td></tr></table></figure>

<p>Alter the yaml to mount the volume:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># 12_dep.yaml</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: null</span><br><span class="line">  labels:</span><br><span class="line">    app: project-earthflower</span><br><span class="line">  name: project-earthflower</span><br><span class="line">  namespace: earth</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: project-earthflower</span><br><span class="line">  strategy: &#123;&#125;</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      creationTimestamp: null</span><br><span class="line">      labels:</span><br><span class="line">        app: project-earthflower</span><br><span class="line">    spec:</span><br><span class="line">      volumes:                                      # add</span><br><span class="line">      - name: data                                  # add</span><br><span class="line">        persistentVolumeClaim:                      # add</span><br><span class="line">          claimName: earth-project-earthflower-pvc  # add</span><br><span class="line">      containers:</span><br><span class="line">      - image: httpd:2.4.41-alpine</span><br><span class="line">        name: container</span><br><span class="line">        volumeMounts:                               # add</span><br><span class="line">        - name: data                                # add</span><br><span class="line">          mountPath: /tmp/project-data              # add</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -f 12_dep.yaml create</span><br></pre></td></tr></table></figure>

<p>We can confirm it’s mounting correctly:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n earth describe pod project-earthflower-d6887f7c5-pn5wv | grep -A2 Mounts:   </span><br><span class="line">    Mounts:</span><br><span class="line">      /tmp/project-data from data (rw) # there it is</span><br><span class="line">      /var/run/secrets/kubernetes.io/serviceaccount from default-token-n2sjj (ro)</span><br></pre></td></tr></table></figure>

<p> </p>
<p> </p>
<h2 id="Question-13-Storage-StorageClass-PVC"><a href="#Question-13-Storage-StorageClass-PVC" class="headerlink" title="Question 13 | Storage, StorageClass, PVC"></a>Question 13 | Storage, StorageClass, PVC</h2><p> </p>
<p>Solve this question on instance: <code>ssh ckad9043</code></p>
<p> </p>
<p>Team Moonpie, which has the <em>Namespace</em> <code>moon</code>, needs more storage. Create a new <em>PersistentVolumeClaim</em> named <code>moon-pvc-126</code> in that namespace. This claim should use a new <em>StorageClass</em> <code>moon-retain</code> with the <em>provisioner</em> set to <code>moon-retainer</code> and the <em>reclaimPolicy</em> set to <em>Retain</em>. The claim should request storage of <em>3Gi</em>, an <em>accessMode</em> of <em>ReadWriteOnce</em> and should use the new <em>StorageClass</em>.</p>
<p>The provisioner <code>moon-retainer</code> will be created by another team, so it’s expected that the <em>PVC</em> will not boot yet. Confirm this by writing the event message from the <em>PVC</em> into file <code>/opt/course/13/pvc-126-reason</code> on <code>ckad9043</code>.</p>
<p> </p>
<h5 id="Answer-12"><a href="#Answer-12" class="headerlink" title="Answer"></a>Answer</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">vim 13_sc.yaml</span><br></pre></td></tr></table></figure>

<p>Head to <a target="_blank" rel="noopener" href="https://kubernetes.io/docs">https://kubernetes.io/docs</a>, search for “storageclass” and alter the example code to this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># 13_sc.yaml</span><br><span class="line">apiVersion: storage.k8s.io/v1</span><br><span class="line">kind: StorageClass</span><br><span class="line">metadata:</span><br><span class="line">  name: moon-retain</span><br><span class="line">provisioner: moon-retainer</span><br><span class="line">reclaimPolicy: Retain</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k create -f 13_sc.yaml</span><br></pre></td></tr></table></figure>

<p>Now the same for the <em>PersistentVolumeClaim</em>, head to the docs, copy an example and transform it into:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">vim 13_pvc.yaml</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># 13_pvc.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolumeClaim</span><br><span class="line">metadata:</span><br><span class="line">  name: moon-pvc-126            # name as requested</span><br><span class="line">  namespace: moon               # important</span><br><span class="line">spec:</span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadWriteOnce             # RWO</span><br><span class="line">  resources:</span><br><span class="line">    requests:</span><br><span class="line">      storage: 3Gi              # size</span><br><span class="line">  storageClassName: moon-retain # uses our new storage class</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -f 13_pvc.yaml create</span><br></pre></td></tr></table></figure>

<p>Next we check the status of the <em>PVC</em> :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n moon get pvc</span><br><span class="line">NAME           STATUS    VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br><span class="line">moon-pvc-126   Pending                                      moon-retain    2m57s</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n moon describe pvc moon-pvc-126</span><br><span class="line">Name:          moon-pvc-126</span><br><span class="line">...</span><br><span class="line">Status:        Pending</span><br><span class="line">...</span><br><span class="line">Events:</span><br><span class="line">  Type    Reason                Age                  From                         Message</span><br><span class="line">  ----    ------                ----                 ----                         -------</span><br><span class="line">Normal  ExternalProvisioning  4s (x19 over 4m28s)  persistentvolume-controller    Waiting for a volume to be created either by the external provisioner &#x27;moon-retainer&#x27; or manually by the system administrator. If volume creation is delayed, please verify that the provisioner is running and correctly registered.</span><br></pre></td></tr></table></figure>

<p>This confirms that the <em>PVC</em> waits for the provisioner <code>moon-retainer</code> to be created. Finally we copy or write the event message into the requested location:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># /opt/course/13/pvc-126-reason</span><br><span class="line">Waiting for a volume to be created either by the external provisioner &#x27;moon-retainer&#x27; or manually by the system administrator. If volume creation is delayed, please verify that the provisioner is running and correctly registered.</span><br></pre></td></tr></table></figure>

<p> </p>
<p> </p>
<h2 id="Question-14-Secret-Secret-Volume-Secret-Env"><a href="#Question-14-Secret-Secret-Volume-Secret-Env" class="headerlink" title="Question 14 | Secret, Secret-Volume, Secret-Env"></a>Question 14 | Secret, Secret-Volume, Secret-Env</h2><p> </p>
<p>Solve this question on instance: <code>ssh ckad9043</code></p>
<p> </p>
<p>You need to make changes on an existing <em>Pod</em> in <em>Namespace</em> <code>moon</code> called <code>secret-handler</code>. Create a new <em>Secret</em> <code>secret1</code> which contains <code>user=test</code> and <code>pass=pwd</code>. The <em>Secret</em>‘s content should be available in <em>Pod</em> <code>secret-handler</code> as environment variables <code>SECRET1_USER</code> and <code>SECRET1_PASS</code>. The yaml for <em>Pod</em> <code>secret-handler</code> is available at <code>/opt/course/14/secret-handler.yaml</code>.</p>
<p>There is existing yaml for another <em>Secret</em> at <code>/opt/course/14/secret2.yaml</code>, create this <em>Secret</em> and mount it inside the same <em>Pod</em> at <code>/tmp/secret2</code>. Your changes should be saved under <code>/opt/course/14/secret-handler-new.yaml</code> on <code>ckad9043</code>. Both <em>Secrets</em> should only be available in <em>Namespace</em> <code>moon</code>.</p>
<p> </p>
<h5 id="Answer-13"><a href="#Answer-13" class="headerlink" title="Answer"></a>Answer</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n moon get pod # show pods</span><br><span class="line">k -n moon create secret -h # help</span><br><span class="line">k -n moon create secret generic -h # help</span><br><span class="line">k -n moon create secret generic secret1 --from-literal user=test --from-literal pass=pwd</span><br></pre></td></tr></table></figure>

<p>The last command would generate this yaml:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">apiVersion: v1</span><br><span class="line">data:</span><br><span class="line">  pass: cHdk</span><br><span class="line">  user: dGVzdA==</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: null</span><br><span class="line">  name: secret1</span><br><span class="line">  namespace: moon</span><br></pre></td></tr></table></figure>

<p>Next we create the second <em>Secret</em> from the given location, making sure it’ll be created in <em>Namespace</em> <code>moon</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n moon -f /opt/course/14/secret2.yaml create</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n moon get secret</span><br><span class="line">NAME                  TYPE                                  DATA   AGE</span><br><span class="line">default-token-rvzcf   kubernetes.io/service-account-token   3      66m</span><br><span class="line">secret1               Opaque                                2      4m3s</span><br><span class="line">secret2               Opaque                                1      8s</span><br></pre></td></tr></table></figure>

<p>We will now edit the <em>Pod</em> yaml:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">cp /opt/course/14/secret-handler.yaml /opt/course/14/secret-handler-new.yaml</span><br><span class="line">vim /opt/course/14/secret-handler-new.yaml</span><br></pre></td></tr></table></figure>

<p>Add the following to the yaml:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># /opt/course/14/secret-handler-new.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    id: secret-handler</span><br><span class="line">    uuid: 1428721e-8d1c-4c09-b5d6-afd79200c56a</span><br><span class="line">    red_ident: 9cf7a7c0-fdb2-4c35-9c13-c2a0bb52b4a9</span><br><span class="line">    type: automatic</span><br><span class="line">  name: secret-handler</span><br><span class="line">  namespace: moon</span><br><span class="line">spec:</span><br><span class="line">  volumes:</span><br><span class="line">  - name: cache-volume1</span><br><span class="line">    emptyDir: &#123;&#125;</span><br><span class="line">  - name: cache-volume2</span><br><span class="line">    emptyDir: &#123;&#125;</span><br><span class="line">  - name: cache-volume3</span><br><span class="line">    emptyDir: &#123;&#125;</span><br><span class="line">  - name: secret2-volume              # add</span><br><span class="line">    secret:                           # add</span><br><span class="line">      secretName: secret2             # add</span><br><span class="line">  containers:</span><br><span class="line">  - name: secret-handler</span><br><span class="line">    image: bash:5.0.11</span><br><span class="line">    args: [&#x27;bash&#x27;, &#x27;-c&#x27;, &#x27;sleep 2d&#x27;]</span><br><span class="line">    volumeMounts:</span><br><span class="line">    - mountPath: /cache1</span><br><span class="line">      name: cache-volume1</span><br><span class="line">    - mountPath: /cache2</span><br><span class="line">      name: cache-volume2</span><br><span class="line">    - mountPath: /cache3</span><br><span class="line">      name: cache-volume3</span><br><span class="line">    - name: secret2-volume            # add</span><br><span class="line">      mountPath: /tmp/secret2         # add</span><br><span class="line">    env:</span><br><span class="line">    - name: SECRET_KEY_1</span><br><span class="line">      value: &quot;&gt;8$kH#kj..i8&#125;HImQd&#123;&quot;</span><br><span class="line">    - name: SECRET_KEY_2</span><br><span class="line">      value: &quot;IO=a4L/XkRdvN8jM=Y+&quot;</span><br><span class="line">    - name: SECRET_KEY_3</span><br><span class="line">      value: &quot;-7PA0_Z]&gt;&#123;pwa43r)__&quot;</span><br><span class="line">    - name: SECRET1_USER              # add</span><br><span class="line">      valueFrom:                      # add</span><br><span class="line">        secretKeyRef:                 # add</span><br><span class="line">          name: secret1               # add</span><br><span class="line">          key: user                   # add</span><br><span class="line">    - name: SECRET1_PASS              # add</span><br><span class="line">      valueFrom:                      # add</span><br><span class="line">        secretKeyRef:                 # add</span><br><span class="line">          name: secret1               # add</span><br><span class="line">          key: pass                   # add</span><br></pre></td></tr></table></figure>

<p>There is also the possibility to import all keys from a <em>Secret</em> as env variables at once, though the env variable names will then be the same as in the <em>Secret</em>, which doesn’t work for the requirements here:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">  containers:</span><br><span class="line">  - name: secret-handler</span><br><span class="line">...</span><br><span class="line">    envFrom:</span><br><span class="line">    - secretRef:        # also works for configMapRef</span><br><span class="line">        name: secret1</span><br></pre></td></tr></table></figure>

<p>Then we apply the changes:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -f /opt/course/14/secret-handler.yaml delete --force --grace-period=0</span><br><span class="line">k -f /opt/course/14/secret-handler-new.yaml create</span><br></pre></td></tr></table></figure>

<p>Instead of running delete and create we can also use recreate:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -f /opt/course/14/secret-handler-new.yaml replace --force --grace-period=0</span><br></pre></td></tr></table></figure>

<p>It was not requested directly, but you should always confirm it’s working:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n moon exec secret-handler -- env | grep SECRET1</span><br><span class="line">SECRET1_USER=test</span><br><span class="line">SECRET1_PASS=pwd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ k -n moon exec secret-handler -- find /tmp/secret2 </span><br><span class="line">/tmp/secret2</span><br><span class="line">/tmp/secret2/..data</span><br><span class="line">/tmp/secret2/key</span><br><span class="line">/tmp/secret2/..2019_09_11_09_03_08.147048594</span><br><span class="line">/tmp/secret2/..2019_09_11_09_03_08.147048594/key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ k -n moon exec secret-handler -- cat /tmp/secret2/key</span><br><span class="line">12345678</span><br></pre></td></tr></table></figure>

<p> </p>
<p> </p>
<h2 id="Question-15-ConfigMap-Configmap-Volume"><a href="#Question-15-ConfigMap-Configmap-Volume" class="headerlink" title="Question 15 | ConfigMap, Configmap-Volume"></a>Question 15 | ConfigMap, Configmap-Volume</h2><p> </p>
<p>Solve this question on instance: <code>ssh ckad9043</code></p>
<p> </p>
<p>Team Moonpie has a nginx server <em>Deployment</em> called <code>web-moon</code> in <em>Namespace</em> <code>moon</code>. Someone started configuring it but it was never completed. To complete please create a <em>ConfigMap</em> called <code>configmap-web-moon-html</code> containing the content of file <code>/opt/course/15/web-moon.html</code> under the data key-name <code>index.html</code>.</p>
<p>The <em>Deployment</em> <code>web-moon</code> is already configured to work with this <em>ConfigMap</em> and serve its content. Test the nginx configuration for example using <code>curl</code> from a temporary <code>nginx:alpine</code> <em>Pod</em>.</p>
<p> </p>
<h5 id="Answer-14"><a href="#Answer-14" class="headerlink" title="Answer"></a>Answer</h5><p>Let’s check the existing <em>Pods</em>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n moon get pod</span><br><span class="line">NAME                        READY   STATUS              RESTARTS   AGE</span><br><span class="line">secret-handler              1/1     Running             0          55m</span><br><span class="line">web-moon-847496c686-2rzj4   0/1     ContainerCreating   0          33s</span><br><span class="line">web-moon-847496c686-9nwwj   0/1     ContainerCreating   0          33s</span><br><span class="line">web-moon-847496c686-cxdbx   0/1     ContainerCreating   0          33s</span><br><span class="line">web-moon-847496c686-hvqlw   0/1     ContainerCreating   0          33s</span><br><span class="line">web-moon-847496c686-tj7ct   0/1     ContainerCreating   0          33s</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n moon describe pod web-moon-847496c686-2rzj4</span><br><span class="line">...</span><br><span class="line">Warning  FailedMount  31s (x7 over 63s)  kubelet, gke-test-default-pool-ce83a51a-p6s4  MountVolume.SetUp failed for volume &quot;html-volume&quot; : configmaps &quot;configmap-web-moon-html&quot; not found</span><br></pre></td></tr></table></figure>

<p>Good so far, now let’s create the missing <em>ConfigMap</em>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n moon create configmap -h # help</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">k -n moon create configmap configmap-web-moon-html --from-file=index.html=/opt/course/15/web-moon.html # important to set the index.html key</span><br></pre></td></tr></table></figure>

<p>This should create a <em>ConfigMap</em> with yaml like:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">apiVersion: v1</span><br><span class="line">data:</span><br><span class="line">  index.html: |     # notice the key index.html, this will be the filename when mounted</span><br><span class="line">    &lt;!DOCTYPE html&gt;</span><br><span class="line">    &lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">        &lt;title&gt;Web Moon Webpage&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">    This is some great content.</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">    &lt;/html&gt;</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: null</span><br><span class="line">  name: configmap-web-moon-html</span><br><span class="line">  namespace: moon</span><br></pre></td></tr></table></figure>

<p>After waiting a bit or deleting&#x2F;recreating (<code>k -n moon rollout restart deploy web-moon</code>) the <em>Pods</em> we should see:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n moon get pod</span><br><span class="line">NAME                        READY   STATUS    RESTARTS   AGE</span><br><span class="line">secret-handler              1/1     Running   0          59m</span><br><span class="line">web-moon-847496c686-2rzj4   1/1     Running   0          4m28s</span><br><span class="line">web-moon-847496c686-9nwwj   1/1     Running   0          4m28s</span><br><span class="line">web-moon-847496c686-cxdbx   1/1     Running   0          4m28s</span><br><span class="line">web-moon-847496c686-hvqlw   1/1     Running   0          4m28s</span><br><span class="line">web-moon-847496c686-tj7ct   1/1     Running   0          4m28s</span><br></pre></td></tr></table></figure>

<p>Looking much better. Finally we check if the nginx returns the correct content:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n moon get pod -o wide # get pod cluster IPs</span><br></pre></td></tr></table></figure>

<p>Then use one IP to test the configuration:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k run tmp --restart=Never --rm -i --image=nginx:alpine -- curl 10.44.0.78</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100   161  100   161    0     0  80500      0 --:--:-- --:--:-- --:--:--  157k</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Web Moon Webpage&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">This is some great content.</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

<p>For debugging or further checks we could find out more about the <em>Pods</em> volume mounts:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n moon describe pod web-moon-c77655cc-dc8v4 | grep -A2 Mounts:</span><br><span class="line">    Mounts:</span><br><span class="line">      /usr/share/nginx/html from html-volume (rw)</span><br><span class="line">      /var/run/secrets/kubernetes.io/serviceaccount from default-token-rvzcf (ro)</span><br></pre></td></tr></table></figure>

<p>And check the mounted folder content:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n moon exec web-moon-c77655cc-dc8v4 find /usr/share/nginx/html</span><br><span class="line">/usr/share/nginx/html</span><br><span class="line">/usr/share/nginx/html/..2019_09_11_10_05_56.336284411</span><br><span class="line">/usr/share/nginx/html/..2019_09_11_10_05_56.336284411/index.html</span><br><span class="line">/usr/share/nginx/html/..data</span><br><span class="line">/usr/share/nginx/html/index.html</span><br></pre></td></tr></table></figure>

<p>Here it was important that the file will have the name <code>index.html</code> and not the original one <code>web-moon.html</code> which is controlled through the <em>ConfigMap</em> data key.</p>
<p> </p>
<p> </p>
<h2 id="Question-16-Logging-sidecar"><a href="#Question-16-Logging-sidecar" class="headerlink" title="Question 16 | Logging sidecar"></a>Question 16 | Logging sidecar</h2><p> </p>
<p>Solve this question on instance: <code>ssh ckad7326</code></p>
<p> </p>
<p>The Tech Lead of Mercury2D decided it’s time for more logging, to finally fight all these missing data incidents. There is an existing container named <code>cleaner-con</code> in <em>Deployment</em> <code>cleaner</code> in <em>Namespace</em> <code>mercury</code>. This container mounts a volume and writes logs into a file called <code>cleaner.log</code>.</p>
<p>The yaml for the existing <em>Deployment</em> is available at <code>/opt/course/16/cleaner.yaml</code>. Persist your changes at <code>/opt/course/16/cleaner-new.yaml</code> on <code>ckad7326</code> but also make sure the <em>Deployment</em> is running.</p>
<p>Create a sidecar container named <code>logger-con</code>, image <code>busybox:1.31.0</code> , which mounts the same volume and writes the content of <code>cleaner.log</code> to stdout, you can use the <code>tail -f</code> command for this. This way it can be picked up by <code>kubectl logs</code>.</p>
<p>Check if the logs of the new container reveal something about the missing data incidents.</p>
<p> </p>
<h5 id="Answer-15"><a href="#Answer-15" class="headerlink" title="Answer"></a>Answer</h5><p>Sidecar containers in K8s are <code>initContainers</code> with <code>restartPolicy: Always</code>. Search for “Sidecar Containers” in the K8s Docs to familiarise yourself if necessary.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">cp /opt/course/16/cleaner.yaml /opt/course/16/cleaner-new.yaml</span><br><span class="line">vim /opt/course/16/cleaner-new.yaml</span><br></pre></td></tr></table></figure>

<p>Add a sidecar container which outputs the log file to stdout:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># /opt/course/16/cleaner-new.yaml</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: null</span><br><span class="line">  name: cleaner</span><br><span class="line">  namespace: mercury</span><br><span class="line">spec:</span><br><span class="line">  replicas: 2</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      id: cleaner</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        id: cleaner</span><br><span class="line">    spec:</span><br><span class="line">      volumes:</span><br><span class="line">      - name: logs</span><br><span class="line">        emptyDir: &#123;&#125;</span><br><span class="line">      initContainers:</span><br><span class="line">      - name: init</span><br><span class="line">        image: bash:5.0.11</span><br><span class="line">        command: [&#x27;bash&#x27;, &#x27;-c&#x27;, &#x27;echo init &gt; /var/log/cleaner/cleaner.log&#x27;]</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: logs</span><br><span class="line">          mountPath: /var/log/cleaner</span><br><span class="line">      - name: logger-con                                                # add</span><br><span class="line">        image: busybox:1.31.0                                           # add</span><br><span class="line">        restartPolicy: Always                                           # add</span><br><span class="line">        command: [&quot;sh&quot;, &quot;-c&quot;, &quot;tail -f /var/log/cleaner/cleaner.log&quot;]   # add</span><br><span class="line">        volumeMounts:                                                   # add</span><br><span class="line">        - name: logs                                                    # add</span><br><span class="line">          mountPath: /var/log/cleaner                                   # add</span><br><span class="line">      containers:</span><br><span class="line">      - name: cleaner-con</span><br><span class="line">        image: bash:5.0.11</span><br><span class="line">        args: [&#x27;bash&#x27;, &#x27;-c&#x27;, &#x27;while true; do echo `date`: &quot;remove random file&quot; &gt;&gt; /var/log/cleaner/cleaner.log; sleep 1; done&#x27;]</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: logs</span><br><span class="line">          mountPath: /var/log/cleaner</span><br></pre></td></tr></table></figure>

<p>In earlier K8s versions it was necessary to define sidecar containers as additional application containers under <code>containers:</code> like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># LEGACY example of defining sidecar containers in earlier K8s versions</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: null</span><br><span class="line">  name: cleaner</span><br><span class="line">  namespace: mercury</span><br><span class="line">spec:</span><br><span class="line">...</span><br><span class="line">  template:</span><br><span class="line">...</span><br><span class="line">    spec:</span><br><span class="line">...</span><br><span class="line">      initContainers:</span><br><span class="line">      - name: init</span><br><span class="line">        image: bash:5.0.11</span><br><span class="line">...</span><br><span class="line">      containers:</span><br><span class="line">      - name: cleaner-con</span><br><span class="line">        image: bash:5.0.11</span><br><span class="line">...</span><br><span class="line">      - name: logger-con                                                # LEGACY example</span><br><span class="line">        image: busybox:1.31.0                                           # LEGACY example</span><br><span class="line">        command: [&quot;sh&quot;, &quot;-c&quot;, &quot;tail -f /var/log/cleaner/cleaner.log&quot;]   # LEGACY example</span><br><span class="line">        volumeMounts:                                                   # LEGACY example</span><br><span class="line">        - name: logs                                                    # LEGACY example</span><br><span class="line">          mountPath: /var/log/cleaner                                   # LEGACY example</span><br></pre></td></tr></table></figure>

<p>Then apply the changes and check the logs of the sidecar:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -f /opt/course/16/cleaner-new.yaml apply</span><br></pre></td></tr></table></figure>

<p>This will cause a deployment rollout of which we can get more details:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n mercury rollout history deploy cleaner</span><br><span class="line">k -n mercury rollout history deploy cleaner --revision 1</span><br><span class="line">k -n mercury rollout history deploy cleaner --revision 2</span><br></pre></td></tr></table></figure>

<p>Check <em>Pod</em> statuses:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n mercury get pod</span><br><span class="line">NAME                       READY   STATUS        RESTARTS   AGE</span><br><span class="line">cleaner-86b7758668-9pw6t   2/2     Running       0          6s</span><br><span class="line">cleaner-86b7758668-qgh4v   0/2     Init:0/1      0          1s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ k -n mercury get pod</span><br><span class="line">NAME                       READY   STATUS        RESTARTS   AGE</span><br><span class="line">cleaner-86b7758668-9pw6t   2/2     Running       0          14s</span><br><span class="line">cleaner-86b7758668-qgh4v   2/2     Running       0          9s</span><br></pre></td></tr></table></figure>

<p>Finally check the logs of the logging sidecar container:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n mercury logs cleaner-576967576c-cqtgx -c logger-con</span><br><span class="line">init</span><br><span class="line">Wed Sep 11 10:45:44 UTC 2099: remove random file</span><br><span class="line">Wed Sep 11 10:45:45 UTC 2099: remove random file</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Mystery solved, something is removing files at random ;) It’s important to understand how containers can communicate with each other using volumes.</p>
<p> </p>
<p> </p>
<h2 id="Question-17-InitContainer"><a href="#Question-17-InitContainer" class="headerlink" title="Question 17 | InitContainer"></a>Question 17 | InitContainer</h2><p> </p>
<p>Solve this question on instance: <code>ssh ckad5601</code></p>
<p> </p>
<p>Last lunch you told your coworker from department Mars Inc how amazing <em>InitContainer</em>s are. Now he would like to see one in action. There is a <em>Deployment</em> yaml at <code>/opt/course/17/test-init-container.yaml</code>. This <em>Deployment</em> spins up a single <em>Pod</em> of image <code>nginx:1.17.3-alpine</code> and serves files from a mounted volume, which is empty right now.</p>
<p>Create an <em>InitContainer</em> named <code>init-con</code> which also mounts that volume and creates a file <code>index.html</code> with content <code>check this out!</code> in the root of the mounted volume. For this test we ignore that it doesn’t contain valid html.</p>
<p>The <em>InitContainer</em> should be using image <code>busybox:1.31.0</code>. Test your implementation for example using <code>curl</code> from a temporary <code>nginx:alpine</code> <em>Pod</em>.</p>
<p> </p>
<h5 id="Answer-16"><a href="#Answer-16" class="headerlink" title="Answer"></a>Answer</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">cp /opt/course/17/test-init-container.yaml ~/17_test-init-container.yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim 17_test-init-container.yaml</span><br></pre></td></tr></table></figure>

<p>Add the <em>InitContainer</em>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># 17_test-init-container.yaml</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: test-init-container</span><br><span class="line">  namespace: mars</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      id: test-init-container</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        id: test-init-container</span><br><span class="line">    spec:</span><br><span class="line">      volumes:</span><br><span class="line">      - name: web-content</span><br><span class="line">        emptyDir: &#123;&#125;</span><br><span class="line">      initContainers:                 # initContainer start</span><br><span class="line">      - name: init-con</span><br><span class="line">        image: busybox:1.31.0</span><br><span class="line">        command: [&#x27;sh&#x27;, &#x27;-c&#x27;, &#x27;echo &quot;check this out!&quot; &gt; /tmp/web-content/index.html&#x27;]</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: web-content</span><br><span class="line">          mountPath: /tmp/web-content # initContainer end</span><br><span class="line">      containers:</span><br><span class="line">      - image: nginx:1.17.3-alpine</span><br><span class="line">        name: nginx</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: web-content</span><br><span class="line">          mountPath: /usr/share/nginx/html</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br></pre></td></tr></table></figure>

<p>Then we create the <em>Deployment</em>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -f 17_test-init-container.yaml create</span><br></pre></td></tr></table></figure>

<p>Finally we test the configuration:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n mars get pod -o wide # to get the cluster IP</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k run tmp --restart=Never --rm -i --image=nginx:alpine -- curl 10.0.0.67</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">check this out!</span><br></pre></td></tr></table></figure>

<p>Beautiful.</p>
<p> </p>
<p> </p>
<h2 id="Question-18-Service-misconfiguration"><a href="#Question-18-Service-misconfiguration" class="headerlink" title="Question 18 | Service misconfiguration"></a>Question 18 | Service misconfiguration</h2><p> </p>
<p>Solve this question on instance: <code>ssh ckad5601</code></p>
<p> </p>
<p>There seems to be an issue in <em>Namespace</em> <code>mars</code> where the ClusterIP service <code>manager-api-svc</code> should make the <em>Pods</em> of <em>Deployment</em> <code>manager-api-deployment</code> available inside the cluster.</p>
<p>You can test this with <code>curl manager-api-svc.mars:4444</code> from a temporary <code>nginx:alpine</code> <em>Pod</em>. Check for the misconfiguration and apply a fix.</p>
<p> </p>
<h5 id="Answer-17"><a href="#Answer-17" class="headerlink" title="Answer"></a>Answer</h5><p>First let’s get an overview:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n mars get all</span><br><span class="line">NAME                                         READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/manager-api-deployment-dbcc6657d-bg2hh   1/1     Running   0          98m</span><br><span class="line">pod/manager-api-deployment-dbcc6657d-f5fv4   1/1     Running   0          98m</span><br><span class="line">pod/manager-api-deployment-dbcc6657d-httjv   1/1     Running   0          98m</span><br><span class="line">pod/manager-api-deployment-dbcc6657d-k98xn   1/1     Running   0          98m</span><br><span class="line">pod/test-init-container-5db7c99857-htx6b     1/1     Running   0          2m19s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NAME                      TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE</span><br><span class="line">service/manager-api-svc   ClusterIP   10.15.241.159   &lt;none&gt;        4444/TCP   99m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NAME                                     READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/manager-api-deployment   4/4     4            4           98m</span><br><span class="line">deployment.apps/test-init-container      1/1     1            1           2m19s</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Everything seems to be running, but we can’t seem to get a connection:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n mars run tmp --restart=Never --rm -i --image=nginx:alpine -- curl -m 5 manager-api-svc:4444</span><br><span class="line">If you don&#x27;t see a command prompt, try pressing enter.</span><br><span class="line">  0     0    0     0    0     0      0      0 --:--:--  0:00:01 --:--:--     0</span><br><span class="line">curl: (28) Connection timed out after 1000 milliseconds</span><br><span class="line">pod &quot;tmp&quot; deleted</span><br><span class="line">pod mars/tmp terminated (Error)</span><br></pre></td></tr></table></figure>

<p>Ok, let’s try to connect to one pod directly:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n mars get pod -o wide # get cluster IP</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n mars run tmp --restart=Never --rm -i --image=nginx:alpine -- curl -m 5 10.0.1.14</span><br><span class="line"> % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>The <em>Pods</em> itself seem to work. Let’s investigate the <em>Service</em> a bit:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n mars describe service manager-api-svc</span><br><span class="line">Name:              manager-api-svc</span><br><span class="line">Namespace:         mars</span><br><span class="line">Labels:            app=manager-api-svc</span><br><span class="line">...</span><br><span class="line">Endpoints:         &lt;none&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Endpoint inspection is also possible using:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n mars get ep</span><br></pre></td></tr></table></figure>

<p>No endpoints - No good. We check the <em>Service</em> yaml:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n mars edit service manager-api-svc</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># k -n mars edit service manager-api-svc</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">...</span><br><span class="line">  labels:</span><br><span class="line">    app: manager-api-svc</span><br><span class="line">  name: manager-api-svc</span><br><span class="line">  namespace: mars</span><br><span class="line">...</span><br><span class="line">spec:</span><br><span class="line">  clusterIP: 10.3.244.121</span><br><span class="line">  ports:</span><br><span class="line">  - name: 4444-80</span><br><span class="line">    port: 4444</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: 80</span><br><span class="line">  selector:</span><br><span class="line">    #id: manager-api-deployment # wrong selector, needs to point to pod!</span><br><span class="line">    id: manager-api-pod</span><br><span class="line">  sessionAffinity: None</span><br><span class="line">  type: ClusterIP</span><br></pre></td></tr></table></figure>

<p>Though <em>Pods</em> are usually never created without a <em>Deployment</em> or <em>ReplicaSet</em>, <em>Services</em> always select for <em>Pods</em> directly. This gives great flexibility because <em>Pods</em> could be created through various customized ways. After saving the new selector we check the <em>Service</em> again for endpoints:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n mars get ep</span><br><span class="line">NAME              ENDPOINTS                                               AGE</span><br><span class="line">manager-api-svc   10.0.0.30:80,10.0.1.30:80,10.0.1.31:80 + 1 more...      41m</span><br></pre></td></tr></table></figure>

<p>Endpoints - Good! Now we try connecting again:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n mars run tmp --restart=Never --rm -i --image=nginx:alpine -- curl -m 5 manager-api-svc:4444</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100   612  100   612    0     0    99k      0 --:--:-- --:--:-- --:--:--   99k</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>And we fixed it. Good to know is how to be able to use Kubernetes DNS resolution from a different <em>Namespace</em>. Not necessary, but we could spin up the temporary <em>Pod</em> in default <em>Namespace</em>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k run tmp --restart=Never --rm -i --image=nginx:alpine -- curl -m 5 manager-api-svc:4444</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0curl: (6) Could not resolve host: manager-api-svc</span><br><span class="line">pod &quot;tmp&quot; deleted</span><br><span class="line">pod default/tmp terminated (Error)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ k run tmp --restart=Never --rm -i --image=nginx:alpine -- curl -m 5 manager-api-svc.mars:4444</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100   612  100   612    0     0  68000      0 --:--:-- --:--:-- --:--:-- 68000</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br></pre></td></tr></table></figure>

<p>Short <code>manager-api-svc.mars</code> or long <code>manager-api-svc.mars.svc.cluster.local</code> work.</p>
<p> </p>
<p> </p>
<h2 id="Question-19-Service-ClusterIP-NodePort"><a href="#Question-19-Service-ClusterIP-NodePort" class="headerlink" title="Question 19 | Service ClusterIP-&gt;NodePort"></a>Question 19 | Service ClusterIP-&gt;NodePort</h2><p> </p>
<p>Solve this question on instance: <code>ssh ckad5601</code></p>
<p> </p>
<p>In <em>Namespace</em> <code>jupiter</code> you’ll find an apache <em>Deployment</em> (with one replica) named <code>jupiter-crew-deploy</code> and a ClusterIP <em>Service</em> called <code>jupiter-crew-svc</code> which exposes it. Change this service to a NodePort one to make it available on all nodes on port 30100.</p>
<p>Test the NodePort <em>Service</em> using the internal IP of all available nodes and the port 30100 using <code>curl</code>, you can reach the internal node IPs directly from your main terminal. On which nodes is the <em>Service</em> reachable? On which node is the <em>Pod</em> running?</p>
<p> </p>
<h5 id="Answer-18"><a href="#Answer-18" class="headerlink" title="Answer"></a>Answer</h5><p>First we get an overview:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n jupiter get all</span><br><span class="line">NAME                                      READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/jupiter-crew-deploy-8cdf99bc9-klwqt   1/1     Running   0          34m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NAME                       TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE</span><br><span class="line">service/jupiter-crew-svc   ClusterIP   10.100.254.66   &lt;none&gt;        8080/TCP   34m</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>(Optional) Next we check if the ClusterIP <em>Service</em> actually works:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n jupiter run tmp --restart=Never --rm -i --image=nginx:alpine -- curl -m 5 jupiter-crew-svc:8080</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100    45  100    45    0     0   5000      0 --:--:-- --:--:-- --:--:--  5000</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>The <em>Service</em> is working great. Next we change the <em>Service</em> type to NodePort and set the port:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n jupiter edit service jupiter-crew-svc</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># k -n jupiter edit service jupiter-crew-svc</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: jupiter-crew-svc</span><br><span class="line">  namespace: jupiter</span><br><span class="line">...</span><br><span class="line">spec:</span><br><span class="line">  clusterIP: 10.3.245.70</span><br><span class="line">  ports:</span><br><span class="line">  - name: 8080-80</span><br><span class="line">    port: 8080</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: 80</span><br><span class="line">    nodePort: 30100 # add the nodePort</span><br><span class="line">  selector:</span><br><span class="line">    id: jupiter-crew</span><br><span class="line">  sessionAffinity: None</span><br><span class="line">  #type: ClusterIP</span><br><span class="line">  type: NodePort    # change type</span><br><span class="line">status:</span><br><span class="line">  loadBalancer: &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>We check if the <em>Service</em> type was updated:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n jupiter get svc</span><br><span class="line">NAME               TYPE       CLUSTER-IP    EXTERNAL-IP   PORT(S)          AGE</span><br><span class="line">jupiter-crew-svc   NodePort   10.3.245.70   &lt;none&gt;        8080:30100/TCP   3m52s</span><br></pre></td></tr></table></figure>

<p>(Optional) And we confirm that the service is still reachable internally:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n jupiter run tmp --restart=Never --rm -i --image=nginx:alpine -- curl -m 5 jupiter-crew-svc:8080</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>Nice. A NodePort <em>Service</em> kind of lies on top of a ClusterIP one, making the ClusterIP <em>Service</em> reachable on the Node IPs (internal and external). Next we get the <em>internal</em> IPs of all nodes to check the connectivity:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k get nodes -o wide</span><br><span class="line">NAME                    STATUS   ROLES          AGE   VERSION   INTERNAL-IP      ...</span><br><span class="line">cluster1-controlplane1  Ready    control-plane  18h   v1.32.0   192.168.100.11   ...</span><br></pre></td></tr></table></figure>

<p>We can test the connection using the node IP:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ curl 192.168.100.11:30100</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>Here we only have one node in the cluster, but the <em>Service</em> would be reachable on all of them. Even if the <em>Pod</em> is just running on one specific node, the <em>Service</em> makes it available through port 30100 on the internal and external IP addresses of all nodes. This is at least the common&#x2F;default behaviour but can depend on cluster configuration.</p>
<p> </p>
<p> </p>
<h2 id="Question-20-NetworkPolicy"><a href="#Question-20-NetworkPolicy" class="headerlink" title="Question 20 | NetworkPolicy"></a>Question 20 | NetworkPolicy</h2><p> </p>
<p>Solve this question on instance: <code>ssh ckad7326</code></p>
<p> </p>
<p>In <em>Namespace</em> <code>venus</code> you’ll find two <em>Deployments</em> named <code>api</code> and <code>frontend</code>. Both <em>Deployments</em> are exposed inside the cluster using <em>Services</em>. Create a <em>NetworkPolicy</em> named <code>np1</code> which restricts outgoing tcp connections from <em>Deployment</em> <code>frontend</code> and only allows those going to <em>Deployment</em> <code>api</code>. Make sure the <em>NetworkPolicy</em> still allows outgoing traffic on UDP&#x2F;TCP ports 53 for DNS resolution.</p>
<p>Test using: <code>wget www.google.com</code> and <code>wget api:2222</code> from a <em>Pod</em> of <em>Deployment</em> <code>frontend</code>.</p>
<p> </p>
<h5 id="Answer-19"><a href="#Answer-19" class="headerlink" title="Answer"></a>Answer</h5><p> </p>
<blockquote>
<p><em><strong>INFO:</strong></em> For learning NetworkPolicies check out <a target="_blank" rel="noopener" href="https://editor.cilium.io/">https://editor.cilium.io</a>. But you’re not allowed to use it during the exam.</p>
</blockquote>
<p> </p>
<p>First we get an overview:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n venus get all</span><br><span class="line">NAME                            READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/api-5979b95578-gktxp        1/1     Running   0          57s</span><br><span class="line">pod/api-5979b95578-lhcl5        1/1     Running   0          57s</span><br><span class="line">pod/frontend-789cbdc677-c9v8h   1/1     Running   0          57s</span><br><span class="line">pod/frontend-789cbdc677-npk2m   1/1     Running   0          57s</span><br><span class="line">pod/frontend-789cbdc677-pl67g   1/1     Running   0          57s</span><br><span class="line">pod/frontend-789cbdc677-rjt5r   1/1     Running   0          57s</span><br><span class="line">pod/frontend-789cbdc677-xgf5n   1/1     Running   0          57s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NAME               TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE</span><br><span class="line">service/api        ClusterIP   10.3.255.137   &lt;none&gt;        2222/TCP   37s</span><br><span class="line">service/frontend   ClusterIP   10.3.255.135   &lt;none&gt;        80/TCP     57s</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>(Optional) This is not necessary but we could check if the <em>Services</em> are working inside the cluster:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n venus run tmp --restart=Never --rm -i --image=busybox -i -- wget -O- frontend:80</span><br><span class="line">Connecting to frontend:80 (10.3.245.9:80)</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ k -n venus run tmp --restart=Never --rm --image=busybox -i -- wget -O- api:2222</span><br><span class="line">Connecting to api:2222 (10.3.250.233:2222)</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>Then we use any <code>frontend</code> <em>Pod</em> and check if it can reach external names and the <code>api</code> <em>Service</em>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n venus exec frontend-789cbdc677-c9v8h -- wget -O- www.google.com</span><br><span class="line">Connecting to www.google.com (216.58.205.227:80)</span><br><span class="line">-                    100% |********************************| 12955  0:00:00 ETA</span><br><span class="line">&lt;!doctype html&gt;&lt;html itemscope=&quot;&quot; itemtype=&quot;http://schema.org/WebPage&quot; lang=&quot;en&quot;&gt;&lt;head&gt;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ k -n venus exec frontend-789cbdc677-c9v8h -- wget -O- api:2222     </span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span><br><span class="line">Connecting to api:2222 (10.3.255.137:2222)</span><br><span class="line">-                    100% |********************************|    45  0:00:00 ETA</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>We see <em>Pods</em> of <code>frontend</code> can reach the <code>api</code> and external names.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">vim 20_np1.yaml</span><br></pre></td></tr></table></figure>

<p>Now we head to <a target="_blank" rel="noopener" href="https://kubernetes.io/docs">https://kubernetes.io/docs</a>, search for <em>NetworkPolicy</em>, copy the example code and adjust it to:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># 20_np1.yaml</span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">kind: NetworkPolicy</span><br><span class="line">metadata:</span><br><span class="line">  name: np1</span><br><span class="line">  namespace: venus</span><br><span class="line">spec:</span><br><span class="line">  podSelector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      id: frontend          # label of the pods this policy should be applied on</span><br><span class="line">  policyTypes:</span><br><span class="line">  - Egress                  # we only want to control egress</span><br><span class="line">  egress:</span><br><span class="line">  - to:                     # 1st egress rule</span><br><span class="line">    - podSelector:            # allow egress only to pods with api label</span><br><span class="line">        matchLabels:</span><br><span class="line">          id: api</span><br><span class="line">  - ports:                  # 2nd egress rule</span><br><span class="line">    - port: 53                # allow DNS UDP</span><br><span class="line">      protocol: UDP</span><br><span class="line">    - port: 53                # allow DNS TCP</span><br><span class="line">      protocol: TCP</span><br></pre></td></tr></table></figure>

<p>Notice that we specify two egress rules in the yaml above. If we specify multiple egress rules then these are connected using a logical OR. So in the example above we do:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">allow outgoing traffic if</span><br><span class="line">  (destination pod has label id:api) OR ((port is 53 UDP) OR (port is 53 TCP))</span><br></pre></td></tr></table></figure>

<p>Let’s have a look at example code which wouldn’t work in our case:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># this example does not work in our case</span><br><span class="line">...</span><br><span class="line">  egress:</span><br><span class="line">  - to:                     # 1st AND ONLY egress rule</span><br><span class="line">    - podSelector:            # allow egress only to pods with api label</span><br><span class="line">        matchLabels:</span><br><span class="line">          id: api</span><br><span class="line">    ports:                  # STILL THE SAME RULE but just an additional selector</span><br><span class="line">    - port: 53                # allow DNS UDP</span><br><span class="line">      protocol: UDP</span><br><span class="line">    - port: 53                # allow DNS TCP</span><br><span class="line">      protocol: TCP</span><br></pre></td></tr></table></figure>

<p>In the yaml above we only specify one egress rule with two selectors. It can be translated into:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">allow outgoing traffic if</span><br><span class="line">  (destination pod has label id:api) AND ((port is 53 UDP) OR (port is 53 TCP))</span><br></pre></td></tr></table></figure>

<p>Apply the correct policy:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -f 20_np1.yaml create</span><br></pre></td></tr></table></figure>

<p>And try again, external is not working any longer:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n venus exec frontend-789cbdc677-c9v8h -- wget -O- www.google.de </span><br><span class="line">Connecting to www.google.de:2222 (216.58.207.67:80)</span><br><span class="line">^C</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ k -n venus exec frontend-789cbdc677-c9v8h -- wget -O- -T 5 www.google.de:80 </span><br><span class="line">Connecting to www.google.com (172.217.203.104:80)</span><br><span class="line">wget: download timed out</span><br><span class="line">command terminated with exit code 1</span><br></pre></td></tr></table></figure>

<p>Internal connection to <code>api</code> work as before:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n venus exec frontend-789cbdc677-c9v8h -- wget -O- api:2222 </span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span><br><span class="line">Connecting to api:2222 (10.3.255.137:2222)</span><br><span class="line">-                    100% |********************************|    45  0:00:00 ETA</span><br></pre></td></tr></table></figure>

<p> </p>
<p> </p>
<h2 id="Question-21-Requests-and-Limits-ServiceAccount"><a href="#Question-21-Requests-and-Limits-ServiceAccount" class="headerlink" title="Question 21 | Requests and Limits, ServiceAccount"></a>Question 21 | Requests and Limits, ServiceAccount</h2><p> </p>
<p>Solve this question on instance: <code>ssh ckad7326</code></p>
<p> </p>
<p>Team Neptune needs 3 <em>Pods</em> of image <code>httpd:2.4-alpine</code>, create a <em>Deployment</em> named <code>neptune-10ab</code> for this. The containers should be named <code>neptune-pod-10ab</code>. Each container should have a memory request of <em>20Mi</em> and a memory limit of <em>50Mi</em>.</p>
<p>Team Neptune has it’s own <em>ServiceAccount</em> <code>neptune-sa-v2</code> under which the <em>Pods</em> should run. The <em>Deployment</em> should be in <em>Namespace</em> <code>neptune</code>.</p>
<p> </p>
<h5 id="Answer-20"><a href="#Answer-20" class="headerlink" title="Answer:"></a>Answer:</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n neptune create deployment -h # help</span><br><span class="line">k -n neptune create deploy -h # deploy is short for deployment</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">k -n neptune create deploy neptune-10ab --image=httpd:2.4-alpine --dry-run=client -oyaml &gt; 21.yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim 21.yaml</span><br></pre></td></tr></table></figure>

<p>Now make the required changes using vim:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># 21.yaml</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: null</span><br><span class="line">  labels:</span><br><span class="line">    app: neptune-10ab</span><br><span class="line">  name: neptune-10ab</span><br><span class="line">  namespace: neptune</span><br><span class="line">spec:</span><br><span class="line">  replicas: 3                   # change</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: neptune-10ab</span><br><span class="line">  strategy: &#123;&#125;</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      creationTimestamp: null</span><br><span class="line">      labels:</span><br><span class="line">        app: neptune-10ab</span><br><span class="line">    spec:</span><br><span class="line">      serviceAccountName: neptune-sa-v2 # add</span><br><span class="line">      containers:</span><br><span class="line">      - image: httpd:2.4-alpine</span><br><span class="line">        name: neptune-pod-10ab  # change</span><br><span class="line">        resources:              # add</span><br><span class="line">          limits:               # add</span><br><span class="line">            memory: 50Mi        # add</span><br><span class="line">          requests:             # add</span><br><span class="line">            memory: 20Mi        # add</span><br><span class="line">status: &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>Then create the yaml:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k create -f 21.yaml # namespace already set in yaml</span><br></pre></td></tr></table></figure>

<p>To verify all <em>Pods</em> are running we do:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n neptune get pod | grep neptune-10ab</span><br><span class="line">neptune-10ab-7d4b8d45b-4nzj5   1/1     Running            0          57s</span><br><span class="line">neptune-10ab-7d4b8d45b-lzwrf   1/1     Running            0          17s</span><br><span class="line">neptune-10ab-7d4b8d45b-z5hcc   1/1     Running            0          17s</span><br></pre></td></tr></table></figure>

<p> </p>
<p> </p>
<h2 id="Question-22-Labels-Annotations"><a href="#Question-22-Labels-Annotations" class="headerlink" title="Question 22 | Labels, Annotations"></a>Question 22 | Labels, Annotations</h2><p> </p>
<p>Solve this question on instance: <code>ssh ckad9043</code></p>
<p> </p>
<p>Team Sunny needs to identify some of their <em>Pods</em> in namespace <code>sun</code>. They ask you to add a new label <code>protected: true</code> to all <em>Pods</em> with an existing label <code>type: worker</code> or <code>type: runner</code>. Also add an annotation <code>protected: do not delete this pod</code> to all <em>Pods</em> having the new label <code>protected: true</code>.</p>
<p> </p>
<h5 id="Answer-21"><a href="#Answer-21" class="headerlink" title="Answer"></a>Answer</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n sun get pod --show-labels</span><br><span class="line">NAME           READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">0509649a       1/1     Running   0          25s   type=runner,type_old=messenger</span><br><span class="line">0509649b       1/1     Running   0          24s   type=worker</span><br><span class="line">1428721e       1/1     Running   0          23s   type=worker</span><br><span class="line">1428721f       1/1     Running   0          22s   type=worker</span><br><span class="line">43b9a          1/1     Running   0          22s   type=test</span><br><span class="line">4c09           1/1     Running   0          21s   type=worker</span><br><span class="line">4c35           1/1     Running   0          20s   type=worker</span><br><span class="line">4fe4           1/1     Running   0          19s   type=worker</span><br><span class="line">5555a          1/1     Running   0          19s   type=messenger</span><br><span class="line">86cda          1/1     Running   0          18s   type=runner</span><br><span class="line">8d1c           1/1     Running   0          17s   type=messenger</span><br><span class="line">a004a          1/1     Running   0          16s   type=runner</span><br><span class="line">a94128196      1/1     Running   0          15s   type=runner,type_old=messenger</span><br><span class="line">afd79200c56a   1/1     Running   0          15s   type=worker</span><br><span class="line">b667           1/1     Running   0          14s   type=worker</span><br><span class="line">fdb2           1/1     Running   0          13s   type=worker</span><br></pre></td></tr></table></figure>

<p>If we would only like to get pods with certain labels we can run:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n sun get pod -l type=runner # only pods with label runner</span><br></pre></td></tr></table></figure>

<p>We can use this label filtering also when using other commands, like setting new labels:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k label -h # help</span><br><span class="line">k -n sun label pod -l type=runner protected=true # run for label runner</span><br><span class="line">k -n sun label pod -l type=worker protected=true # run for label worker</span><br></pre></td></tr></table></figure>

<p>Or we could run:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n sun label pod -l &quot;type in (worker,runner)&quot; protected=true</span><br></pre></td></tr></table></figure>

<p>Let’s check the result:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n sun get pod --show-labels</span><br><span class="line">NAME           ...   AGE   LABELS</span><br><span class="line">0509649a       ...          56s   protected=true,type=runner,type_old=messenger</span><br><span class="line">0509649b       ...          55s   protected=true,type=worker</span><br><span class="line">1428721e       ...          54s   protected=true,type=worker</span><br><span class="line">1428721f       ...          53s   protected=true,type=worker</span><br><span class="line">43b9a          ...          53s   type=test</span><br><span class="line">4c09           ...          52s   protected=true,type=worker</span><br><span class="line">4c35           ...          51s   protected=true,type=worker</span><br><span class="line">4fe4           ...          50s   protected=true,type=worker</span><br><span class="line">5555a          ...          50s   type=messenger</span><br><span class="line">86cda          ...          49s   protected=true,type=runner</span><br><span class="line">8d1c           ...          48s   type=messenger</span><br><span class="line">a004a          ...          47s   protected=true,type=runner</span><br><span class="line">a94128196      ...          46s   protected=true,type=runner,type_old=messenger</span><br><span class="line">afd79200c56a   ...          46s   protected=true,type=worker</span><br><span class="line">b667           ...          45s   protected=true,type=worker</span><br><span class="line">fdb2           ...          44s   protected=true,type=worker</span><br></pre></td></tr></table></figure>

<p>Looking good. Finally we set the annotation using the newly assigned label <code>protected: true</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n sun annotate pod -l protected=true protected=&quot;do not delete this pod&quot;</span><br></pre></td></tr></table></figure>

<p>Not requested in the task but for your own control you could run:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n sun get pod -l protected=true -o yaml | grep -A 8 metadata:</span><br></pre></td></tr></table></figure>

<p> </p>
<p><a href=""></a></p>
<h1 id="CKAD-Simulator-Preview-Kubernetes-1-32"><a href="#CKAD-Simulator-Preview-Kubernetes-1-32" class="headerlink" title="CKAD Simulator Preview Kubernetes 1.32"></a>CKAD Simulator Preview Kubernetes 1.32</h1><p><a target="_blank" rel="noopener" href="https://killer.sh/">https://killer.sh</a></p>
<p> </p>
<p>This is a preview of the CKAD Simulator content. The full CKAD Simulator contains 22 different questions. These preview questions are in addition to the provided ones and can also be solved in the interactive environment.</p>
<p> </p>
<h2 id="Preview-Question-1"><a href="#Preview-Question-1" class="headerlink" title="Preview Question 1"></a>Preview Question 1</h2><p> </p>
<p>Solve this question on instance: <code>ssh ckad9043</code></p>
<p> </p>
<p>In <em>Namespace</em> <code>pluto</code> there is a <em>Deployment</em> named <code>project-23-api</code>. It has been working okay for a while but Team Pluto needs it to be more reliable. Implement a liveness-probe which checks the container to be reachable on port 80. Initially the probe should wait <em>10</em>, periodically <em>15</em> seconds.</p>
<p>The original <em>Deployment</em> yaml is available at <code>/opt/course/p1/project-23-api.yaml</code>. Save your changes at <code>/opt/course/p1/project-23-api-new.yaml</code> and apply the changes.</p>
<p> </p>
<h5 id="Answer-22"><a href="#Answer-22" class="headerlink" title="Answer"></a>Answer</h5><p>First we get an overview:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">x</span><br><span class="line">➜ k -n pluto get all -o wide</span><br><span class="line">NAME                                  READY   STATUS    ... IP           ...</span><br><span class="line">pod/holy-api                          1/1     Running   ... 10.12.0.26   ...</span><br><span class="line">pod/project-23-api-784857f54c-dx6h6   1/1     Running   ... 10.12.2.15   ...</span><br><span class="line">pod/project-23-api-784857f54c-sj8df   1/1     Running   ... 10.12.1.18   ...</span><br><span class="line">pod/project-23-api-784857f54c-t4xmh   1/1     Running   ... 10.12.0.23   ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NAME                             READY   UP-TO-DATE   AVAILABLE   ...</span><br><span class="line">deployment.apps/project-23-api   3/3     3            3           ...</span><br></pre></td></tr></table></figure>

<p>To note: we see another <em>Pod</em> here called <code>holy-api</code> which is part of another section. This is often the case in the provided scenarios, so be careful to only manipulate the resources you need to. Just like in the real world and in the exam.</p>
<p>Next we use <code>nginx:alpine</code> and <code>curl</code> to check if one <em>Pod</em> is accessible on port 80:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k run tmp --restart=Never --rm -i --image=nginx:alpine -- curl -m 5 10.12.2.15</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>We could also use <code>busybox</code> and <code>wget</code> for this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k run tmp --restart=Never --rm --image=busybox -i -- wget -O- 10.12.2.15</span><br><span class="line">Connecting to 10.12.2.15 (10.12.2.15:80)</span><br><span class="line">writing to stdout</span><br><span class="line">-                    100% |********************************|   612  0:00:00 ETA</span><br><span class="line">written to stdout</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br></pre></td></tr></table></figure>

<p>Now that we’re sure the <em>Deployment</em> works we can continue with altering the provided yaml:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">cp /opt/course/p1/project-23-api.yaml /opt/course/p1/project-23-api-new.yaml</span><br><span class="line">vim /opt/course/p1/project-23-api-new.yaml</span><br></pre></td></tr></table></figure>

<p>Add the liveness-probe to the yaml:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># /opt/course/p1/project-23-api-new.yaml</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: project-23-api</span><br><span class="line">  namespace: pluto</span><br><span class="line">spec:</span><br><span class="line">  replicas: 3</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: project-23-api</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: project-23-api</span><br><span class="line">    spec:</span><br><span class="line">      volumes:</span><br><span class="line">      - name: cache-volume1</span><br><span class="line">        emptyDir: &#123;&#125;</span><br><span class="line">      - name: cache-volume2</span><br><span class="line">        emptyDir: &#123;&#125;</span><br><span class="line">      - name: cache-volume3</span><br><span class="line">        emptyDir: &#123;&#125;</span><br><span class="line">      containers:</span><br><span class="line">      - image: httpd:2.4-alpine</span><br><span class="line">        name: httpd</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - mountPath: /cache1</span><br><span class="line">          name: cache-volume1</span><br><span class="line">        - mountPath: /cache2</span><br><span class="line">          name: cache-volume2</span><br><span class="line">        - mountPath: /cache3</span><br><span class="line">          name: cache-volume3</span><br><span class="line">        env:</span><br><span class="line">        - name: APP_ENV</span><br><span class="line">          value: &quot;prod&quot;</span><br><span class="line">        - name: APP_SECRET_N1</span><br><span class="line">          value: &quot;IO=a4L/XkRdvN8jM=Y+&quot;</span><br><span class="line">        - name: APP_SECRET_P1</span><br><span class="line">          value: &quot;-7PA0_Z]&gt;&#123;pwa43r)__&quot;</span><br><span class="line">        livenessProbe:                  # add</span><br><span class="line">          tcpSocket:                    # add</span><br><span class="line">            port: 80                    # add</span><br><span class="line">          initialDelaySeconds: 10       # add</span><br><span class="line">          periodSeconds: 15             # add</span><br></pre></td></tr></table></figure>

<p>Then let’s apply the changes:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -f /opt/course/p1/project-23-api-new.yaml apply </span><br></pre></td></tr></table></figure>

<p>Next we wait 10 seconds and confirm the <em>Pods</em> are still running:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n pluto get pod</span><br><span class="line">NAME                              READY   STATUS    RESTARTS   AGE</span><br><span class="line">holy-api                          1/1     Running   0          144m</span><br><span class="line">project-23-api-5b4579fd49-8knh8   1/1     Running   0          90s</span><br><span class="line">project-23-api-5b4579fd49-cbgph   1/1     Running   0          88s</span><br><span class="line">project-23-api-5b4579fd49-tcfq5   1/1     Running   0          86s</span><br></pre></td></tr></table></figure>

<p>We can also check the configured liveness-probe settings on a <em>Pod</em> or the <em>Deployment</em>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n pluto describe pod project-23-api-5b4579fd49-8knh8 | grep Liveness</span><br><span class="line">    Liveness:   tcp-socket :80 delay=10s timeout=1s period=15s #success=1 #failure=3</span><br><span class="line">    </span><br><span class="line">➜  k -n pluto describe deploy project-23-api | grep Liveness</span><br><span class="line">    Liveness:   tcp-socket :80 delay=10s timeout=1s period=15s #success=1 #failure=3</span><br></pre></td></tr></table></figure>

<p> </p>
<p> </p>
<h2 id="Preview-Question-2"><a href="#Preview-Question-2" class="headerlink" title="Preview Question 2"></a>Preview Question 2</h2><p> </p>
<p>Solve this question on instance: <code>ssh ckad9043</code></p>
<p> </p>
<p>Team Sun needs a new <em>Deployment</em> named <code>sunny</code> with 4 replicas of image <code>nginx:1.17.3-alpine</code> in <em>Namespace</em> <code>sun</code>. The <em>Deployment</em> and its <em>Pods</em> should use the existing <em>ServiceAccount</em> <code>sa-sun-deploy</code>.</p>
<p>Expose the <em>Deployment</em> internally using a ClusterIP <em>Service</em> named <code>sun-srv</code> on port 9999. The nginx containers should run as default on port 80. The management of Team Sun would like to execute a command to check that all <em>Pods</em> are running on occasion. Write that command into file <code>/opt/course/p2/sunny_status_command.sh</code>. The command should use <code>kubectl</code>.</p>
<p> </p>
<h5 id="Answer-23"><a href="#Answer-23" class="headerlink" title="Answer"></a>Answer</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n sun create deployment -h #help</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">k -n sun create deployment sunny --image=nginx:1.17.3-alpine --dry-run=client -oyaml &gt; p2_sunny.yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vim p2_sunny.yaml</span><br></pre></td></tr></table></figure>

<p>Then alter its yaml to include the requirements:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># p2_sunny.yaml</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: null</span><br><span class="line">  labels:</span><br><span class="line">    app: sunny</span><br><span class="line">  name: sunny</span><br><span class="line">  namespace: sun</span><br><span class="line">spec:</span><br><span class="line">  replicas: 4                               # change</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: sunny</span><br><span class="line">  strategy: &#123;&#125;</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      creationTimestamp: null</span><br><span class="line">      labels:</span><br><span class="line">        app: sunny</span><br><span class="line">    spec:</span><br><span class="line">      serviceAccountName: sa-sun-deploy     # add</span><br><span class="line">      containers:</span><br><span class="line">      - image: nginx:1.17.3-alpine</span><br><span class="line">        name: nginx</span><br><span class="line">        resources: &#123;&#125;</span><br><span class="line">status: &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>Now create the yaml and confirm it’s running:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k create -f p2_sunny.yaml </span><br><span class="line">deployment.apps/sunny created</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ k -n sun get pod</span><br><span class="line">NAME                     READY   STATUS        RESTARTS   AGE</span><br><span class="line">0509649a                 1/1     Running       0          149m</span><br><span class="line">0509649b                 1/1     Running       0          149m</span><br><span class="line">1428721e                 1/1     Running       0          149m</span><br><span class="line">...</span><br><span class="line">sunny-64df8dbdbb-9mxbw   1/1     Running       0          10s</span><br><span class="line">sunny-64df8dbdbb-mp5cf   1/1     Running       0          10s</span><br><span class="line">sunny-64df8dbdbb-pggdf   1/1     Running       0          6s</span><br><span class="line">sunny-64df8dbdbb-zvqth   1/1     Running       0          7s</span><br></pre></td></tr></table></figure>

<p>Confirmed, the AGE column is always in important information about if changes were applied. Next we expose the <em>Pods</em> by created the <em>Service</em>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n sun expose -h # help</span><br><span class="line">k -n sun expose deployment sunny --name sun-srv --port 9999 --target-port 80</span><br></pre></td></tr></table></figure>

<p>Using expose instead of <code>kubectl create service clusterip</code> is faster because it already sets the correct selector-labels. The previous command would produce this yaml:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># k -n sun expose deployment sunny --name sun-srv --port 9999 --target-port 80</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: null</span><br><span class="line">  labels:</span><br><span class="line">    app: sunny</span><br><span class="line">  name: sun-srv         # required by task</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - port: 9999          # service port</span><br><span class="line">    protocol: TCP</span><br><span class="line">    targetPort: 80      # target port</span><br><span class="line">  selector:</span><br><span class="line">    app: sunny          # selector is important</span><br><span class="line">status:</span><br><span class="line">  loadBalancer: &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>Let’s test the <em>Service</em> using <code>wget</code> from a temporary <em>Pod</em>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k run tmp --restart=Never --rm -i --image=nginx:alpine -- curl -m 5 sun-srv.sun:9999</span><br><span class="line">Connecting to sun-srv.sun:9999 (10.23.253.120:9999)</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Because the <em>Service</em> is in a different <em>Namespace</em> as our temporary <em>Pod</em>, it is reachable using the names <code>sun-srv.sun</code> or fully: <code>sun-srv.sun.svc.cluster.local</code>.</p>
<p>Finally we need a command which can be executed to check if all <em>Pods</em> are runing, this can be done with:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">vim /opt/course/p2/sunny_status_command.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># /opt/course/p2/sunny_status_command.sh</span><br><span class="line">kubectl -n sun get deployment sunny</span><br></pre></td></tr></table></figure>

<p>To run the command:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ sh /opt/course/p2/sunny_status_command.sh</span><br><span class="line">NAME    READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">sunny   4/4     4            4           13m</span><br></pre></td></tr></table></figure>

<p> </p>
<p> </p>
<h2 id="Preview-Question-3"><a href="#Preview-Question-3" class="headerlink" title="Preview Question 3"></a>Preview Question 3</h2><p> </p>
<p>Solve this question on instance: <code>ssh ckad5601</code></p>
<p> </p>
<p>Management of EarthAG recorded that one of their <em>Services</em> stopped working. Dirk, the administrator, left already for the long weekend. All the information they could give you is that it was located in <em>Namespace</em> <code>earth</code> and that it stopped working after the latest rollout. All <em>Services</em> of EarthAG should be reachable from inside the cluster.</p>
<p>Find the <em>Service</em>, fix any issues and confirm it’s working again. Write the reason of the error into file <code>/opt/course/p3/ticket-654.txt</code> so Dirk knows what the issue was.</p>
<p> </p>
<h5 id="Answer-24"><a href="#Answer-24" class="headerlink" title="Answer"></a>Answer</h5><p>First we get an overview of the resources in <em>Namespace</em> <code>earth</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n earth get all</span><br><span class="line">NAME                                          READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/earth-2x3-api-584df69757-ngnwp            1/1     Running   0          116m</span><br><span class="line">pod/earth-2x3-api-584df69757-ps8cs            1/1     Running   0          116m</span><br><span class="line">pod/earth-2x3-api-584df69757-ww9q8            1/1     Running   0          116m</span><br><span class="line">pod/earth-2x3-web-85c5b7986c-48vjt            1/1     Running   0          116m</span><br><span class="line">pod/earth-2x3-web-85c5b7986c-6mqmb            1/1     Running   0          116m</span><br><span class="line">pod/earth-2x3-web-85c5b7986c-6vjll            1/1     Running   0          116m</span><br><span class="line">pod/earth-2x3-web-85c5b7986c-fnkbp            1/1     Running   0          116m</span><br><span class="line">pod/earth-2x3-web-85c5b7986c-pjm5m            1/1     Running   0          116m</span><br><span class="line">pod/earth-2x3-web-85c5b7986c-pwfvj            1/1     Running   0          116m</span><br><span class="line">pod/earth-3cc-runner-6cb6cc6974-8wm5x         1/1     Running   0          116m</span><br><span class="line">pod/earth-3cc-runner-6cb6cc6974-9fx8b         1/1     Running   0          116m</span><br><span class="line">pod/earth-3cc-runner-6cb6cc6974-b9nrv         1/1     Running   0          116m</span><br><span class="line">pod/earth-3cc-runner-heavy-6bf876f46d-b47vq   1/1     Running   0          116m</span><br><span class="line">pod/earth-3cc-runner-heavy-6bf876f46d-mrzqd   1/1     Running   0          116m</span><br><span class="line">pod/earth-3cc-runner-heavy-6bf876f46d-qkd74   1/1     Running   0          116m</span><br><span class="line">pod/earth-3cc-web-6bfdf8b848-f74cj            0/1     Running   0          116m</span><br><span class="line">pod/earth-3cc-web-6bfdf8b848-n4z7z            0/1     Running   0          116m</span><br><span class="line">pod/earth-3cc-web-6bfdf8b848-rcmxs            0/1     Running   0          116m</span><br><span class="line">pod/earth-3cc-web-6bfdf8b848-xl467            0/1     Running   0          116m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NAME                        TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE</span><br><span class="line">service/earth-2x3-api-svc   ClusterIP   10.3.241.242   &lt;none&gt;        4546/TCP   116m</span><br><span class="line">service/earth-2x3-web-svc   ClusterIP   10.3.250.247   &lt;none&gt;        4545/TCP   116m</span><br><span class="line">service/earth-3cc-web       ClusterIP   10.3.243.24    &lt;none&gt;        6363/TCP   116m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NAME                                     READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/earth-2x3-api            3/3     3            3           116m</span><br><span class="line">deployment.apps/earth-2x3-web            6/6     6            6           116m</span><br><span class="line">deployment.apps/earth-3cc-runner         3/3     3            3           116m</span><br><span class="line">deployment.apps/earth-3cc-runner-heavy   3/3     3            3           116m</span><br><span class="line">deployment.apps/earth-3cc-web            0/4     4            0           116m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NAME                                                DESIRED   CURRENT   READY   AGE</span><br><span class="line">replicaset.apps/earth-2x3-api-584df69757            3         3         3       116m</span><br><span class="line">replicaset.apps/earth-2x3-web-85c5b7986c            6         6         6       116m</span><br><span class="line">replicaset.apps/earth-3cc-runner-6cb6cc6974         3         3         3       116m</span><br><span class="line">replicaset.apps/earth-3cc-runner-heavy-6bf876f46d   3         3         3       116m</span><br><span class="line">replicaset.apps/earth-3cc-web-6895587dc7            0         0         0       116m</span><br><span class="line">replicaset.apps/earth-3cc-web-6bfdf8b848            4         4         0       116m</span><br><span class="line">replicaset.apps/earth-3cc-web-d49645966             0         0         0       116m</span><br></pre></td></tr></table></figure>

<p>First impression could be that all <em>Pods</em> are in status RUNNING. But looking closely we see that some of the <em>Pods</em> are not ready, which also confirms what we see about one <em>Deployment</em> and one <em>ReplicaSet</em>. This could be our error to further investigate.</p>
<p>Another approach could be to check the <em>Service</em>s for missing endpoints:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n earth get ep</span><br><span class="line">NAME                ENDPOINTS                                           AGE</span><br><span class="line">earth-2x3-api-svc   10.0.0.10:80,10.0.1.5:80,10.0.2.4:80                116m</span><br><span class="line">earth-2x3-web-svc   10.0.0.11:80,10.0.0.12:80,10.0.1.6:80 + 3 more...   116m</span><br><span class="line">earth-3cc-web           </span><br></pre></td></tr></table></figure>

<p><em>Service</em> <code>earth-3cc-web</code> doesn’t have endpoints. This could be a selector&#x2F;label misconfiguration or the endpoints are actually not available&#x2F;ready.</p>
<p>Checking all <em>Services</em> for connectivity should show the same (this step is optional and just for demonstration):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k run tmp --restart=Never --rm -i --image=nginx:alpine -- curl -m 5 earth-2x3-api-svc.earth:4546</span><br><span class="line">...</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ k run tmp --restart=Never --rm -i --image=nginx:alpine -- curl -m 5 earth-2x3-web-svc.earth:4545</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100    45  100    45    0     0   5000      0 --:--:-- --:--:-- --:--:--  5000</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">➜ k run tmp --restart=Never --rm -i --image=nginx:alpine -- curl -m 5 earth-3cc-web.earth:6363</span><br><span class="line">If you don&#x27;t see a command prompt, try pressing enter.</span><br><span class="line">  0     0    0     0    0     0      0      0 --:--:--  0:00:05 --:--:--     0</span><br><span class="line">curl: (28) Connection timed out after 5000 milliseconds</span><br><span class="line">pod &quot;tmp&quot; deleted</span><br><span class="line">pod default/tmp terminated (Error)</span><br></pre></td></tr></table></figure>

<p>Notice that we use here for example <code>earth-2x3-api-svc.earth</code>. We could also spin up a temporary <em>Pod</em> in <em>Namespace</em> <code>earth</code> and connect directly to <code>earth-2x3-api-svc</code>.</p>
<p>We get no connection to <code>earth-3cc-web.earth:6363</code>. Let’s look at the <em>Deployment</em> <code>earth-3cc-web</code>. Here we see that the requested amount of replicas is not available&#x2F;ready:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n earth get deploy earth-3cc-web</span><br><span class="line">NAME            READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">earth-3cc-web   0/4     4            0           7m18s</span><br></pre></td></tr></table></figure>

<p>To continue we check the <em>Deployment</em> yaml for some misconfiguration:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">k -n earth edit deploy earth-3cc-web</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># k -n earth edit deploy earth-3cc-web</span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">...</span><br><span class="line">  generation: 3                     # there have been rollouts</span><br><span class="line">  name: earth-3cc-web</span><br><span class="line">  namespace: earth</span><br><span class="line">...</span><br><span class="line">spec:</span><br><span class="line">...</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      creationTimestamp: null</span><br><span class="line">      labels:</span><br><span class="line">        id: earth-3cc-web</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - image: nginx:1.16.1-alpine</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        name: nginx</span><br><span class="line">        readinessProbe:</span><br><span class="line">          failureThreshold: 3</span><br><span class="line">          initialDelaySeconds: 10</span><br><span class="line">          periodSeconds: 20</span><br><span class="line">          successThreshold: 1</span><br><span class="line">          tcpSocket:</span><br><span class="line">            port: 82                # this port doesn&#x27;t seem to be right, should be 80</span><br><span class="line">          timeoutSeconds: 1</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>We change the readiness-probe port, save and check the <em>Pods</em>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n earth get pod -l id=earth-3cc-web</span><br><span class="line">NAME                            READY   STATUS    RESTARTS   AGE</span><br><span class="line">earth-3cc-web-d49645966-52vb9   0/1     Running   0          6s</span><br><span class="line">earth-3cc-web-d49645966-5tts6   0/1     Running   0          6s</span><br><span class="line">earth-3cc-web-d49645966-db5gp   0/1     Running   0          6s</span><br><span class="line">earth-3cc-web-d49645966-mk7gr   0/1     Running   0          6s</span><br></pre></td></tr></table></figure>

<p>Running, but still not in ready state. Wait 10 seconds (initialDelaySeconds of readinessProbe) and check again:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k -n earth get pod -l id=earth-3cc-web</span><br><span class="line">NAME                            READY   STATUS    RESTARTS   AGE</span><br><span class="line">earth-3cc-web-d49645966-52vb9   1/1     Running   0          32s</span><br><span class="line">earth-3cc-web-d49645966-5tts6   1/1     Running   0          32s</span><br><span class="line">earth-3cc-web-d49645966-db5gp   1/1     Running   0          32s</span><br><span class="line">earth-3cc-web-d49645966-mk7gr   1/1     Running   0          32s</span><br></pre></td></tr></table></figure>

<p>Let’s check the service again:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">➜ k run tmp --restart=Never --rm -i --image=nginx:alpine -- curl -m 5 earth-3cc-web.earth:6363</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100   612  100   612    0     0  55636      0 --:--:-- --:--:-- --:--:-- 55636</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>We did it! Finally we write the reason into the requested location:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line">vim /opt/course/p3/ticket-654.txt</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xxxxxxxxxx</span><br><span class="line"># /opt/course/p3/ticket-654.txt</span><br><span class="line">yo Dirk, wrong port for readinessProbe defined!</span><br></pre></td></tr></table></figure>

<p> </p>
<p><a href=""></a></p>
<h1 id="CKAD-Tips-Kubernetes-1-32"><a href="#CKAD-Tips-Kubernetes-1-32" class="headerlink" title="CKAD Tips Kubernetes 1.32"></a>CKAD Tips Kubernetes 1.32</h1><p>In this section we’ll provide some tips on how to handle the CKAD exam and browser terminal.</p>
<p> </p>
<h2 id="Knowledge"><a href="#Knowledge" class="headerlink" title="Knowledge"></a>Knowledge</h2><ul>
<li><p>Study all topics as proposed in the curriculum till you feel comfortable with all</p>
</li>
<li><p>Learn and Study the in-browser scenarios on <a target="_blank" rel="noopener" href="https://killercoda.com/killer-shell-ckad">https://killercoda.com/killer-shell-ckad</a></p>
</li>
<li><p>Read this and do all examples: <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/cluster-administration/logging">https://kubernetes.io/docs/concepts/cluster-administration/logging</a></p>
</li>
<li><p>Understand Rolling Update Deployment including maxSurge and maxUnavailable</p>
</li>
<li><p>Do 1 or 2 test session with this CKAD Simulator. Understand the solutions and maybe try out other ways to achieve the same</p>
</li>
<li><p>Be fast and breath <code>kubectl</code></p>
</li>
</ul>
<p> </p>
<h2 id="CKAD-Preparation"><a href="#CKAD-Preparation" class="headerlink" title="CKAD Preparation"></a>CKAD Preparation</h2><p><strong>Read the Curriculum</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/cncf/curriculum">https://github.com/cncf/curriculum</a></p>
<p><strong>Read the Handbook</strong></p>
<p><a target="_blank" rel="noopener" href="https://docs.linuxfoundation.org/tc-docs/certification/lf-handbook2">https://docs.linuxfoundation.org/tc-docs/certification/lf-handbook2</a></p>
<p><strong>Read the important tips</strong></p>
<p><a target="_blank" rel="noopener" href="https://docs.linuxfoundation.org/tc-docs/certification/tips-cka-and-ckad">https://docs.linuxfoundation.org/tc-docs/certification/tips-cka-and-ckad</a></p>
<p><strong>Read the FAQ</strong></p>
<p><a target="_blank" rel="noopener" href="https://docs.linuxfoundation.org/tc-docs/certification/faq-cka-ckad">https://docs.linuxfoundation.org/tc-docs/certification/faq-cka-ckad</a></p>
<p> </p>
<h2 id="Kubernetes-documentation"><a href="#Kubernetes-documentation" class="headerlink" title="Kubernetes documentation"></a>Kubernetes documentation</h2><p>Get familiar with the Kubernetes documentation and be able to use the search. Allowed resources are:</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://kubernetes.io/docs">https://kubernetes.io/docs</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://kubernetes.io/blog">https://kubernetes.io/blog</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://helm.sh/docs">https://helm.sh/docs</a></p>
</li>
</ul>
<blockquote>
<p>ℹ️ Verify the list <a target="_blank" rel="noopener" href="https://docs.linuxfoundation.org/tc-docs/certification/certification-resources-allowed">here</a></p>
</blockquote>
<p> </p>
<h2 id="The-Test-Environment-Browser-Terminal"><a href="#The-Test-Environment-Browser-Terminal" class="headerlink" title="The Test Environment &#x2F; Browser Terminal"></a>The Test Environment &#x2F; Browser Terminal</h2><p>You’ll be provided with a browser terminal which uses Ubuntu&#x2F;Debian. The standard shells included with a minimal install will be available, including bash.</p>
<p><strong>Laggin</strong></p>
<p>There could be some lagging, definitely make sure you are using a good internet connection because your webcam and screen are uploading all the time.</p>
<p><strong>Kubectl autocompletion and commands</strong></p>
<p>Autocompletion is configured by default, as well as the <code>k</code> alias <a target="_blank" rel="noopener" href="https://docs.linuxfoundation.org/tc-docs/certification/tips-cka-and-ckad">source</a> and others:</p>
<p><code>kubectl</code> with <code>k</code> alias and Bash autocompletion</p>
<p><code>yq</code> and <code>jq</code>for YAML&#x2F;JSON processing</p>
<p><code>tmux</code> for terminal multiplexing</p>
<p><code>curl</code> and <code>wget</code> for testing web services</p>
<p><code>man</code> and man pages for further documentation</p>
<p><strong>Copy &amp; Paste</strong></p>
<p>Copy and pasting will work like normal in a Linux Environment:</p>
<p>What always works: copy+paste using right mouse context menu What works in Terminal: Ctrl+Shift+c and Ctrl+Shift+v What works in other apps like Firefox: Ctrl+c and Ctrl+v</p>
<p><strong>Score</strong></p>
<p>There are 15-20 questions in the exam. Your results will be automatically checked according to the handbook. If you don’t agree with the results you can request a review by contacting the Linux Foundation Support.</p>
<p><strong>Notepad &amp; Skipping Questions</strong></p>
<p>You have access to a simple notepad in the browser which can be used for storing any kind of plain text. It might makes sense to use this for saving skipped question numbers. This way it’s possible to move some questions to the end.</p>
<p><strong>Servers</strong></p>
<p>Each question needs to be solved on a specific instance other than your main terminal. You’ll need to connect to the correct instance via ssh, the command is provided before each question.</p>
<p> </p>
<h2 id="PSI-Bridge"><a href="#PSI-Bridge" class="headerlink" title="PSI Bridge"></a>PSI Bridge</h2><p>Starting with <a target="_blank" rel="noopener" href="https://training.linuxfoundation.org/bridge-migration-2021">PSI Bridge</a>:</p>
<ul>
<li><p>The exam will now be taken using the PSI Secure Browser, which can be downloaded using the newest versions of Microsoft Edge, Safari, Chrome, or Firefox</p>
</li>
<li><p>Multiple monitors will no longer be permitted</p>
</li>
<li><p>Use of personal bookmarks will no longer be permitted</p>
</li>
</ul>
<p>The new ExamUI includes improved features such as:</p>
<ul>
<li><p>A remote desktop configured with the tools and software needed to complete the tasks</p>
</li>
<li><p>A timer that displays the actual time remaining (in minutes) and provides an alert with 30, 15, or 5 minute remaining</p>
</li>
<li><p>The content panel remains the same (presented on the Left Hand Side of the ExamUI)</p>
</li>
</ul>
<p>Read more <a target="_blank" rel="noopener" href="https://training.linuxfoundation.org/bridge-migration-2021">here</a>.</p>
<p> </p>
<h2 id="Terminal-Handling"><a href="#Terminal-Handling" class="headerlink" title="Terminal Handling"></a>Terminal Handling</h2><p> </p>
<h3 id="Bash-Aliases"><a href="#Bash-Aliases" class="headerlink" title="Bash Aliases"></a>Bash Aliases</h3><p>In the real exam, each question has to be solved on a different instance to which you connect via ssh. This means it’s not advised to configure bash aliases because they wouldn’t be available on the instances accessed by ssh.</p>
<p> </p>
<h3 id="Be-fast"><a href="#Be-fast" class="headerlink" title="Be fast"></a>Be fast</h3><p>Use the <code>history</code> command to reuse already entered commands or use even faster history search through **Ctrl r **.</p>
<p>If a command takes some time to execute, like sometimes <code>kubectl delete pod x</code>. You can put a task in the background using <strong>Ctrl z</strong> and pull it back into foreground running command <code>fg</code>.</p>
<p>You can delete <em>pods</em> fast with:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">k delete pod x --grace-period 0 --force</span><br></pre></td></tr></table></figure>

<p> </p>
<h3 id="Vim"><a href="#Vim" class="headerlink" title="Vim"></a>Vim</h3><p>Be great with vim.</p>
<p><strong>Settings</strong></p>
<p>In case you face a situation where vim is not configured properly and you face for example issues with pasting copied content you should be able to configure via <code>~/.vimrc</code> or by entering manually in vim settings mode:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set tabstop=2</span><br><span class="line">set expandtab</span><br><span class="line">set shiftwidth=2</span><br></pre></td></tr></table></figure>

<p>The <code>expandtab</code> make sure to use spaces for tabs.</p>
<p>Note that changes in <code>~/.vimrc</code> will not be transferred when connecting to other instances via ssh.</p>
<p><strong>Toggle vim line numbers</strong></p>
<p>When in <code>vim</code> you can press <strong>Esc</strong> and type <code>:set number</code> or <code>:set nonumber</code> followed by <strong>Enter</strong> to toggle line numbers. This can be useful when finding syntax errors based on line - but can be bad when wanting to mark&amp;copy by mouse. You can also just jump to a line number with <strong>Esc</strong> <code>:22</code> + <strong>Enter</strong>.</p>
<p><strong>Copy&amp;Paste</strong></p>
<p>Get used to copy&#x2F;paste&#x2F;cut with vim:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Mark lines: Esc+V (then arrow keys)</span><br><span class="line">Copy marked lines: y</span><br><span class="line">Cut marked lines: d</span><br><span class="line">Past lines: p or P</span><br></pre></td></tr></table></figure>

<p><strong>Indent multiple lines</strong></p>
<p>To indent multiple lines press <strong>Esc</strong> and type <code>:set shiftwidth=2</code>. First mark multiple lines using <code>Shift v</code> and the up&#x2F;down keys. Then to indent the marked lines press <code>&gt;</code> or <code>&lt;</code>. You can then press <code>.</code> to repeat the action.</p>
<p> </p>
<!---->
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="https://github.com/Piwriw">Joohwan.</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://piwriw.github.io/2025/02/23/cloud/k8s/CKAD%E6%A8%A1%E6%8B%9F%E9%A2%98A2025/">https://piwriw.github.io/2025/02/23/cloud/k8s/CKAD模拟题A2025/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://piwriw.github.io" target="_blank">Joohwan</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/k8s/">k8s</a><a class="post-meta__tags" href="/tags/cloud/">cloud</a><a class="post-meta__tags" href="/tags/CKAD/">CKAD</a></div><div class="post-share"><div class="social-share" data-image="/img/k8s-go.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/03/09/cloud/k8s/deployment/K8sController-Deployment(%E6%97%A0%E7%8A%B6%E6%80%81%E5%BA%94%E7%94%A8)/" title="K8sController-Deployment（无状态应用）"><img class="cover" src="/img/k8s-go.jpg" onerror="onerror=null;src='/img/404.png'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">K8sController-Deployment（无状态应用）</div></div><div class="info-2"><div class="info-item-1">K8sController-Deployment（无状态应用） 基于K8s 1.31  什么是DeploymentDeployment是一种面向无状态应用的多个Pod副本进行自动化管理的工作负载控制器 常见场景：  部署一个或者多个副本应用 多副本的Pod的版本更新，以及部署过程的暂停和回滚 Pod副本数量的水平拓展缩容  Deploy管理能力123456789101112131415161718192021222324252627282930313233343536373839apiVersion: apps/v1kind: Deploymentmetadata:  name: nginx-deployment  labels:    app: nginx-deploymentspec:  # 设置true，表述部署过程中属于暂停状态  paused: false  # 修订历史最大数量 每个修订版本都有一个对应的RS资源  revisionHistoryLimit: 10  # Pod最短就绪准备时间，Pod至少达到这个时间，才会进入Pod为Ready状态  minReady...</div></div></div></a><a class="pagination-related" href="/2025/01/08/cloud/braveheart/2024%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/" title="2024年终总结"><img class="cover" src="/img/braveheart.png" onerror="onerror=null;src='/img/404.png'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">2024年终总结</div></div><div class="info-2"><div class="info-item-1">2024年终总结那些我也许应该抵达的地方一月：与LeaderZhang相聚在绍兴，见到了书本上的鲁迅故居  五月：见过南京的各种故事  五月：抵达那个万象的重庆山城  五月：在武汉的东湖，骑行，期待下一次的重逢  六月：东莞HDC2024，与众星云集的相聚  七月：抵达广州，时隔许久相见18、19的师兄师姐  十月：与同学，自由行千岛湖 十一月：团建台州，点亮新图标  我🎓了  四年之期已经抵达终点站，毕业。   我带着我四年中做过有趣的项目，终于毕业了，虽然以1分之差，错过了优秀毕业论文，没能和LeaderZhang 双双拿下 因为这个项目，我也成功结缘于Cloud Native领域，在Java转向Go的迷茫中，寻找到了自己想追求的新方向K8s与容器化 这个项目也收到了老师资金资助正式发表到了省刊，虽然随着自己随着对领域的深入理解，感觉还是做的十分潦草，没什么特别的东西，但是也算是集齐了大学的一种神奇的体验  如何去写一篇论文 如何以第一作者发表期刊 如何绘制一个清晰的流程图  仰望星空也要脚踏实地在过去大半年的时间内，我很幸运的在我的第一志愿有一些了解的以及意向的云边部门实...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/03/11/cloud/k8s/CKAD%E8%80%83%E8%AF%95/" title="CKAD考试经验2025"><img class="cover" src="/img/k8s-go.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-11</div><div class="info-item-2">CKAD考试经验2025</div></div><div class="info-2"><div class="info-item-1">CKAD考试经验 证书镇楼    考试过程 整体考试不难，如果有一些K8s的使用经验，基本上都能做出来，但是我实际上是参与了第二次的复考，第一次因为没仔细阅读考前须知，不知道怎么开K8s文档，浪费了20分钟，最后以差3分未通过 第二次复考，大部分题目与第一次一样，最后也再检查一边以后，提前了半个小时就提交了，最后以82PASS了  其他问题：  俩次考试检察官都要求环境检查，但是感觉严格程度不一样，因为选用中文，所以考官用中文聊天，但是不确定是不是国人 整个考试中，终端我都用Mac无法实现复制粘贴，不过也不影响 第一次考试，浏览器K8s文档无法查看到全部，包括无法选用中文（未解之谜） 浏览器中不知道怎么用Ctrl + F的搜索，都靠上下滑动   </div></div></div></a><a class="pagination-related" href="/2025/08/24/cloud/k8s/K8s%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97-%E5%AE%A2%E6%88%B7%E7%AB%AF/" title="K8s开发指南-客户端"><img class="cover" src="/img/k8sLogo.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-24</div><div class="info-item-2">K8s开发指南-客户端</div></div><div class="info-2"><div class="info-item-1">K8s开发指南-客户端 基于K8s v1.29  API客户端 Ref：https://github.com/kubernetes/client-go  K8s认证方式主要一下俩类：  集群外的认证：客户端程序运行在集群外，以独立进程访问API Server 集群内的认证：客户端在K8s内以Pod形式运行，通过内部服务名访问API Server  客户端访问API Server常见的认证方式有以下的几种  数字证书方式 ServiceAccount方式 BearerToken方式  对于运行在K8s集群之外的客户端，建议使用数字证书方式连接API Server，客户端需要配置的信息包括CA根证书、客户端证书、客户段私钥以及API Server地址 对于运行在集群内的Pod，建议使用ServiceAccount认证方式，需要为Pod增加ServiceAccount资源，并为ServiceAccount配置好正确的RBAC权限 基于kubeconfig文件的配置方式有以下几种：  用户HOME目录中的约定目录，例如$HOME&#x2F;.kube&#x2F;config 在环境变量K...</div></div></div></a><a class="pagination-related" href="/2025/08/23/cloud/k8s/K8s%E5%BC%80%E5%8F%91-API%E8%AF%A6%E8%A7%A3/" title="K8s开发-API详解"><img class="cover" src="/img/k8sLogo.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-23</div><div class="info-item-2">K8s开发-API详解</div></div><div class="info-2"><div class="info-item-1">K8s开发-API详解 基于K8s v1.29  资源对象一个K8s资源对象描述一般是kind、apiVersion、metadata、spec和status五个部分 资源对象的类型资源对象的类型用Kind属性表示，总体分为3个类型：  对象（Object）、代表系统中永久资源实体，比如Pod、RC 列表（List）：资源对象的合集 简单类别（Simple）：作用于资源对象或非持久辅助实体的特定操作，比如Status、Scale、ListOptions等  资源对象的元数据metadata是资源对象的元数据定义，由一组属性来定义，在K8s中，每个资源对象都必须包含以下元数据属性：  namespec：对象所属的命名空间，如果不指定，则昔日会将对象置于名为default中 name：对象的名称、在一个ns下，唯一性 uid：系统为每个对象生成唯一的ID，符合RFC4122 labels：自定义标签 annotations：用户自定义注解，被K8s内部进程或者外部工具使用 resourceVersion：用于识别资源内部斑斑的字符串，在Watch操作，可以避免Get和下一次Watch...</div></div></div></a><a class="pagination-related" href="/2025/08/22/cloud/k8s/K8s%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6-%E6%8B%93%E5%B1%95%E8%AE%A4%E8%AF%81/" title="K8s认证机制-拓展认证"><img class="cover" src="/img/k8sLogo.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-22</div><div class="info-item-2">K8s认证机制-拓展认证</div></div><div class="info-2"><div class="info-item-1">K8s认证机制-拓展认证 基于K8s v1.29  OIDC Token认证K8s支持使用OpenID Connect协议进行身份认证。  OIDC协议给予OAuth2.0，构建了身份层，主要提供了ID Token，这是一个JWT格式的Token  流程图：  配置OIDC认证，需要API-Server开启一些参数 WebHook Token认证WebHook认证是K8s回调第三方认证实现用户认证 认证原理：  API Server收到客户端的请求之后，从HTTP Header获取到Bearer Token，然后生成一个包含该Token的TokenReview资源对象 API Server把整个TokenReview对象JSON序列化之后发送给Webhook认证服务器  开启WebHook 认证需要设置API Server启动参数 Authenticating Proxy认证在这种模式下，K8s自身不再对用户认证，而是使用外部认证服务进行用户认证 开启Authenticating Proxy 认证需要设置API Server启动参数 </div></div></div></a><a class="pagination-related" href="/2025/03/27/cloud/k8s/service/K8s-kustomize/" title="K8s-kustomize"><img class="cover" src="/img/k8s-go.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-27</div><div class="info-item-2">K8s-kustomize</div></div><div class="info-2"><div class="info-item-1">K8s-kustomize背景K8s为 减少维护很多YAML文件，选择定义K8s资源，从1.14开始，kustomize默认提供 kustomize提供以下管理各种配置文件：  从其他文件来源生成K8s资源对象 统一为所有资源设置命名空间、Label、注解或者特殊格式的名称 组合不同的资源作为一个应用或者一个管理单元进行整体注解  概述kustomize核心配置是kustomizeation.yaml，这个文件类似于一个一个模版文件，里面定义了相应的操作指令，主要操作指令以及作用如下：  namespace：为所有资源都添加命名空间  namePrefix：要添加到所有资源名称之前的前缀  nameSuffix：要添加到所有资源名称之后的后缀  commonLabels：要添加到所有资源和选择器中的Label  commonAnnoations:要添加到所有资源的注解  resources：列表中的每个条目都会生成资源配置  configMapGenerator：针对列表中的每个条目都会生成一个ConfigMap  secrertGenerator：列表中的每个条目都会生成一个S...</div></div></div></a><a class="pagination-related" href="/2025/03/26/cloud/k8s/service/K8s-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Service/" title="K8s-深入理解Service"><img class="cover" src="/img/k8s-go.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-26</div><div class="info-item-2">K8s-深入理解Service</div></div><div class="info-2"><div class="info-item-1">K8s-深入理解Service 基于K8s v1.31  OverviewService是K8s实现微服务的核心，通过创建Srvice，可以实现具有相同的功能都容器提供一个统一的入口 Service的概念和原理负载均衡机制当一个Service对象被定义出来，客户端都可以通过ServiceIP访问Pod容器，到每个Node山上交与kube-porxy实现 kube-porxy的代理模式 iptables模式 （v1.28中实现） 通过基于Linux 的 Linux Kernel的iptables规则实现，实现了从Service到后端Endpoints列表的负载均衡规则 每次创建Service和Endpoints发生变化，kube-proxy都会刷新本Node得全部iptables，在大规模集群（service和endpoints数量达到数百万），刷新时间过长，系统性能下降，可以通过调整kube-proxy的资源对象KubeProxyConguration中的同步行为； 12345iptables:	# 设置同步最短时间，默认1s	minSyncPeriod: 1s	# 同步时间间隔...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Joohwan.</div><div class="author-info-description">该知道的都知道，不知道的慢慢了解</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">259</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">76</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">60</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/piwriw"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/piwriw" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:piwriw@163.com" target="_blank" title="Email"><i class="fas fa-envelope-open-text"></i></a></div></div><div class="card-widget"><div class="item-headline"><i class="iconfont icat-visitor"></i><span>来访者</span></div><div class="item-content"><div id="welcome-info"></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#CKAD-Simulator-Kubernetes-1-32"><span class="toc-number">1.</span> <span class="toc-text">CKAD Simulator Kubernetes 1.32</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-1-Namespaces"><span class="toc-number">1.1.</span> <span class="toc-text">Question 1 | Namespaces</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Answer"><span class="toc-number">1.1.0.0.1.</span> <span class="toc-text">Answer:</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-2-Pods"><span class="toc-number">1.2.</span> <span class="toc-text">Question 2 | Pods</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Answer-1"><span class="toc-number">1.2.0.0.1.</span> <span class="toc-text">Answer:</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-3-Job"><span class="toc-number">1.3.</span> <span class="toc-text">Question 3 | Job</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Answer-2"><span class="toc-number">1.3.0.0.1.</span> <span class="toc-text">Answer:</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-4-Helm-Management"><span class="toc-number">1.4.</span> <span class="toc-text">Question 4 | Helm Management</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Answer-3"><span class="toc-number">1.4.0.0.1.</span> <span class="toc-text">Answer:</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Step-1"><span class="toc-number">1.4.0.0.1.1.</span> <span class="toc-text">Step 1</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Step-2"><span class="toc-number">1.4.0.0.1.2.</span> <span class="toc-text">Step 2</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Step-3"><span class="toc-number">1.4.0.0.1.3.</span> <span class="toc-text">Step 3</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Step-4"><span class="toc-number">1.4.0.0.1.4.</span> <span class="toc-text">Step 4</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-5-ServiceAccount-Secret"><span class="toc-number">1.5.</span> <span class="toc-text">Question 5 | ServiceAccount, Secret</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Answer-4"><span class="toc-number">1.5.0.0.1.</span> <span class="toc-text">Answer:</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-6-ReadinessProbe"><span class="toc-number">1.6.</span> <span class="toc-text">Question 6 | ReadinessProbe</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Answer-5"><span class="toc-number">1.6.0.0.1.</span> <span class="toc-text">Answer:</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-7-Pods-Namespaces"><span class="toc-number">1.7.</span> <span class="toc-text">Question 7 | Pods, Namespaces</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Answer-6"><span class="toc-number">1.7.0.0.1.</span> <span class="toc-text">Answer:</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-8-Deployment-Rollouts"><span class="toc-number">1.8.</span> <span class="toc-text">Question 8 | Deployment, Rollouts</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Answer-7"><span class="toc-number">1.8.0.0.1.</span> <span class="toc-text">Answer:</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-9-Pod-Deployment"><span class="toc-number">1.9.</span> <span class="toc-text">Question 9 | Pod -&gt; Deployment</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Answer-8"><span class="toc-number">1.9.0.0.1.</span> <span class="toc-text">Answer</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-10-Service-Logs"><span class="toc-number">1.10.</span> <span class="toc-text">Question 10 | Service, Logs</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Answer-9"><span class="toc-number">1.10.0.0.1.</span> <span class="toc-text">Answer</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-11-Working-with-Containers"><span class="toc-number">1.11.</span> <span class="toc-text">Question 11 | Working with Containers</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Answer-10"><span class="toc-number">1.11.0.0.1.</span> <span class="toc-text">Answer</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Step-1-1"><span class="toc-number">1.11.0.0.1.1.</span> <span class="toc-text">Step 1</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Step-2-1"><span class="toc-number">1.11.0.0.1.2.</span> <span class="toc-text">Step 2</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Step-3-1"><span class="toc-number">1.11.0.0.1.3.</span> <span class="toc-text">Step 3</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Step-4-1"><span class="toc-number">1.11.0.0.1.4.</span> <span class="toc-text">Step 4</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Step-5"><span class="toc-number">1.11.0.0.1.5.</span> <span class="toc-text">Step 5</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-12-Storage-PV-PVC-Pod-volume"><span class="toc-number">1.12.</span> <span class="toc-text">Question 12 | Storage, PV, PVC, Pod volume</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Answer-11"><span class="toc-number">1.12.0.0.1.</span> <span class="toc-text">Answer</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-13-Storage-StorageClass-PVC"><span class="toc-number">1.13.</span> <span class="toc-text">Question 13 | Storage, StorageClass, PVC</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Answer-12"><span class="toc-number">1.13.0.0.1.</span> <span class="toc-text">Answer</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-14-Secret-Secret-Volume-Secret-Env"><span class="toc-number">1.14.</span> <span class="toc-text">Question 14 | Secret, Secret-Volume, Secret-Env</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Answer-13"><span class="toc-number">1.14.0.0.1.</span> <span class="toc-text">Answer</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-15-ConfigMap-Configmap-Volume"><span class="toc-number">1.15.</span> <span class="toc-text">Question 15 | ConfigMap, Configmap-Volume</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Answer-14"><span class="toc-number">1.15.0.0.1.</span> <span class="toc-text">Answer</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-16-Logging-sidecar"><span class="toc-number">1.16.</span> <span class="toc-text">Question 16 | Logging sidecar</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Answer-15"><span class="toc-number">1.16.0.0.1.</span> <span class="toc-text">Answer</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-17-InitContainer"><span class="toc-number">1.17.</span> <span class="toc-text">Question 17 | InitContainer</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Answer-16"><span class="toc-number">1.17.0.0.1.</span> <span class="toc-text">Answer</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-18-Service-misconfiguration"><span class="toc-number">1.18.</span> <span class="toc-text">Question 18 | Service misconfiguration</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Answer-17"><span class="toc-number">1.18.0.0.1.</span> <span class="toc-text">Answer</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-19-Service-ClusterIP-NodePort"><span class="toc-number">1.19.</span> <span class="toc-text">Question 19 | Service ClusterIP-&gt;NodePort</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Answer-18"><span class="toc-number">1.19.0.0.1.</span> <span class="toc-text">Answer</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-20-NetworkPolicy"><span class="toc-number">1.20.</span> <span class="toc-text">Question 20 | NetworkPolicy</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Answer-19"><span class="toc-number">1.20.0.0.1.</span> <span class="toc-text">Answer</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-21-Requests-and-Limits-ServiceAccount"><span class="toc-number">1.21.</span> <span class="toc-text">Question 21 | Requests and Limits, ServiceAccount</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Answer-20"><span class="toc-number">1.21.0.0.1.</span> <span class="toc-text">Answer:</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Question-22-Labels-Annotations"><span class="toc-number">1.22.</span> <span class="toc-text">Question 22 | Labels, Annotations</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Answer-21"><span class="toc-number">1.22.0.0.1.</span> <span class="toc-text">Answer</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CKAD-Simulator-Preview-Kubernetes-1-32"><span class="toc-number">2.</span> <span class="toc-text">CKAD Simulator Preview Kubernetes 1.32</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Preview-Question-1"><span class="toc-number">2.1.</span> <span class="toc-text">Preview Question 1</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Answer-22"><span class="toc-number">2.1.0.0.1.</span> <span class="toc-text">Answer</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Preview-Question-2"><span class="toc-number">2.2.</span> <span class="toc-text">Preview Question 2</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Answer-23"><span class="toc-number">2.2.0.0.1.</span> <span class="toc-text">Answer</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Preview-Question-3"><span class="toc-number">2.3.</span> <span class="toc-text">Preview Question 3</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Answer-24"><span class="toc-number">2.3.0.0.1.</span> <span class="toc-text">Answer</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CKAD-Tips-Kubernetes-1-32"><span class="toc-number">3.</span> <span class="toc-text">CKAD Tips Kubernetes 1.32</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Knowledge"><span class="toc-number">3.1.</span> <span class="toc-text">Knowledge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CKAD-Preparation"><span class="toc-number">3.2.</span> <span class="toc-text">CKAD Preparation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kubernetes-documentation"><span class="toc-number">3.3.</span> <span class="toc-text">Kubernetes documentation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#The-Test-Environment-Browser-Terminal"><span class="toc-number">3.4.</span> <span class="toc-text">The Test Environment &#x2F; Browser Terminal</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PSI-Bridge"><span class="toc-number">3.5.</span> <span class="toc-text">PSI Bridge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Terminal-Handling"><span class="toc-number">3.6.</span> <span class="toc-text">Terminal Handling</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Bash-Aliases"><span class="toc-number">3.6.1.</span> <span class="toc-text">Bash Aliases</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Be-fast"><span class="toc-number">3.6.2.</span> <span class="toc-text">Be fast</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Vim"><span class="toc-number">3.6.3.</span> <span class="toc-text">Vim</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2026/01/11/web/gorm/09-logger/" title="Gorm-日志系统模块原理说明"><img src="/img/go.png" onerror="this.onerror=null;this.src='/img/404.png'" alt="Gorm-日志系统模块原理说明"/></a><div class="content"><a class="title" href="/2026/01/11/web/gorm/09-logger/" title="Gorm-日志系统模块原理说明">Gorm-日志系统模块原理说明</a><time datetime="2026-01-11T11:56:27.000Z" title="发表于 2026-01-11 19:56:27">2026-01-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/11/web/gorm/08-migration/" title="Gorm-迁移功能模块原理说明"><img src="/img/go.png" onerror="this.onerror=null;this.src='/img/404.png'" alt="Gorm-迁移功能模块原理说明"/></a><div class="content"><a class="title" href="/2026/01/11/web/gorm/08-migration/" title="Gorm-迁移功能模块原理说明">Gorm-迁移功能模块原理说明</a><time datetime="2026-01-11T10:56:27.000Z" title="发表于 2026-01-11 18:56:27">2026-01-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/11/web/gorm/10-plugin/" title="Gorm-插件系统模块原理说明"><img src="/img/go.png" onerror="this.onerror=null;this.src='/img/404.png'" alt="Gorm-插件系统模块原理说明"/></a><div class="content"><a class="title" href="/2026/01/11/web/gorm/10-plugin/" title="Gorm-插件系统模块原理说明">Gorm-插件系统模块原理说明</a><time datetime="2026-01-11T10:56:27.000Z" title="发表于 2026-01-11 18:56:27">2026-01-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/11/web/gorm/07-transaction/" title="Gorm-事务处理模块原理说明"><img src="/img/go.png" onerror="this.onerror=null;this.src='/img/404.png'" alt="Gorm-事务处理模块原理说明"/></a><div class="content"><a class="title" href="/2026/01/11/web/gorm/07-transaction/" title="Gorm-事务处理模块原理说明">Gorm-事务处理模块原理说明</a><time datetime="2026-01-11T09:56:27.000Z" title="发表于 2026-01-11 17:56:27">2026-01-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/11/web/gorm/06-associations/" title="Gorm-关联关系模块原理说明"><img src="/img/go.png" onerror="this.onerror=null;this.src='/img/404.png'" alt="Gorm-关联关系模块原理说明"/></a><div class="content"><a class="title" href="/2026/01/11/web/gorm/06-associations/" title="Gorm-关联关系模块原理说明">Gorm-关联关系模块原理说明</a><time datetime="2026-01-11T08:56:27.000Z" title="发表于 2026-01-11 16:56:27">2026-01-11</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2023 - 2026 By Joohwan.</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://piwriw-twikoo-git-main-piwriw.vercel.app/',
      region: 'ap-shanghai',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://piwriw-twikoo-git-main-piwriw.vercel.app/',
      region: 'ap-shanghai',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script src="/js/categories.js" defer></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>